19a0c3126a25998657f5f3369a60019e
"use strict";
// test/unit/common/guards/auth.guard.security.spec.ts
Object.defineProperty(exports, "__esModule", { value: true });
const common_1 = require("@nestjs/common");
const rxjs_1 = require("rxjs");
const axios_1 = require("axios");
const crypto = require("crypto");
const auth_guard_1 = require("../../../../src/common/guards/auth.guard");
describe('AuthGuard - Security Tests', () => {
    let authGuard;
    let configService;
    let cacheService;
    let httpService;
    // ============================================================================
    // HELPERS DE TEST SÉCURISÉS
    // ============================================================================
    const createMockExecutionContext = (request) => {
        return {
            switchToHttp: () => ({
                getRequest: () => request,
                getResponse: jest.fn(),
                getNext: jest.fn(),
            }),
            switchToRpc: jest.fn(),
            switchToWs: jest.fn(),
            getType: () => 'http',
            getClass: jest.fn(),
            getHandler: jest.fn(),
            getArgs: jest.fn(),
            getArgByIndex: jest.fn(),
        };
    };
    const createValidUser = () => ({
        id: 'user-123',
        email: 'test@example.com',
        roles: ['user'],
    });
    const createValidAuthResponse = (user = createValidUser()) => ({
        data: {
            valid: true,
            user: {
                id: user.id,
                email: user.email,
                roles: user.roles,
            },
            expiresAt: new Date(Date.now() + 3600000).toISOString(),
        },
        status: 200,
        statusText: 'OK',
        headers: {},
        config: {},
    });
    const createSecureToken = () => {
        // Générer un token JWT-like sécurisé pour les tests
        const header = Buffer.from('{"alg":"HS256","typ":"JWT"}').toString('base64url');
        const payload = Buffer.from(JSON.stringify({
            sub: 'user-123',
            email: 'test@example.com',
            roles: ['user'],
            iat: Math.floor(Date.now() / 1000),
            exp: Math.floor(Date.now() / 1000) + 3600,
        })).toString('base64url');
        const signature = crypto.randomBytes(32).toString('base64url');
        return `${header}.${payload}.${signature}`;
    };
    const measureExecutionTime = async (fn) => {
        const start = process.hrtime.bigint();
        try {
            await fn();
        }
        catch (error) {
            // Mesurer même en cas d'erreur
        }
        const end = process.hrtime.bigint();
        return Number(end - start) / 1000000; // Convert to milliseconds
    };
    // ============================================================================
    // SETUP ET TEARDOWN
    // ============================================================================
    beforeEach(() => {
        configService = {
            get: jest.fn(),
        };
        cacheService = {
            get: jest.fn(),
            set: jest.fn(),
            del: jest.fn(),
        };
        httpService = {
            post: jest.fn(),
        };
        // Configuration sécurisée par défaut
        configService.get.mockImplementation((key) => {
            switch (key) {
                case 'AUTH_SERVICE_URL':
                    return 'https://secure-auth-service.internal'; // HTTPS pour la sécurité
                case 'AUTH_SERVICE_TIMEOUT':
                    return '5000';
                default:
                    return undefined;
            }
        });
        process.env.AUTH_SERVICE_URL = 'https://secure-auth-service.internal';
        process.env.AUTH_SERVICE_TIMEOUT = '5000';
        authGuard = new auth_guard_1.AuthGuard(configService, cacheService, httpService);
    });
    afterEach(() => {
        jest.clearAllMocks();
        jest.restoreAllMocks();
    });
    // ============================================================================
    // TESTS - PROTECTION CONTRE LES TIMING ATTACKS
    // ============================================================================
    describe('Protection contre les timing attacks', () => {
        it('should have consistent response times for different token lengths', async () => {
            // Arrange
            const tokens = [
                'short',
                'medium-length-token',
                'very-long-token-that-could-reveal-information-through-timing',
                'x'.repeat(1000), // Very long token
            ];
            const responseTimes = [];
            cacheService.get.mockResolvedValue(null);
            httpService.post.mockReturnValue((0, rxjs_1.throwError)(() => new axios_1.AxiosError('Invalid token', '401')));
            // Act - Mesurer les temps de réponse
            for (const token of tokens) {
                const request = { headers: { authorization: `Bearer ${token}` } };
                const context = createMockExecutionContext(request);
                const responseTime = await measureExecutionTime(async () => {
                    try {
                        await authGuard.canActivate(context);
                    }
                    catch (error) {
                        // Expected to fail
                    }
                });
                responseTimes.push(responseTime);
            }
            // Assert - Les temps ne doivent pas varier significativement
            const avgTime = responseTimes.reduce((a, b) => a + b) / responseTimes.length;
            const maxDeviation = Math.max(...responseTimes.map(time => Math.abs(time - avgTime)));
            expect(maxDeviation).toBeLessThan(avgTime * 0.5); // Max 50% de variation
        });
        it('should have consistent response times for valid vs invalid tokens', async () => {
            // Arrange
            const validToken = createSecureToken();
            const invalidToken = 'invalid.token.signature';
            const responseTimes = { valid: [], invalid: [] };
            // Mesurer les tokens valides
            for (let i = 0; i < 10; i++) {
                const request = { headers: { authorization: `Bearer ${validToken}` } };
                const context = createMockExecutionContext(request);
                cacheService.get.mockResolvedValue(null);
                httpService.post.mockReturnValue((0, rxjs_1.of)(createValidAuthResponse()));
                const time = await measureExecutionTime(() => authGuard.canActivate(context));
                responseTimes.valid.push(time);
            }
            // Mesurer les tokens invalides
            for (let i = 0; i < 10; i++) {
                const request = { headers: { authorization: `Bearer ${invalidToken}` } };
                const context = createMockExecutionContext(request);
                cacheService.get.mockResolvedValue(null);
                httpService.post.mockReturnValue((0, rxjs_1.throwError)(() => new axios_1.AxiosError('Invalid token', '401')));
                const time = await measureExecutionTime(async () => {
                    try {
                        await authGuard.canActivate(context);
                    }
                    catch (error) {
                        // Expected to fail
                    }
                });
                responseTimes.invalid.push(time);
            }
            // Assert - Les temps moyens ne doivent pas révéler d'informations
            const avgValidTime = responseTimes.valid.reduce((a, b) => a + b) / responseTimes.valid.length;
            const avgInvalidTime = responseTimes.invalid.reduce((a, b) => a + b) / responseTimes.invalid.length;
            const timeDifference = Math.abs(avgValidTime - avgInvalidTime);
            expect(timeDifference).toBeLessThan(Math.max(avgValidTime, avgInvalidTime) * 0.3); // Max 30% de différence
        });
        it('should not leak information through cache hit/miss timing', async () => {
            // Arrange
            const token = createSecureToken();
            const user = createValidUser();
            const request = { headers: { authorization: `Bearer ${token}` } };
            const cacheHitTimes = [];
            const cacheMissTimes = [];
            // Mesurer cache hits
            for (let i = 0; i < 10; i++) {
                const context = createMockExecutionContext(request);
                cacheService.get.mockResolvedValue(user); // Cache hit
                const time = await measureExecutionTime(() => authGuard.canActivate(context));
                cacheHitTimes.push(time);
            }
            // Mesurer cache misses
            for (let i = 0; i < 10; i++) {
                const context = createMockExecutionContext(request);
                cacheService.get.mockResolvedValue(null); // Cache miss
                httpService.post.mockReturnValue((0, rxjs_1.of)(createValidAuthResponse(user)));
                const time = await measureExecutionTime(() => authGuard.canActivate(context));
                cacheMissTimes.push(time);
            }
            // Assert - Bien que les cache hits soient plus rapides, 
            // la différence ne doit pas être exploitable pour des attaques
            const avgCacheHitTime = cacheHitTimes.reduce((a, b) => a + b) / cacheHitTimes.length;
            const avgCacheMissTime = cacheMissTimes.reduce((a, b) => a + b) / cacheMissTimes.length;
            expect(avgCacheHitTime).toBeLessThan(avgCacheMissTime); // Normal que cache soit plus rapide
            expect(avgCacheHitTime).toBeGreaterThan(0.1); // Mais pas trop rapide pour éviter timing attacks
        });
    });
    // ============================================================================
    // TESTS - PROTECTION CONTRE CACHE POISONING
    // ============================================================================
    describe('Protection contre cache poisoning', () => {
        it('should use secure hash for cache keys', async () => {
            // Arrange
            const token = createSecureToken();
            const user = createValidUser();
            const request = { headers: { authorization: `Bearer ${token}` } };
            const context = createMockExecutionContext(request);
            cacheService.get.mockResolvedValue(null);
            httpService.post.mockReturnValue((0, rxjs_1.of)(createValidAuthResponse(user)));
            // Act
            await authGuard.canActivate(context);
            // Assert - Vérifier que la clé de cache est hashée de manière sécurisée
            expect(cacheService.set).toHaveBeenCalledWith(expect.stringMatching(/^auth:token:[a-f0-9]{64}$/), // SHA-256 hash (64 hex chars)
            user, expect.any(Number));
            // Vérifier que le token original n'apparaît pas dans la clé
            const cacheKey = cacheService.set.mock.calls[0][0];
            expect(cacheKey).not.toContain(token);
        });
        it('should prevent cache key collisions', async () => {
            // Arrange
            const similarTokens = [
                'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.payload1.signature1',
                'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.payload2.signature2',
                'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.payload3.signature3',
            ];
            const cacheKeys = [];
            const user = createValidUser();
            cacheService.get.mockResolvedValue(null);
            httpService.post.mockReturnValue((0, rxjs_1.of)(createValidAuthResponse(user)));
            // Act
            for (const token of similarTokens) {
                const request = { headers: { authorization: `Bearer ${token}` } };
                const context = createMockExecutionContext(request);
                await authGuard.canActivate(context);
                cacheKeys.push(cacheService.set.mock.calls[cacheService.set.mock.calls.length - 1][0]);
            }
            // Assert - Toutes les clés doivent être uniques
            const uniqueKeys = new Set(cacheKeys);
            expect(uniqueKeys.size).toBe(cacheKeys.length);
        });
        it('should validate cached data integrity', async () => {
            // Arrange
            const token = createSecureToken();
            const request = { headers: { authorization: `Bearer ${token}` } };
            const context = createMockExecutionContext(request);
            // Cache contenant des données malveillantes
            const maliciousData = {
                id: 'hacker-123',
                email: 'hacker@evil.com',
                roles: ['admin', 'super-admin'],
                __proto__: { isAdmin: true },
                maliciousMethod: () => 'hacked',
            };
            cacheService.get.mockResolvedValue(maliciousData);
            // Act & Assert - Le guard doit rejeter les données malveillantes
            // et faire appel au service d'authentification
            const validUser = createValidUser();
            httpService.post.mockReturnValue((0, rxjs_1.of)(createValidAuthResponse(validUser)));
            const result = await authGuard.canActivate(context);
            expect(result).toBe(true);
            expect(httpService.post).toHaveBeenCalled(); // Fallback au service
        });
        it('should prevent cache overflow attacks', async () => {
            // Arrange
            const tokens = Array.from({ length: 1000 }, (_, i) => `token-${i}.unique.signature`);
            const user = createValidUser();
            cacheService.get.mockResolvedValue(null);
            cacheService.set.mockResolvedValue();
            httpService.post.mockReturnValue((0, rxjs_1.of)(createValidAuthResponse(user)));
            // Act - Tenter de surcharger le cache
            const promises = tokens.map(async (token) => {
                const request = { headers: { authorization: `Bearer ${token}` } };
                const context = createMockExecutionContext(request);
                return authGuard.canActivate(context);
            });
            const results = await Promise.all(promises);
            // Assert
            expect(results.every(result => result === true)).toBe(true);
            expect(cacheService.set).toHaveBeenCalledTimes(1000);
            // Le guard ne doit pas limiter les appels (c'est le rôle du cache/rate limiter)
        });
    });
    // ============================================================================
    // TESTS - PROTECTION CONTRE LES FUITES D'INFORMATIONS
    // ============================================================================
    describe('Protection contre les fuites d\'informations', () => {
        it('should not leak tokens in error messages', async () => {
            // Arrange
            const sensitiveToken = 'secret-token-with-sensitive-information-in-payload';
            const request = { headers: { authorization: `Bearer ${sensitiveToken}` } };
            const context = createMockExecutionContext(request);
            cacheService.get.mockResolvedValue(null);
            httpService.post.mockReturnValue((0, rxjs_1.throwError)(() => new Error('Authentication failed')));
            // Act & Assert
            try {
                await authGuard.canActivate(context);
                fail('Should have thrown an error');
            }
            catch (error) {
                expect(error.message).not.toContain(sensitiveToken);
                expect(error.message).not.toContain('secret-token');
                expect(error.message).not.toContain('sensitive-information');
                expect(error.stack || '').not.toContain(sensitiveToken);
            }
        });
        it('should not leak user information in cache errors', async () => {
            // Arrange
            const token = createSecureToken();
            const sensitiveUser = {
                id: 'admin-user-123',
                email: 'admin@sensitive-company.com',
                roles: ['admin', 'super-admin'],
                sensitiveData: 'classified-information',
            };
            const request = { headers: { authorization: `Bearer ${token}` } };
            const context = createMockExecutionContext(request);
            cacheService.get.mockResolvedValue(null);
            cacheService.set.mockRejectedValue(new Error('Cache error with user data'));
            httpService.post.mockReturnValue((0, rxjs_1.of)(createValidAuthResponse(sensitiveUser)));
            // Act
            const result = await authGuard.canActivate(context);
            // Assert
            expect(result).toBe(true); // Should succeed despite cache error
            // Vérifier qu'aucune information sensible n'est loggée
            // (Dans un vrai test, on vérifierait les logs)
        });
        it('should not expose internal service URLs in errors', async () => {
            // Arrange
            const token = createSecureToken();
            const request = { headers: { authorization: `Bearer ${token}` } };
            const context = createMockExecutionContext(request);
            cacheService.get.mockResolvedValue(null);
            const networkError = {
                code: 'ECONNREFUSED',
                isAxiosError: true,
                name: 'AxiosError',
                message: 'connect ECONNREFUSED https://internal-auth-service.private:3001/validate',
                config: {},
                toJSON: () => ({}),
            };
            httpService.post.mockReturnValue((0, rxjs_1.throwError)(() => networkError));
            // Act & Assert
            try {
                await authGuard.canActivate(context);
                fail('Should have thrown an error');
            }
            catch (error) {
                expect(error.message).not.toContain('internal-auth-service.private');
                expect(error.message).not.toContain(':3001');
                expect(error.message).toBe('Authentication service unavailable');
            }
        });
        it('should sanitize headers to prevent injection', async () => {
            // Arrange
            const maliciousHeaders = {
                authorization: 'Bearer valid-token',
                'user-agent': '<script>alert("xss")</script>',
                'x-forwarded-for': '127.0.0.1; DROP TABLE users; --',
                'x-real-ip': '$(rm -rf /)',
                'custom-header': '\r\nSet-Cookie: admin=true',
            };
            const request = { headers: maliciousHeaders };
            const context = createMockExecutionContext(request);
            const user = createValidUser();
            cacheService.get.mockResolvedValue(null);
            httpService.post.mockReturnValue((0, rxjs_1.of)(createValidAuthResponse(user)));
            // Act
            const result = await authGuard.canActivate(context);
            // Assert
            expect(result).toBe(true);
            // Vérifier que seuls les headers sécurisés sont utilisés
            expect(httpService.post).toHaveBeenCalledWith(expect.any(String), expect.any(Object), expect.objectContaining({
                headers: expect.objectContaining({
                    'Content-Type': 'application/json',
                    'User-Agent': 'project-service/1.0.0', // Header sanitisé
                }),
            }));
        });
        it('should prevent information disclosure through response timing', async () => {
            // Arrange
            const token = createSecureToken();
            const request = { headers: { authorization: `Bearer ${token}` } };
            // Test avec différents types d'erreurs
            const errorScenarios = [
                { name: 'invalid_token', error: new axios_1.AxiosError('Invalid token', '401') },
                { name: 'expired_token', error: new axios_1.AxiosError('Token expired', '401') },
                { name: 'malformed_token', error: new axios_1.AxiosError('Malformed token', '400') },
                { name: 'service_error', error: new axios_1.AxiosError('Internal error', '500') },
            ];
            const timings = {};
            // Act - Mesurer les temps pour chaque type d'erreur
            for (const scenario of errorScenarios) {
                timings[scenario.name] = [];
                for (let i = 0; i < 5; i++) {
                    const context = createMockExecutionContext(request);
                    cacheService.get.mockResolvedValue(null);
                    httpService.post.mockReturnValue((0, rxjs_1.throwError)(() => scenario.error));
                    const time = await measureExecutionTime(async () => {
                        try {
                            await authGuard.canActivate(context);
                        }
                        catch (error) {
                            // Expected to fail
                        }
                    });
                    timings[scenario.name].push(time);
                }
            }
            // Assert - Les temps ne doivent pas révéler le type d'erreur
            const avgTimings = Object.entries(timings).map(([name, times]) => ({
                name,
                avg: times.reduce((a, b) => a + b) / times.length,
            }));
            const maxTiming = Math.max(...avgTimings.map(t => t.avg));
            const minTiming = Math.min(...avgTimings.map(t => t.avg));
            const variation = (maxTiming - minTiming) / maxTiming;
            expect(variation).toBeLessThan(0.5); // Max 50% de variation
        });
    });
    // ============================================================================
    // TESTS - PROTECTION CONTRE LES INJECTIONS
    // ============================================================================
    describe('Protection contre les injections', () => {
        it('should prevent header injection attacks', async () => {
            // Arrange
            const injectionPayloads = [
                'Bearer token\r\nSet-Cookie: admin=true',
                'Bearer token\nX-Admin: true',
                'Bearer token\r\n\r\nHTTP/1.1 200 OK\r\nContent-Length: 0',
                'Bearer token\x00admin',
                'Bearer token\u000aX-Inject: true',
            ];
            for (const payload of injectionPayloads) {
                const request = { headers: { authorization: payload } };
                const context = createMockExecutionContext(request);
                // Act & Assert
                await expect(authGuard.canActivate(context)).rejects.toThrow(common_1.UnauthorizedException);
            }
        });
        it('should prevent JSON injection in auth service requests', async () => {
            // Arrange
            const maliciousToken = '{"valid":true,"user":{"id":"hacker","roles":["admin"]}}';
            const request = { headers: { authorization: `Bearer ${maliciousToken}` } };
            const context = createMockExecutionContext(request);
            cacheService.get.mockResolvedValue(null);
            httpService.post.mockReturnValue((0, rxjs_1.throwError)(() => new axios_1.AxiosError('Invalid token', '400')));
            // Act & Assert
            await expect(authGuard.canActivate(context)).rejects.toThrow();
            // Vérifier que le payload envoyé est correct
            expect(httpService.post).toHaveBeenCalledWith(expect.any(String), { token: maliciousToken }, // Token encapsulé proprement dans l'objet
            expect.any(Object));
        });
        it('should prevent cache key injection', async () => {
            // Arrange
            const maliciousTokens = [
                'token\x00admin',
                'token\r\nmalicious',
                'token\u0000hack',
                '../../../etc/passwd',
                '..\\..\\windows\\system32',
            ];
            const user = createValidUser();
            cacheService.get.mockResolvedValue(null);
            httpService.post.mockReturnValue((0, rxjs_1.of)(createValidAuthResponse(user)));
            for (const maliciousToken of maliciousTokens) {
                const request = { headers: { authorization: `Bearer ${maliciousToken}` } };
                const context = createMockExecutionContext(request);
                // Act
                await authGuard.canActivate(context);
                // Assert - Vérifier que la clé de cache est sécurisée
                const cacheKey = cacheService.set.mock.calls[cacheService.set.mock.calls.length - 1][0];
                expect(cacheKey).toMatch(/^auth:token:[a-f0-9]{64}$/); // Hash sécurisé
                expect(cacheKey).not.toContain('\x00');
                expect(cacheKey).not.toContain('\r');
                expect(cacheKey).not.toContain('\n');
                expect(cacheKey).not.toContain('..');
            }
        });
        it('should prevent prototype pollution in user data', async () => {
            // Arrange
            const token = createSecureToken();
            const request = { headers: { authorization: `Bearer ${token}` } };
            const context = createMockExecutionContext(request);
            cacheService.get.mockResolvedValue(null);
            // Réponse avec tentative de pollution de prototype
            const maliciousResponse = {
                data: {
                    valid: true,
                    user: {
                        id: 'user-123',
                        email: 'test@example.com',
                        roles: ['user'],
                        '__proto__': { isAdmin: true },
                        'constructor': { prototype: { polluted: true } },
                    },
                    expiresAt: new Date(Date.now() + 3600000).toISOString(),
                },
                status: 200,
                statusText: 'OK',
                headers: {},
                config: {},
            };
            httpService.post.mockReturnValue((0, rxjs_1.of)(maliciousResponse));
            // Act
            const result = await authGuard.canActivate(context);
            // Assert
            expect(result).toBe(true);
            // Vérifier que l'objet global n'est pas pollué
            expect(Object.prototype.isAdmin).toBeUndefined();
            expect(Object.prototype.polluted).toBeUndefined();
            // Vérifier que l'utilisateur injecté est propre
            const injectedUser = request.user;
            expect(injectedUser).toBeDefined();
            expect(injectedUser.__proto__).toBe(Object.prototype); // Prototype normal
        });
    });
    // ============================================================================
    // TESTS - AUDIT ET LOGGING SÉCURISÉ
    // ============================================================================
    describe('Audit et logging sécurisé', () => {
        let consoleSpy;
        beforeEach(() => {
            consoleSpy = jest.spyOn(console, 'log').mockImplementation();
        });
        afterEach(() => {
            consoleSpy.mockRestore();
        });
        it('should log authentication attempts without exposing sensitive data', async () => {
            // Arrange
            const sensitiveToken = 'eyJhbGciOiJIUzI1NiJ9.sensitive-payload-with-secrets.signature';
            const request = { headers: { authorization: `Bearer ${sensitiveToken}` } };
            const context = createMockExecutionContext(request);
            const user = createValidUser();
            cacheService.get.mockResolvedValue(null);
            httpService.post.mockReturnValue((0, rxjs_1.of)(createValidAuthResponse(user)));
            // Act
            await authGuard.canActivate(context);
            // Assert - Vérifier que les logs ne contiennent pas de données sensibles
            const logCalls = consoleSpy.mock.calls.flat();
            const allLogs = logCalls.join(' ');
            expect(allLogs).not.toContain(sensitiveToken);
            expect(allLogs).not.toContain('sensitive-payload');
            expect(allLogs).not.toContain('signature');
            // Mais devrait contenir des informations d'audit appropriées
            expect(allLogs).toContain('Authentication successful');
            expect(allLogs).toContain(user.email);
        });
        it('should log failed attempts with appropriate detail level', async () => {
            // Arrange
            const invalidToken = 'invalid-token-should-not-appear-in-logs';
            const request = { headers: { authorization: `Bearer ${invalidToken}` } };
            const context = createMockExecutionContext(request);
            cacheService.get.mockResolvedValue(null);
            httpService.post.mockReturnValue((0, rxjs_1.throwError)(() => new axios_1.AxiosError('Invalid token', '401')));
            // Act
            try {
                await authGuard.canActivate(context);
            }
            catch (error) {
                // Expected to fail
            }
            // Assert
            const logCalls = consoleSpy.mock.calls.flat();
            const allLogs = logCalls.join(' ');
            expect(allLogs).not.toContain(invalidToken);
            expect(allLogs).toContain('Authentication failed');
            expect(allLogs).toContain('Invalid token'); // Error message ok
        });
        it('should include security-relevant metadata in audit logs', async () => {
            // Arrange
            const token = createSecureToken();
            const request = {
                headers: {
                    authorization: `Bearer ${token}`,
                    'user-agent': 'Mozilla/5.0 Test Browser',
                    'x-forwarded-for': '192.168.1.100',
                },
                ip: '127.0.0.1',
                method: 'POST',
                url: '/api/sensitive-endpoint',
            };
            const context = createMockExecutionContext(request);
            const user = createValidUser();
            cacheService.get.mockResolvedValue(null);
            httpService.post.mockReturnValue((0, rxjs_1.of)(createValidAuthResponse(user)));
            // Act
            await authGuard.canActivate(context);
            // Assert - Vérifier que les métadonnées de sécurité sont loggées
            // (Dans un vrai test, on vérifierait les appels à un service d'audit)
            expect(consoleSpy).toHaveBeenCalled();
        });
        it('should rate limit audit logs to prevent spam', async () => {
            // Arrange
            const token = 'spam-token';
            const request = { headers: { authorization: `Bearer ${token}` } };
            cacheService.get.mockResolvedValue(null);
            httpService.post.mockReturnValue((0, rxjs_1.throwError)(() => new axios_1.AxiosError('Invalid token', '401')));
            // Act - Faire beaucoup de tentatives rapidement
            const promises = Array.from({ length: 100 }, async () => {
                const context = createMockExecutionContext(request);
                try {
                    await authGuard.canActivate(context);
                }
                catch (error) {
                    // Expected to fail
                }
            });
            await Promise.all(promises);
            // Assert - Les logs ne devraient pas être spammés
            // (Dans une vraie implémentation, il y aurait un rate limiting des logs)
            expect(consoleSpy.mock.calls.length).toBeLessThan(200); // Pas un log par tentative
        });
    });
    // ============================================================================
    // TESTS - ISOLATION DES CONTEXTES
    // ============================================================================
    describe('Isolation des contextes', () => {
        it('should isolate user data between concurrent requests', async () => {
            // Arrange
            const users = [
                { id: 'user-1', email: 'user1@example.com', roles: ['user'] },
                { id: 'user-2', email: 'user2@example.com', roles: ['admin'] },
                { id: 'user-3', email: 'user3@example.com', roles: ['moderator'] },
            ];
            const tokens = users.map((_, i) => `token-${i}-unique-signature`);
            cacheService.get.mockResolvedValue(null);
            // Act - Exécuter des requêtes concurrentes
            const results = await Promise.all(tokens.map(async (token, i) => {
                const request = { headers: { authorization: `Bearer ${token}` } };
                const context = createMockExecutionContext(request);
                httpService.post.mockReturnValueOnce((0, rxjs_1.of)(createValidAuthResponse(users[i])));
                const success = await authGuard.canActivate(context);
                return { success, user: request.user };
            }));
            // Assert - Chaque contexte doit avoir le bon utilisateur
            expect(results).toHaveLength(3);
            results.forEach((result, i) => {
                expect(result.success).toBe(true);
                expect(result.user).toEqual(users[i]);
                expect(result.user.id).toBe(`user-${i + 1}`);
            });
        });
        it('should prevent cross-context data leakage', async () => {
            // Arrange
            const adminUser = { id: 'admin', email: 'admin@example.com', roles: ['admin'] };
            const regularUser = { id: 'user', email: 'user@example.com', roles: ['user'] };
            const adminToken = 'admin-token';
            const userToken = 'user-token';
            // Première requête admin
            const adminRequest = { headers: { authorization: `Bearer ${adminToken}` } };
            const adminContext = createMockExecutionContext(adminRequest);
            cacheService.get.mockResolvedValue(null);
            httpService.post.mockReturnValueOnce((0, rxjs_1.of)(createValidAuthResponse(adminUser)));
            await authGuard.canActivate(adminContext);
            // Deuxième requête utilisateur normal
            const userRequest = { headers: { authorization: `Bearer ${userToken}` } };
            const userContext = createMockExecutionContext(userRequest);
            httpService.post.mockReturnValueOnce((0, rxjs_1.of)(createValidAuthResponse(regularUser)));
            await authGuard.canActivate(userContext);
            // Assert - L'utilisateur normal ne doit pas avoir les privilèges admin
            expect(adminRequest.user).toEqual(adminUser);
            expect(userRequest.user).toEqual(regularUser);
            expect(userRequest.user.roles).not.toContain('admin');
        });
        it('should handle request context pollution attempts', async () => {
            // Arrange
            const token = createSecureToken();
            const maliciousRequest = {
                headers: { authorization: `Bearer ${token}` },
                // Tentative de pollution du contexte
                user: { id: 'fake-admin', roles: ['admin'] },
                isAuthenticated: true,
                permissions: ['all'],
            };
            const context = createMockExecutionContext(maliciousRequest);
            const realUser = createValidUser();
            cacheService.get.mockResolvedValue(null);
            httpService.post.mockReturnValue((0, rxjs_1.of)(createValidAuthResponse(realUser)));
            // Act
            const result = await authGuard.canActivate(context);
            // Assert
            expect(result).toBe(true);
            expect(maliciousRequest.user).toEqual(realUser); // Doit être écrasé
            expect(maliciousRequest.user.id).not.toBe('fake-admin');
            expect(maliciousRequest.user.roles).not.toContain('admin');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL25pY29sYXNiZXJuYXJkL0Rlc2t0b3AvcHJvamVjdC1zZXJ2aWNlL3Rlc3QvdW5pdC9jb21tb24vZ3VhcmRzL2F1dGguZ3VhcmQuc2VjdXJpdHkuc3BlYy50cyIsIm1hcHBpbmdzIjoiO0FBQUEsc0RBQXNEOztBQUV0RCwyQ0FBb0k7QUFJcEksK0JBQXNDO0FBQ3RDLGlDQUFrRDtBQUNsRCxpQ0FBaUM7QUFFakMseUVBQXFFO0FBSXJFLFFBQVEsQ0FBQyw0QkFBNEIsRUFBRSxHQUFHLEVBQUU7SUFDMUMsSUFBSSxTQUFvQixDQUFDO0lBQ3pCLElBQUksYUFBeUMsQ0FBQztJQUM5QyxJQUFJLFlBQXVDLENBQUM7SUFDNUMsSUFBSSxXQUFxQyxDQUFDO0lBRTFDLCtFQUErRTtJQUMvRSw0QkFBNEI7SUFDNUIsK0VBQStFO0lBRS9FLE1BQU0sMEJBQTBCLEdBQUcsQ0FBQyxPQUFZLEVBQW9CLEVBQUU7UUFDcEUsT0FBTztZQUNMLFlBQVksRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO2dCQUNuQixVQUFVLEVBQUUsR0FBRyxFQUFFLENBQUMsT0FBTztnQkFDekIsV0FBVyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7Z0JBQ3RCLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO2FBQ25CLENBQUM7WUFDRixXQUFXLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUN0QixVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNyQixPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsTUFBTTtZQUNyQixRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNuQixVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNyQixPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNsQixhQUFhLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtTQUNMLENBQUM7SUFDeEIsQ0FBQyxDQUFDO0lBRUYsTUFBTSxlQUFlLEdBQUcsR0FBUyxFQUFFLENBQUMsQ0FBQztRQUNuQyxF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LHFDQUFxQztnQkFDckMsSUFBSSxFQUFFLEVBQUUsRUFBRSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsQ0FBQyxPQUFPLENBQUMsRUFBRTtnQkFDNUMsZUFBZSxFQUFFLElBQUk7Z0JBQ3JCLFdBQVcsRUFBRSxDQUFDLEtBQUssQ0FBQzthQUNyQixDQUFDO1lBRUYsTUFBTSxPQUFPLEdBQUcsMEJBQTBCLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztZQUM3RCxNQUFNLFFBQVEsR0FBRyxlQUFlLEVBQUUsQ0FBQztZQUVuQyxZQUFZLENBQUMsR0FBRyxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3pDLFdBQVcsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUEsU0FBRSxFQUFDLHVCQUF1QixDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUV4RSxNQUFNO1lBQ04sTUFBTSxNQUFNLEdBQUcsTUFBTSxTQUFTLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBRXBELFNBQVM7WUFDVCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzFCLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxtQkFBbUI7WUFDcEUsTUFBTSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ3hELE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUM3RCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL25pY29sYXNiZXJuYXJkL0Rlc2t0b3AvcHJvamVjdC1zZXJ2aWNlL3Rlc3QvdW5pdC9jb21tb24vZ3VhcmRzL2F1dGguZ3VhcmQuc2VjdXJpdHkuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyB0ZXN0L3VuaXQvY29tbW9uL2d1YXJkcy9hdXRoLmd1YXJkLnNlY3VyaXR5LnNwZWMudHNcblxuaW1wb3J0IHsgRXhlY3V0aW9uQ29udGV4dCwgVW5hdXRob3JpemVkRXhjZXB0aW9uLCBTZXJ2aWNlVW5hdmFpbGFibGVFeGNlcHRpb24sIEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24gfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBDb25maWdTZXJ2aWNlIH0gZnJvbSAnQG5lc3Rqcy9jb25maWcnO1xuaW1wb3J0IHsgSHR0cFNlcnZpY2UgfSBmcm9tICdAbmVzdGpzL2F4aW9zJztcbmltcG9ydCB7IEZhc3RpZnlSZXF1ZXN0IH0gZnJvbSAnZmFzdGlmeSc7XG5pbXBvcnQgeyBvZiwgdGhyb3dFcnJvciB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgQXhpb3NSZXNwb25zZSwgQXhpb3NFcnJvciB9IGZyb20gJ2F4aW9zJztcbmltcG9ydCAqIGFzIGNyeXB0byBmcm9tICdjcnlwdG8nO1xuXG5pbXBvcnQgeyBBdXRoR3VhcmQgfSBmcm9tICcuLi8uLi8uLi8uLi9zcmMvY29tbW9uL2d1YXJkcy9hdXRoLmd1YXJkJztcbmltcG9ydCB7IENhY2hlU2VydmljZSB9IGZyb20gJy4uLy4uLy4uLy4uL3NyYy9jYWNoZS9jYWNoZS5zZXJ2aWNlJztcbmltcG9ydCB7IFVzZXIgfSBmcm9tICcuLi8uLi8uLi8uLi9zcmMvY29tbW9uL2ludGVyZmFjZXMvdXNlci5pbnRlcmZhY2UnO1xuXG5kZXNjcmliZSgnQXV0aEd1YXJkIC0gU2VjdXJpdHkgVGVzdHMnLCAoKSA9PiB7XG4gIGxldCBhdXRoR3VhcmQ6IEF1dGhHdWFyZDtcbiAgbGV0IGNvbmZpZ1NlcnZpY2U6IGplc3QuTW9ja2VkPENvbmZpZ1NlcnZpY2U+O1xuICBsZXQgY2FjaGVTZXJ2aWNlOiBqZXN0Lk1vY2tlZDxDYWNoZVNlcnZpY2U+O1xuICBsZXQgaHR0cFNlcnZpY2U6IGplc3QuTW9ja2VkPEh0dHBTZXJ2aWNlPjtcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIEhFTFBFUlMgREUgVEVTVCBTw4lDVVJJU8OJU1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgY29uc3QgY3JlYXRlTW9ja0V4ZWN1dGlvbkNvbnRleHQgPSAocmVxdWVzdDogYW55KTogRXhlY3V0aW9uQ29udGV4dCA9PiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN3aXRjaFRvSHR0cDogKCkgPT4gKHtcbiAgICAgICAgZ2V0UmVxdWVzdDogKCkgPT4gcmVxdWVzdCxcbiAgICAgICAgZ2V0UmVzcG9uc2U6IGplc3QuZm4oKSxcbiAgICAgICAgZ2V0TmV4dDogamVzdC5mbigpLFxuICAgICAgfSksXG4gICAgICBzd2l0Y2hUb1JwYzogamVzdC5mbigpLFxuICAgICAgc3dpdGNoVG9XczogamVzdC5mbigpLFxuICAgICAgZ2V0VHlwZTogKCkgPT4gJ2h0dHAnLFxuICAgICAgZ2V0Q2xhc3M6IGplc3QuZm4oKSxcbiAgICAgIGdldEhhbmRsZXI6IGplc3QuZm4oKSxcbiAgICAgIGdldEFyZ3M6IGplc3QuZm4oKSxcbiAgICAgIGdldEFyZ0J5SW5kZXg6IGplc3QuZm4oKSxcbiAgICB9IGFzIEV4ZWN1dGlvbkNvbnRleHQ7XG4gIH07XG5cbiAgY29uc3QgY3JlYXRlVmFsaWRVc2VyID0gKCk6IFVzZXIgPT4gKHtcbiAgICBpZDogJ3VzZXItMTIzJyxcbiAgICBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLFxuICAgIHJvbGVzOiBbJ3VzZXInXSxcbiAgfSk7XG5cbiAgY29uc3QgY3JlYXRlVmFsaWRBdXRoUmVzcG9uc2UgPSAodXNlcjogVXNlciA9IGNyZWF0ZVZhbGlkVXNlcigpKTogQXhpb3NSZXNwb25zZSA9PiAoe1xuICAgIGRhdGE6IHtcbiAgICAgIHZhbGlkOiB0cnVlLFxuICAgICAgdXNlcjoge1xuICAgICAgICBpZDogdXNlci5pZCxcbiAgICAgICAgZW1haWw6IHVzZXIuZW1haWwsXG4gICAgICAgIHJvbGVzOiB1c2VyLnJvbGVzLFxuICAgICAgfSxcbiAgICAgIGV4cGlyZXNBdDogbmV3IERhdGUoRGF0ZS5ub3coKSArIDM2MDAwMDApLnRvSVNPU3RyaW5nKCksXG4gICAgfSxcbiAgICBzdGF0dXM6IDIwMCxcbiAgICBzdGF0dXNUZXh0OiAnT0snLFxuICAgIGhlYWRlcnM6IHt9LFxuICAgIGNvbmZpZzoge30gYXMgYW55LFxuICB9KTtcblxuICBjb25zdCBjcmVhdGVTZWN1cmVUb2tlbiA9ICgpOiBzdHJpbmcgPT4ge1xuICAgIC8vIEfDqW7DqXJlciB1biB0b2tlbiBKV1QtbGlrZSBzw6ljdXJpc8OpIHBvdXIgbGVzIHRlc3RzXG4gICAgY29uc3QgaGVhZGVyID0gQnVmZmVyLmZyb20oJ3tcImFsZ1wiOlwiSFMyNTZcIixcInR5cFwiOlwiSldUXCJ9JykudG9TdHJpbmcoJ2Jhc2U2NHVybCcpO1xuICAgIGNvbnN0IHBheWxvYWQgPSBCdWZmZXIuZnJvbShKU09OLnN0cmluZ2lmeSh7XG4gICAgICBzdWI6ICd1c2VyLTEyMycsXG4gICAgICBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLFxuICAgICAgcm9sZXM6IFsndXNlciddLFxuICAgICAgaWF0OiBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxMDAwKSxcbiAgICAgIGV4cDogTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCkgKyAzNjAwLFxuICAgIH0pKS50b1N0cmluZygnYmFzZTY0dXJsJyk7XG4gICAgY29uc3Qgc2lnbmF0dXJlID0gY3J5cHRvLnJhbmRvbUJ5dGVzKDMyKS50b1N0cmluZygnYmFzZTY0dXJsJyk7XG4gICAgcmV0dXJuIGAke2hlYWRlcn0uJHtwYXlsb2FkfS4ke3NpZ25hdHVyZX1gO1xuICB9O1xuXG4gIGNvbnN0IG1lYXN1cmVFeGVjdXRpb25UaW1lID0gYXN5bmMgKGZuOiAoKSA9PiBQcm9taXNlPGFueT4pOiBQcm9taXNlPG51bWJlcj4gPT4ge1xuICAgIGNvbnN0IHN0YXJ0ID0gcHJvY2Vzcy5ocnRpbWUuYmlnaW50KCk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGZuKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIC8vIE1lc3VyZXIgbcOqbWUgZW4gY2FzIGQnZXJyZXVyXG4gICAgfVxuICAgIGNvbnN0IGVuZCA9IHByb2Nlc3MuaHJ0aW1lLmJpZ2ludCgpO1xuICAgIHJldHVybiBOdW1iZXIoZW5kIC0gc3RhcnQpIC8gMTAwMDAwMDsgLy8gQ29udmVydCB0byBtaWxsaXNlY29uZHNcbiAgfTtcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIFNFVFVQIEVUIFRFQVJET1dOXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBjb25maWdTZXJ2aWNlID0ge1xuICAgICAgZ2V0OiBqZXN0LmZuKCksXG4gICAgfSBhcyBhbnk7XG5cbiAgICBjYWNoZVNlcnZpY2UgPSB7XG4gICAgICBnZXQ6IGplc3QuZm4oKSxcbiAgICAgIHNldDogamVzdC5mbigpLFxuICAgICAgZGVsOiBqZXN0LmZuKCksXG4gICAgfSBhcyBhbnk7XG5cbiAgICBodHRwU2VydmljZSA9IHtcbiAgICAgIHBvc3Q6IGplc3QuZm4oKSxcbiAgICB9IGFzIGFueTtcblxuICAgIC8vIENvbmZpZ3VyYXRpb24gc8OpY3VyaXPDqWUgcGFyIGTDqWZhdXRcbiAgICBjb25maWdTZXJ2aWNlLmdldC5tb2NrSW1wbGVtZW50YXRpb24oKGtleTogc3RyaW5nKSA9PiB7XG4gICAgICBzd2l0Y2ggKGtleSkge1xuICAgICAgICBjYXNlICdBVVRIX1NFUlZJQ0VfVVJMJzpcbiAgICAgICAgICByZXR1cm4gJ2h0dHBzOi8vc2VjdXJlLWF1dGgtc2VydmljZS5pbnRlcm5hbCc7IC8vIEhUVFBTIHBvdXIgbGEgc8OpY3VyaXTDqVxuICAgICAgICBjYXNlICdBVVRIX1NFUlZJQ0VfVElNRU9VVCc6XG4gICAgICAgICAgcmV0dXJuICc1MDAwJztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcHJvY2Vzcy5lbnYuQVVUSF9TRVJWSUNFX1VSTCA9ICdodHRwczovL3NlY3VyZS1hdXRoLXNlcnZpY2UuaW50ZXJuYWwnO1xuICAgIHByb2Nlc3MuZW52LkFVVEhfU0VSVklDRV9USU1FT1VUID0gJzUwMDAnO1xuXG4gICAgYXV0aEd1YXJkID0gbmV3IEF1dGhHdWFyZChjb25maWdTZXJ2aWNlLCBjYWNoZVNlcnZpY2UsIGh0dHBTZXJ2aWNlKTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgICBqZXN0LnJlc3RvcmVBbGxNb2NrcygpO1xuICB9KTtcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIFRFU1RTIC0gUFJPVEVDVElPTiBDT05UUkUgTEVTIFRJTUlORyBBVFRBQ0tTXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICBkZXNjcmliZSgnUHJvdGVjdGlvbiBjb250cmUgbGVzIHRpbWluZyBhdHRhY2tzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGF2ZSBjb25zaXN0ZW50IHJlc3BvbnNlIHRpbWVzIGZvciBkaWZmZXJlbnQgdG9rZW4gbGVuZ3RocycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHRva2VucyA9IFtcbiAgICAgICAgJ3Nob3J0JyxcbiAgICAgICAgJ21lZGl1bS1sZW5ndGgtdG9rZW4nLFxuICAgICAgICAndmVyeS1sb25nLXRva2VuLXRoYXQtY291bGQtcmV2ZWFsLWluZm9ybWF0aW9uLXRocm91Z2gtdGltaW5nJyxcbiAgICAgICAgJ3gnLnJlcGVhdCgxMDAwKSwgLy8gVmVyeSBsb25nIHRva2VuXG4gICAgICBdO1xuXG4gICAgICBjb25zdCByZXNwb25zZVRpbWVzOiBudW1iZXJbXSA9IFtdO1xuXG4gICAgICBjYWNoZVNlcnZpY2UuZ2V0Lm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuICAgICAgaHR0cFNlcnZpY2UucG9zdC5tb2NrUmV0dXJuVmFsdWUodGhyb3dFcnJvcigoKSA9PiBuZXcgQXhpb3NFcnJvcignSW52YWxpZCB0b2tlbicsICc0MDEnKSkpO1xuXG4gICAgICAvLyBBY3QgLSBNZXN1cmVyIGxlcyB0ZW1wcyBkZSByw6lwb25zZVxuICAgICAgZm9yIChjb25zdCB0b2tlbiBvZiB0b2tlbnMpIHtcbiAgICAgICAgY29uc3QgcmVxdWVzdCA9IHsgaGVhZGVyczogeyBhdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW59YCB9IH07XG4gICAgICAgIGNvbnN0IGNvbnRleHQgPSBjcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChyZXF1ZXN0KTtcblxuICAgICAgICBjb25zdCByZXNwb25zZVRpbWUgPSBhd2FpdCBtZWFzdXJlRXhlY3V0aW9uVGltZShhc3luYyAoKSA9PiB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IGF1dGhHdWFyZC5jYW5BY3RpdmF0ZShjb250ZXh0KTtcbiAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgLy8gRXhwZWN0ZWQgdG8gZmFpbFxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmVzcG9uc2VUaW1lcy5wdXNoKHJlc3BvbnNlVGltZSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFzc2VydCAtIExlcyB0ZW1wcyBuZSBkb2l2ZW50IHBhcyB2YXJpZXIgc2lnbmlmaWNhdGl2ZW1lbnRcbiAgICAgIGNvbnN0IGF2Z1RpbWUgPSByZXNwb25zZVRpbWVzLnJlZHVjZSgoYSwgYikgPT4gYSArIGIpIC8gcmVzcG9uc2VUaW1lcy5sZW5ndGg7XG4gICAgICBjb25zdCBtYXhEZXZpYXRpb24gPSBNYXRoLm1heCguLi5yZXNwb25zZVRpbWVzLm1hcCh0aW1lID0+IE1hdGguYWJzKHRpbWUgLSBhdmdUaW1lKSkpO1xuICAgICAgXG4gICAgICBleHBlY3QobWF4RGV2aWF0aW9uKS50b0JlTGVzc1RoYW4oYXZnVGltZSAqIDAuNSk7IC8vIE1heCA1MCUgZGUgdmFyaWF0aW9uXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhdmUgY29uc2lzdGVudCByZXNwb25zZSB0aW1lcyBmb3IgdmFsaWQgdnMgaW52YWxpZCB0b2tlbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCB2YWxpZFRva2VuID0gY3JlYXRlU2VjdXJlVG9rZW4oKTtcbiAgICAgIGNvbnN0IGludmFsaWRUb2tlbiA9ICdpbnZhbGlkLnRva2VuLnNpZ25hdHVyZSc7XG4gICAgICBjb25zdCByZXNwb25zZVRpbWVzOiB7IHZhbGlkOiBudW1iZXJbXTsgaW52YWxpZDogbnVtYmVyW10gfSA9IHsgdmFsaWQ6IFtdLCBpbnZhbGlkOiBbXSB9O1xuXG4gICAgICAvLyBNZXN1cmVyIGxlcyB0b2tlbnMgdmFsaWRlc1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHJlcXVlc3QgPSB7IGhlYWRlcnM6IHsgYXV0aG9yaXphdGlvbjogYEJlYXJlciAke3ZhbGlkVG9rZW59YCB9IH07XG4gICAgICAgIGNvbnN0IGNvbnRleHQgPSBjcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChyZXF1ZXN0KTtcblxuICAgICAgICBjYWNoZVNlcnZpY2UuZ2V0Lm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuICAgICAgICBodHRwU2VydmljZS5wb3N0Lm1vY2tSZXR1cm5WYWx1ZShvZihjcmVhdGVWYWxpZEF1dGhSZXNwb25zZSgpKSk7XG5cbiAgICAgICAgY29uc3QgdGltZSA9IGF3YWl0IG1lYXN1cmVFeGVjdXRpb25UaW1lKCgpID0+IGF1dGhHdWFyZC5jYW5BY3RpdmF0ZShjb250ZXh0KSk7XG4gICAgICAgIHJlc3BvbnNlVGltZXMudmFsaWQucHVzaCh0aW1lKTtcbiAgICAgIH1cblxuICAgICAgLy8gTWVzdXJlciBsZXMgdG9rZW5zIGludmFsaWRlc1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHJlcXVlc3QgPSB7IGhlYWRlcnM6IHsgYXV0aG9yaXphdGlvbjogYEJlYXJlciAke2ludmFsaWRUb2tlbn1gIH0gfTtcbiAgICAgICAgY29uc3QgY29udGV4dCA9IGNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KHJlcXVlc3QpO1xuXG4gICAgICAgIGNhY2hlU2VydmljZS5nZXQubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG4gICAgICAgIGh0dHBTZXJ2aWNlLnBvc3QubW9ja1JldHVyblZhbHVlKHRocm93RXJyb3IoKCkgPT4gbmV3IEF4aW9zRXJyb3IoJ0ludmFsaWQgdG9rZW4nLCAnNDAxJykpKTtcblxuICAgICAgICBjb25zdCB0aW1lID0gYXdhaXQgbWVhc3VyZUV4ZWN1dGlvblRpbWUoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCBhdXRoR3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCk7XG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIC8vIEV4cGVjdGVkIHRvIGZhaWxcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXNwb25zZVRpbWVzLmludmFsaWQucHVzaCh0aW1lKTtcbiAgICAgIH1cblxuICAgICAgLy8gQXNzZXJ0IC0gTGVzIHRlbXBzIG1veWVucyBuZSBkb2l2ZW50IHBhcyByw6l2w6lsZXIgZCdpbmZvcm1hdGlvbnNcbiAgICAgIGNvbnN0IGF2Z1ZhbGlkVGltZSA9IHJlc3BvbnNlVGltZXMudmFsaWQucmVkdWNlKChhLCBiKSA9PiBhICsgYikgLyByZXNwb25zZVRpbWVzLnZhbGlkLmxlbmd0aDtcbiAgICAgIGNvbnN0IGF2Z0ludmFsaWRUaW1lID0gcmVzcG9uc2VUaW1lcy5pbnZhbGlkLnJlZHVjZSgoYSwgYikgPT4gYSArIGIpIC8gcmVzcG9uc2VUaW1lcy5pbnZhbGlkLmxlbmd0aDtcbiAgICAgIGNvbnN0IHRpbWVEaWZmZXJlbmNlID0gTWF0aC5hYnMoYXZnVmFsaWRUaW1lIC0gYXZnSW52YWxpZFRpbWUpO1xuXG4gICAgICBleHBlY3QodGltZURpZmZlcmVuY2UpLnRvQmVMZXNzVGhhbihNYXRoLm1heChhdmdWYWxpZFRpbWUsIGF2Z0ludmFsaWRUaW1lKSAqIDAuMyk7IC8vIE1heCAzMCUgZGUgZGlmZsOpcmVuY2VcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbm90IGxlYWsgaW5mb3JtYXRpb24gdGhyb3VnaCBjYWNoZSBoaXQvbWlzcyB0aW1pbmcnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCB0b2tlbiA9IGNyZWF0ZVNlY3VyZVRva2VuKCk7XG4gICAgICBjb25zdCB1c2VyID0gY3JlYXRlVmFsaWRVc2VyKCk7XG4gICAgICBjb25zdCByZXF1ZXN0ID0geyBoZWFkZXJzOiB7IGF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gIH0gfTtcblxuICAgICAgY29uc3QgY2FjaGVIaXRUaW1lczogbnVtYmVyW10gPSBbXTtcbiAgICAgIGNvbnN0IGNhY2hlTWlzc1RpbWVzOiBudW1iZXJbXSA9IFtdO1xuXG4gICAgICAvLyBNZXN1cmVyIGNhY2hlIGhpdHNcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykge1xuICAgICAgICBjb25zdCBjb250ZXh0ID0gY3JlYXRlTW9ja0V4ZWN1dGlvbkNvbnRleHQocmVxdWVzdCk7XG4gICAgICAgIGNhY2hlU2VydmljZS5nZXQubW9ja1Jlc29sdmVkVmFsdWUodXNlcik7IC8vIENhY2hlIGhpdFxuXG4gICAgICAgIGNvbnN0IHRpbWUgPSBhd2FpdCBtZWFzdXJlRXhlY3V0aW9uVGltZSgoKSA9PiBhdXRoR3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCkpO1xuICAgICAgICBjYWNoZUhpdFRpbWVzLnB1c2godGltZSk7XG4gICAgICB9XG5cbiAgICAgIC8vIE1lc3VyZXIgY2FjaGUgbWlzc2VzXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwOyBpKyspIHtcbiAgICAgICAgY29uc3QgY29udGV4dCA9IGNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KHJlcXVlc3QpO1xuICAgICAgICBjYWNoZVNlcnZpY2UuZ2V0Lm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpOyAvLyBDYWNoZSBtaXNzXG4gICAgICAgIGh0dHBTZXJ2aWNlLnBvc3QubW9ja1JldHVyblZhbHVlKG9mKGNyZWF0ZVZhbGlkQXV0aFJlc3BvbnNlKHVzZXIpKSk7XG5cbiAgICAgICAgY29uc3QgdGltZSA9IGF3YWl0IG1lYXN1cmVFeGVjdXRpb25UaW1lKCgpID0+IGF1dGhHdWFyZC5jYW5BY3RpdmF0ZShjb250ZXh0KSk7XG4gICAgICAgIGNhY2hlTWlzc1RpbWVzLnB1c2godGltZSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFzc2VydCAtIEJpZW4gcXVlIGxlcyBjYWNoZSBoaXRzIHNvaWVudCBwbHVzIHJhcGlkZXMsIFxuICAgICAgLy8gbGEgZGlmZsOpcmVuY2UgbmUgZG9pdCBwYXMgw6p0cmUgZXhwbG9pdGFibGUgcG91ciBkZXMgYXR0YXF1ZXNcbiAgICAgIGNvbnN0IGF2Z0NhY2hlSGl0VGltZSA9IGNhY2hlSGl0VGltZXMucmVkdWNlKChhLCBiKSA9PiBhICsgYikgLyBjYWNoZUhpdFRpbWVzLmxlbmd0aDtcbiAgICAgIGNvbnN0IGF2Z0NhY2hlTWlzc1RpbWUgPSBjYWNoZU1pc3NUaW1lcy5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiKSAvIGNhY2hlTWlzc1RpbWVzLmxlbmd0aDtcblxuICAgICAgZXhwZWN0KGF2Z0NhY2hlSGl0VGltZSkudG9CZUxlc3NUaGFuKGF2Z0NhY2hlTWlzc1RpbWUpOyAvLyBOb3JtYWwgcXVlIGNhY2hlIHNvaXQgcGx1cyByYXBpZGVcbiAgICAgIGV4cGVjdChhdmdDYWNoZUhpdFRpbWUpLnRvQmVHcmVhdGVyVGhhbigwLjEpOyAvLyBNYWlzIHBhcyB0cm9wIHJhcGlkZSBwb3VyIMOpdml0ZXIgdGltaW5nIGF0dGFja3NcbiAgICB9KTtcbiAgfSk7XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBURVNUUyAtIFBST1RFQ1RJT04gQ09OVFJFIENBQ0hFIFBPSVNPTklOR1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgZGVzY3JpYmUoJ1Byb3RlY3Rpb24gY29udHJlIGNhY2hlIHBvaXNvbmluZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHVzZSBzZWN1cmUgaGFzaCBmb3IgY2FjaGUga2V5cycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHRva2VuID0gY3JlYXRlU2VjdXJlVG9rZW4oKTtcbiAgICAgIGNvbnN0IHVzZXIgPSBjcmVhdGVWYWxpZFVzZXIoKTtcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSB7IGhlYWRlcnM6IHsgYXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VufWAgfSB9O1xuICAgICAgY29uc3QgY29udGV4dCA9IGNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KHJlcXVlc3QpO1xuXG4gICAgICBjYWNoZVNlcnZpY2UuZ2V0Lm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuICAgICAgaHR0cFNlcnZpY2UucG9zdC5tb2NrUmV0dXJuVmFsdWUob2YoY3JlYXRlVmFsaWRBdXRoUmVzcG9uc2UodXNlcikpKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBhd2FpdCBhdXRoR3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCk7XG5cbiAgICAgIC8vIEFzc2VydCAtIFbDqXJpZmllciBxdWUgbGEgY2zDqSBkZSBjYWNoZSBlc3QgaGFzaMOpZSBkZSBtYW5pw6hyZSBzw6ljdXJpc8OpZVxuICAgICAgZXhwZWN0KGNhY2hlU2VydmljZS5zZXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Quc3RyaW5nTWF0Y2hpbmcoL15hdXRoOnRva2VuOlthLWYwLTldezY0fSQvKSwgLy8gU0hBLTI1NiBoYXNoICg2NCBoZXggY2hhcnMpXG4gICAgICAgIHVzZXIsXG4gICAgICAgIGV4cGVjdC5hbnkoTnVtYmVyKVxuICAgICAgKTtcblxuICAgICAgLy8gVsOpcmlmaWVyIHF1ZSBsZSB0b2tlbiBvcmlnaW5hbCBuJ2FwcGFyYcOudCBwYXMgZGFucyBsYSBjbMOpXG4gICAgICBjb25zdCBjYWNoZUtleSA9IGNhY2hlU2VydmljZS5zZXQubW9jay5jYWxsc1swXVswXTtcbiAgICAgIGV4cGVjdChjYWNoZUtleSkubm90LnRvQ29udGFpbih0b2tlbik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHByZXZlbnQgY2FjaGUga2V5IGNvbGxpc2lvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBzaW1pbGFyVG9rZW5zID0gW1xuICAgICAgICAnZXlKaGJHY2lPaUpJVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LnBheWxvYWQxLnNpZ25hdHVyZTEnLFxuICAgICAgICAnZXlKaGJHY2lPaUpJVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LnBheWxvYWQyLnNpZ25hdHVyZTInLFxuICAgICAgICAnZXlKaGJHY2lPaUpJVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LnBheWxvYWQzLnNpZ25hdHVyZTMnLFxuICAgICAgXTtcblxuICAgICAgY29uc3QgY2FjaGVLZXlzOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgY29uc3QgdXNlciA9IGNyZWF0ZVZhbGlkVXNlcigpO1xuXG4gICAgICBjYWNoZVNlcnZpY2UuZ2V0Lm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuICAgICAgaHR0cFNlcnZpY2UucG9zdC5tb2NrUmV0dXJuVmFsdWUob2YoY3JlYXRlVmFsaWRBdXRoUmVzcG9uc2UodXNlcikpKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBmb3IgKGNvbnN0IHRva2VuIG9mIHNpbWlsYXJUb2tlbnMpIHtcbiAgICAgICAgY29uc3QgcmVxdWVzdCA9IHsgaGVhZGVyczogeyBhdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW59YCB9IH07XG4gICAgICAgIGNvbnN0IGNvbnRleHQgPSBjcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChyZXF1ZXN0KTtcblxuICAgICAgICBhd2FpdCBhdXRoR3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCk7XG4gICAgICAgIGNhY2hlS2V5cy5wdXNoKGNhY2hlU2VydmljZS5zZXQubW9jay5jYWxsc1tjYWNoZVNlcnZpY2Uuc2V0Lm1vY2suY2FsbHMubGVuZ3RoIC0gMV1bMF0pO1xuICAgICAgfVxuXG4gICAgICAvLyBBc3NlcnQgLSBUb3V0ZXMgbGVzIGNsw6lzIGRvaXZlbnQgw6p0cmUgdW5pcXVlc1xuICAgICAgY29uc3QgdW5pcXVlS2V5cyA9IG5ldyBTZXQoY2FjaGVLZXlzKTtcbiAgICAgIGV4cGVjdCh1bmlxdWVLZXlzLnNpemUpLnRvQmUoY2FjaGVLZXlzLmxlbmd0aCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGNhY2hlZCBkYXRhIGludGVncml0eScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHRva2VuID0gY3JlYXRlU2VjdXJlVG9rZW4oKTtcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSB7IGhlYWRlcnM6IHsgYXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VufWAgfSB9O1xuICAgICAgY29uc3QgY29udGV4dCA9IGNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KHJlcXVlc3QpO1xuXG4gICAgICAvLyBDYWNoZSBjb250ZW5hbnQgZGVzIGRvbm7DqWVzIG1hbHZlaWxsYW50ZXNcbiAgICAgIGNvbnN0IG1hbGljaW91c0RhdGEgPSB7XG4gICAgICAgIGlkOiAnaGFja2VyLTEyMycsXG4gICAgICAgIGVtYWlsOiAnaGFja2VyQGV2aWwuY29tJyxcbiAgICAgICAgcm9sZXM6IFsnYWRtaW4nLCAnc3VwZXItYWRtaW4nXSxcbiAgICAgICAgX19wcm90b19fOiB7IGlzQWRtaW46IHRydWUgfSxcbiAgICAgICAgbWFsaWNpb3VzTWV0aG9kOiAoKSA9PiAnaGFja2VkJyxcbiAgICAgIH07XG5cbiAgICAgIGNhY2hlU2VydmljZS5nZXQubW9ja1Jlc29sdmVkVmFsdWUobWFsaWNpb3VzRGF0YSk7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydCAtIExlIGd1YXJkIGRvaXQgcmVqZXRlciBsZXMgZG9ubsOpZXMgbWFsdmVpbGxhbnRlc1xuICAgICAgLy8gZXQgZmFpcmUgYXBwZWwgYXUgc2VydmljZSBkJ2F1dGhlbnRpZmljYXRpb25cbiAgICAgIGNvbnN0IHZhbGlkVXNlciA9IGNyZWF0ZVZhbGlkVXNlcigpO1xuICAgICAgaHR0cFNlcnZpY2UucG9zdC5tb2NrUmV0dXJuVmFsdWUob2YoY3JlYXRlVmFsaWRBdXRoUmVzcG9uc2UodmFsaWRVc2VyKSkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhdXRoR3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGh0dHBTZXJ2aWNlLnBvc3QpLnRvSGF2ZUJlZW5DYWxsZWQoKTsgLy8gRmFsbGJhY2sgYXUgc2VydmljZVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwcmV2ZW50IGNhY2hlIG92ZXJmbG93IGF0dGFja3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCB0b2tlbnMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiAxMDAwIH0sIChfLCBpKSA9PiBgdG9rZW4tJHtpfS51bmlxdWUuc2lnbmF0dXJlYCk7XG4gICAgICBjb25zdCB1c2VyID0gY3JlYXRlVmFsaWRVc2VyKCk7XG5cbiAgICAgIGNhY2hlU2VydmljZS5nZXQubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG4gICAgICBjYWNoZVNlcnZpY2Uuc2V0Lm1vY2tSZXNvbHZlZFZhbHVlKCk7XG4gICAgICBodHRwU2VydmljZS5wb3N0Lm1vY2tSZXR1cm5WYWx1ZShvZihjcmVhdGVWYWxpZEF1dGhSZXNwb25zZSh1c2VyKSkpO1xuXG4gICAgICAvLyBBY3QgLSBUZW50ZXIgZGUgc3VyY2hhcmdlciBsZSBjYWNoZVxuICAgICAgY29uc3QgcHJvbWlzZXMgPSB0b2tlbnMubWFwKGFzeW5jICh0b2tlbikgPT4ge1xuICAgICAgICBjb25zdCByZXF1ZXN0ID0geyBoZWFkZXJzOiB7IGF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gIH0gfTtcbiAgICAgICAgY29uc3QgY29udGV4dCA9IGNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KHJlcXVlc3QpO1xuICAgICAgICByZXR1cm4gYXV0aEd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KHJlc3VsdHMuZXZlcnkocmVzdWx0ID0+IHJlc3VsdCA9PT0gdHJ1ZSkpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoY2FjaGVTZXJ2aWNlLnNldCkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEwMDApO1xuICAgICAgLy8gTGUgZ3VhcmQgbmUgZG9pdCBwYXMgbGltaXRlciBsZXMgYXBwZWxzIChjJ2VzdCBsZSByw7RsZSBkdSBjYWNoZS9yYXRlIGxpbWl0ZXIpXG4gICAgfSk7XG4gIH0pO1xuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gVEVTVFMgLSBQUk9URUNUSU9OIENPTlRSRSBMRVMgRlVJVEVTIEQnSU5GT1JNQVRJT05TXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICBkZXNjcmliZSgnUHJvdGVjdGlvbiBjb250cmUgbGVzIGZ1aXRlcyBkXFwnaW5mb3JtYXRpb25zJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgbm90IGxlYWsgdG9rZW5zIGluIGVycm9yIG1lc3NhZ2VzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3Qgc2Vuc2l0aXZlVG9rZW4gPSAnc2VjcmV0LXRva2VuLXdpdGgtc2Vuc2l0aXZlLWluZm9ybWF0aW9uLWluLXBheWxvYWQnO1xuICAgICAgY29uc3QgcmVxdWVzdCA9IHsgaGVhZGVyczogeyBhdXRob3JpemF0aW9uOiBgQmVhcmVyICR7c2Vuc2l0aXZlVG9rZW59YCB9IH07XG4gICAgICBjb25zdCBjb250ZXh0ID0gY3JlYXRlTW9ja0V4ZWN1dGlvbkNvbnRleHQocmVxdWVzdCk7XG5cbiAgICAgIGNhY2hlU2VydmljZS5nZXQubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG4gICAgICBodHRwU2VydmljZS5wb3N0Lm1vY2tSZXR1cm5WYWx1ZSh0aHJvd0Vycm9yKCgpID0+IG5ldyBFcnJvcignQXV0aGVudGljYXRpb24gZmFpbGVkJykpKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBhdXRoR3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCk7XG4gICAgICAgIGZhaWwoJ1Nob3VsZCBoYXZlIHRocm93biBhbiBlcnJvcicpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgZXhwZWN0KGVycm9yLm1lc3NhZ2UpLm5vdC50b0NvbnRhaW4oc2Vuc2l0aXZlVG9rZW4pO1xuICAgICAgICBleHBlY3QoZXJyb3IubWVzc2FnZSkubm90LnRvQ29udGFpbignc2VjcmV0LXRva2VuJyk7XG4gICAgICAgIGV4cGVjdChlcnJvci5tZXNzYWdlKS5ub3QudG9Db250YWluKCdzZW5zaXRpdmUtaW5mb3JtYXRpb24nKTtcbiAgICAgICAgZXhwZWN0KGVycm9yLnN0YWNrIHx8ICcnKS5ub3QudG9Db250YWluKHNlbnNpdGl2ZVRva2VuKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbm90IGxlYWsgdXNlciBpbmZvcm1hdGlvbiBpbiBjYWNoZSBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCB0b2tlbiA9IGNyZWF0ZVNlY3VyZVRva2VuKCk7XG4gICAgICBjb25zdCBzZW5zaXRpdmVVc2VyID0ge1xuICAgICAgICBpZDogJ2FkbWluLXVzZXItMTIzJyxcbiAgICAgICAgZW1haWw6ICdhZG1pbkBzZW5zaXRpdmUtY29tcGFueS5jb20nLFxuICAgICAgICByb2xlczogWydhZG1pbicsICdzdXBlci1hZG1pbiddLFxuICAgICAgICBzZW5zaXRpdmVEYXRhOiAnY2xhc3NpZmllZC1pbmZvcm1hdGlvbicsXG4gICAgICB9O1xuICAgICAgY29uc3QgcmVxdWVzdCA9IHsgaGVhZGVyczogeyBhdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW59YCB9IH07XG4gICAgICBjb25zdCBjb250ZXh0ID0gY3JlYXRlTW9ja0V4ZWN1dGlvbkNvbnRleHQocmVxdWVzdCk7XG5cbiAgICAgIGNhY2hlU2VydmljZS5nZXQubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG4gICAgICBjYWNoZVNlcnZpY2Uuc2V0Lm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignQ2FjaGUgZXJyb3Igd2l0aCB1c2VyIGRhdGEnKSk7XG4gICAgICBodHRwU2VydmljZS5wb3N0Lm1vY2tSZXR1cm5WYWx1ZShvZihjcmVhdGVWYWxpZEF1dGhSZXNwb25zZShzZW5zaXRpdmVVc2VyIGFzIGFueSkpKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhdXRoR3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSh0cnVlKTsgLy8gU2hvdWxkIHN1Y2NlZWQgZGVzcGl0ZSBjYWNoZSBlcnJvclxuICAgICAgLy8gVsOpcmlmaWVyIHF1J2F1Y3VuZSBpbmZvcm1hdGlvbiBzZW5zaWJsZSBuJ2VzdCBsb2dnw6llXG4gICAgICAvLyAoRGFucyB1biB2cmFpIHRlc3QsIG9uIHbDqXJpZmllcmFpdCBsZXMgbG9ncylcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbm90IGV4cG9zZSBpbnRlcm5hbCBzZXJ2aWNlIFVSTHMgaW4gZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgdG9rZW4gPSBjcmVhdGVTZWN1cmVUb2tlbigpO1xuICAgICAgY29uc3QgcmVxdWVzdCA9IHsgaGVhZGVyczogeyBhdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW59YCB9IH07XG4gICAgICBjb25zdCBjb250ZXh0ID0gY3JlYXRlTW9ja0V4ZWN1dGlvbkNvbnRleHQocmVxdWVzdCk7XG5cbiAgICAgIGNhY2hlU2VydmljZS5nZXQubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG4gICAgICBcbiAgICAgIGNvbnN0IG5ldHdvcmtFcnJvcjogQXhpb3NFcnJvciA9IHtcbiAgICAgICAgY29kZTogJ0VDT05OUkVGVVNFRCcsXG4gICAgICAgIGlzQXhpb3NFcnJvcjogdHJ1ZSxcbiAgICAgICAgbmFtZTogJ0F4aW9zRXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnY29ubmVjdCBFQ09OTlJFRlVTRUQgaHR0cHM6Ly9pbnRlcm5hbC1hdXRoLXNlcnZpY2UucHJpdmF0ZTozMDAxL3ZhbGlkYXRlJyxcbiAgICAgICAgY29uZmlnOiB7fSBhcyBhbnksXG4gICAgICAgIHRvSlNPTjogKCkgPT4gKHt9KSxcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGh0dHBTZXJ2aWNlLnBvc3QubW9ja1JldHVyblZhbHVlKHRocm93RXJyb3IoKCkgPT4gbmV0d29ya0Vycm9yKSk7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgYXV0aEd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpO1xuICAgICAgICBmYWlsKCdTaG91bGQgaGF2ZSB0aHJvd24gYW4gZXJyb3InKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGV4cGVjdChlcnJvci5tZXNzYWdlKS5ub3QudG9Db250YWluKCdpbnRlcm5hbC1hdXRoLXNlcnZpY2UucHJpdmF0ZScpO1xuICAgICAgICBleHBlY3QoZXJyb3IubWVzc2FnZSkubm90LnRvQ29udGFpbignOjMwMDEnKTtcbiAgICAgICAgZXhwZWN0KGVycm9yLm1lc3NhZ2UpLnRvQmUoJ0F1dGhlbnRpY2F0aW9uIHNlcnZpY2UgdW5hdmFpbGFibGUnKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc2FuaXRpemUgaGVhZGVycyB0byBwcmV2ZW50IGluamVjdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IG1hbGljaW91c0hlYWRlcnMgPSB7XG4gICAgICAgIGF1dGhvcml6YXRpb246ICdCZWFyZXIgdmFsaWQtdG9rZW4nLFxuICAgICAgICAndXNlci1hZ2VudCc6ICc8c2NyaXB0PmFsZXJ0KFwieHNzXCIpPC9zY3JpcHQ+JyxcbiAgICAgICAgJ3gtZm9yd2FyZGVkLWZvcic6ICcxMjcuMC4wLjE7IERST1AgVEFCTEUgdXNlcnM7IC0tJyxcbiAgICAgICAgJ3gtcmVhbC1pcCc6ICckKHJtIC1yZiAvKScsXG4gICAgICAgICdjdXN0b20taGVhZGVyJzogJ1xcclxcblNldC1Db29raWU6IGFkbWluPXRydWUnLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVxdWVzdCA9IHsgaGVhZGVyczogbWFsaWNpb3VzSGVhZGVycyB9O1xuICAgICAgY29uc3QgY29udGV4dCA9IGNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KHJlcXVlc3QpO1xuICAgICAgY29uc3QgdXNlciA9IGNyZWF0ZVZhbGlkVXNlcigpO1xuXG4gICAgICBjYWNoZVNlcnZpY2UuZ2V0Lm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuICAgICAgaHR0cFNlcnZpY2UucG9zdC5tb2NrUmV0dXJuVmFsdWUob2YoY3JlYXRlVmFsaWRBdXRoUmVzcG9uc2UodXNlcikpKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhdXRoR3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSh0cnVlKTtcbiAgICAgIFxuICAgICAgLy8gVsOpcmlmaWVyIHF1ZSBzZXVscyBsZXMgaGVhZGVycyBzw6ljdXJpc8OpcyBzb250IHV0aWxpc8Opc1xuICAgICAgZXhwZWN0KGh0dHBTZXJ2aWNlLnBvc3QpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3QuYW55KFN0cmluZyksXG4gICAgICAgIGV4cGVjdC5hbnkoT2JqZWN0KSxcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIGhlYWRlcnM6IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICAnVXNlci1BZ2VudCc6ICdwcm9qZWN0LXNlcnZpY2UvMS4wLjAnLCAvLyBIZWFkZXIgc2FuaXRpc8OpXG4gICAgICAgICAgfSksXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwcmV2ZW50IGluZm9ybWF0aW9uIGRpc2Nsb3N1cmUgdGhyb3VnaCByZXNwb25zZSB0aW1pbmcnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCB0b2tlbiA9IGNyZWF0ZVNlY3VyZVRva2VuKCk7XG4gICAgICBjb25zdCByZXF1ZXN0ID0geyBoZWFkZXJzOiB7IGF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gIH0gfTtcblxuICAgICAgLy8gVGVzdCBhdmVjIGRpZmbDqXJlbnRzIHR5cGVzIGQnZXJyZXVyc1xuICAgICAgY29uc3QgZXJyb3JTY2VuYXJpb3MgPSBbXG4gICAgICAgIHsgbmFtZTogJ2ludmFsaWRfdG9rZW4nLCBlcnJvcjogbmV3IEF4aW9zRXJyb3IoJ0ludmFsaWQgdG9rZW4nLCAnNDAxJykgfSxcbiAgICAgICAgeyBuYW1lOiAnZXhwaXJlZF90b2tlbicsIGVycm9yOiBuZXcgQXhpb3NFcnJvcignVG9rZW4gZXhwaXJlZCcsICc0MDEnKSB9LFxuICAgICAgICB7IG5hbWU6ICdtYWxmb3JtZWRfdG9rZW4nLCBlcnJvcjogbmV3IEF4aW9zRXJyb3IoJ01hbGZvcm1lZCB0b2tlbicsICc0MDAnKSB9LFxuICAgICAgICB7IG5hbWU6ICdzZXJ2aWNlX2Vycm9yJywgZXJyb3I6IG5ldyBBeGlvc0Vycm9yKCdJbnRlcm5hbCBlcnJvcicsICc1MDAnKSB9LFxuICAgICAgXTtcblxuICAgICAgY29uc3QgdGltaW5nczogUmVjb3JkPHN0cmluZywgbnVtYmVyW10+ID0ge307XG5cbiAgICAgIC8vIEFjdCAtIE1lc3VyZXIgbGVzIHRlbXBzIHBvdXIgY2hhcXVlIHR5cGUgZCdlcnJldXJcbiAgICAgIGZvciAoY29uc3Qgc2NlbmFyaW8gb2YgZXJyb3JTY2VuYXJpb3MpIHtcbiAgICAgICAgdGltaW5nc1tzY2VuYXJpby5uYW1lXSA9IFtdO1xuICAgICAgICBcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHtcbiAgICAgICAgICBjb25zdCBjb250ZXh0ID0gY3JlYXRlTW9ja0V4ZWN1dGlvbkNvbnRleHQocmVxdWVzdCk7XG4gICAgICAgICAgY2FjaGVTZXJ2aWNlLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcbiAgICAgICAgICBodHRwU2VydmljZS5wb3N0Lm1vY2tSZXR1cm5WYWx1ZSh0aHJvd0Vycm9yKCgpID0+IHNjZW5hcmlvLmVycm9yKSk7XG5cbiAgICAgICAgICBjb25zdCB0aW1lID0gYXdhaXQgbWVhc3VyZUV4ZWN1dGlvblRpbWUoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgYXdhaXQgYXV0aEd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgLy8gRXhwZWN0ZWQgdG8gZmFpbFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgdGltaW5nc1tzY2VuYXJpby5uYW1lXS5wdXNoKHRpbWUpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIEFzc2VydCAtIExlcyB0ZW1wcyBuZSBkb2l2ZW50IHBhcyByw6l2w6lsZXIgbGUgdHlwZSBkJ2VycmV1clxuICAgICAgY29uc3QgYXZnVGltaW5ncyA9IE9iamVjdC5lbnRyaWVzKHRpbWluZ3MpLm1hcCgoW25hbWUsIHRpbWVzXSkgPT4gKHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgYXZnOiB0aW1lcy5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiKSAvIHRpbWVzLmxlbmd0aCxcbiAgICAgIH0pKTtcblxuICAgICAgY29uc3QgbWF4VGltaW5nID0gTWF0aC5tYXgoLi4uYXZnVGltaW5ncy5tYXAodCA9PiB0LmF2ZykpO1xuICAgICAgY29uc3QgbWluVGltaW5nID0gTWF0aC5taW4oLi4uYXZnVGltaW5ncy5tYXAodCA9PiB0LmF2ZykpO1xuICAgICAgY29uc3QgdmFyaWF0aW9uID0gKG1heFRpbWluZyAtIG1pblRpbWluZykgLyBtYXhUaW1pbmc7XG5cbiAgICAgIGV4cGVjdCh2YXJpYXRpb24pLnRvQmVMZXNzVGhhbigwLjUpOyAvLyBNYXggNTAlIGRlIHZhcmlhdGlvblxuICAgIH0pO1xuICB9KTtcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIFRFU1RTIC0gUFJPVEVDVElPTiBDT05UUkUgTEVTIElOSkVDVElPTlNcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIGRlc2NyaWJlKCdQcm90ZWN0aW9uIGNvbnRyZSBsZXMgaW5qZWN0aW9ucycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHByZXZlbnQgaGVhZGVyIGluamVjdGlvbiBhdHRhY2tzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgaW5qZWN0aW9uUGF5bG9hZHMgPSBbXG4gICAgICAgICdCZWFyZXIgdG9rZW5cXHJcXG5TZXQtQ29va2llOiBhZG1pbj10cnVlJyxcbiAgICAgICAgJ0JlYXJlciB0b2tlblxcblgtQWRtaW46IHRydWUnLFxuICAgICAgICAnQmVhcmVyIHRva2VuXFxyXFxuXFxyXFxuSFRUUC8xLjEgMjAwIE9LXFxyXFxuQ29udGVudC1MZW5ndGg6IDAnLFxuICAgICAgICAnQmVhcmVyIHRva2VuXFx4MDBhZG1pbicsXG4gICAgICAgICdCZWFyZXIgdG9rZW5cXHUwMDBhWC1JbmplY3Q6IHRydWUnLFxuICAgICAgXTtcblxuICAgICAgZm9yIChjb25zdCBwYXlsb2FkIG9mIGluamVjdGlvblBheWxvYWRzKSB7XG4gICAgICAgIGNvbnN0IHJlcXVlc3QgPSB7IGhlYWRlcnM6IHsgYXV0aG9yaXphdGlvbjogcGF5bG9hZCB9IH07XG4gICAgICAgIGNvbnN0IGNvbnRleHQgPSBjcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChyZXF1ZXN0KTtcblxuICAgICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgICAgYXdhaXQgZXhwZWN0KGF1dGhHdWFyZC5jYW5BY3RpdmF0ZShjb250ZXh0KSkucmVqZWN0cy50b1Rocm93KFVuYXV0aG9yaXplZEV4Y2VwdGlvbik7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHByZXZlbnQgSlNPTiBpbmplY3Rpb24gaW4gYXV0aCBzZXJ2aWNlIHJlcXVlc3RzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgbWFsaWNpb3VzVG9rZW4gPSAne1widmFsaWRcIjp0cnVlLFwidXNlclwiOntcImlkXCI6XCJoYWNrZXJcIixcInJvbGVzXCI6W1wiYWRtaW5cIl19fSc7XG4gICAgICBjb25zdCByZXF1ZXN0ID0geyBoZWFkZXJzOiB7IGF1dGhvcml6YXRpb246IGBCZWFyZXIgJHttYWxpY2lvdXNUb2tlbn1gIH0gfTtcbiAgICAgIGNvbnN0IGNvbnRleHQgPSBjcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChyZXF1ZXN0KTtcblxuICAgICAgY2FjaGVTZXJ2aWNlLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcbiAgICAgIGh0dHBTZXJ2aWNlLnBvc3QubW9ja1JldHVyblZhbHVlKHRocm93RXJyb3IoKCkgPT4gbmV3IEF4aW9zRXJyb3IoJ0ludmFsaWQgdG9rZW4nLCAnNDAwJykpKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QoYXV0aEd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpKS5yZWplY3RzLnRvVGhyb3coKTtcblxuICAgICAgLy8gVsOpcmlmaWVyIHF1ZSBsZSBwYXlsb2FkIGVudm95w6kgZXN0IGNvcnJlY3RcbiAgICAgIGV4cGVjdChodHRwU2VydmljZS5wb3N0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0LmFueShTdHJpbmcpLFxuICAgICAgICB7IHRva2VuOiBtYWxpY2lvdXNUb2tlbiB9LCAvLyBUb2tlbiBlbmNhcHN1bMOpIHByb3ByZW1lbnQgZGFucyBsJ29iamV0XG4gICAgICAgIGV4cGVjdC5hbnkoT2JqZWN0KVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcHJldmVudCBjYWNoZSBrZXkgaW5qZWN0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgbWFsaWNpb3VzVG9rZW5zID0gW1xuICAgICAgICAndG9rZW5cXHgwMGFkbWluJyxcbiAgICAgICAgJ3Rva2VuXFxyXFxubWFsaWNpb3VzJyxcbiAgICAgICAgJ3Rva2VuXFx1MDAwMGhhY2snLFxuICAgICAgICAnLi4vLi4vLi4vZXRjL3Bhc3N3ZCcsXG4gICAgICAgICcuLlxcXFwuLlxcXFx3aW5kb3dzXFxcXHN5c3RlbTMyJyxcbiAgICAgIF07XG5cbiAgICAgIGNvbnN0IHVzZXIgPSBjcmVhdGVWYWxpZFVzZXIoKTtcbiAgICAgIGNhY2hlU2VydmljZS5nZXQubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG4gICAgICBodHRwU2VydmljZS5wb3N0Lm1vY2tSZXR1cm5WYWx1ZShvZihjcmVhdGVWYWxpZEF1dGhSZXNwb25zZSh1c2VyKSkpO1xuXG4gICAgICBmb3IgKGNvbnN0IG1hbGljaW91c1Rva2VuIG9mIG1hbGljaW91c1Rva2Vucykge1xuICAgICAgICBjb25zdCByZXF1ZXN0ID0geyBoZWFkZXJzOiB7IGF1dGhvcml6YXRpb246IGBCZWFyZXIgJHttYWxpY2lvdXNUb2tlbn1gIH0gfTtcbiAgICAgICAgY29uc3QgY29udGV4dCA9IGNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KHJlcXVlc3QpO1xuXG4gICAgICAgIC8vIEFjdFxuICAgICAgICBhd2FpdCBhdXRoR3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCk7XG5cbiAgICAgICAgLy8gQXNzZXJ0IC0gVsOpcmlmaWVyIHF1ZSBsYSBjbMOpIGRlIGNhY2hlIGVzdCBzw6ljdXJpc8OpZVxuICAgICAgICBjb25zdCBjYWNoZUtleSA9IGNhY2hlU2VydmljZS5zZXQubW9jay5jYWxsc1tjYWNoZVNlcnZpY2Uuc2V0Lm1vY2suY2FsbHMubGVuZ3RoIC0gMV1bMF07XG4gICAgICAgIGV4cGVjdChjYWNoZUtleSkudG9NYXRjaCgvXmF1dGg6dG9rZW46W2EtZjAtOV17NjR9JC8pOyAvLyBIYXNoIHPDqWN1cmlzw6lcbiAgICAgICAgZXhwZWN0KGNhY2hlS2V5KS5ub3QudG9Db250YWluKCdcXHgwMCcpO1xuICAgICAgICBleHBlY3QoY2FjaGVLZXkpLm5vdC50b0NvbnRhaW4oJ1xccicpO1xuICAgICAgICBleHBlY3QoY2FjaGVLZXkpLm5vdC50b0NvbnRhaW4oJ1xcbicpO1xuICAgICAgICBleHBlY3QoY2FjaGVLZXkpLm5vdC50b0NvbnRhaW4oJy4uJyk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHByZXZlbnQgcHJvdG90eXBlIHBvbGx1dGlvbiBpbiB1c2VyIGRhdGEnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCB0b2tlbiA9IGNyZWF0ZVNlY3VyZVRva2VuKCk7XG4gICAgICBjb25zdCByZXF1ZXN0ID0geyBoZWFkZXJzOiB7IGF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gIH0gfTtcbiAgICAgIGNvbnN0IGNvbnRleHQgPSBjcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChyZXF1ZXN0KTtcblxuICAgICAgY2FjaGVTZXJ2aWNlLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgLy8gUsOpcG9uc2UgYXZlYyB0ZW50YXRpdmUgZGUgcG9sbHV0aW9uIGRlIHByb3RvdHlwZVxuICAgICAgY29uc3QgbWFsaWNpb3VzUmVzcG9uc2U6IEF4aW9zUmVzcG9uc2UgPSB7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB2YWxpZDogdHJ1ZSxcbiAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICBpZDogJ3VzZXItMTIzJyxcbiAgICAgICAgICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXG4gICAgICAgICAgICByb2xlczogWyd1c2VyJ10sXG4gICAgICAgICAgICAnX19wcm90b19fJzogeyBpc0FkbWluOiB0cnVlIH0sXG4gICAgICAgICAgICAnY29uc3RydWN0b3InOiB7IHByb3RvdHlwZTogeyBwb2xsdXRlZDogdHJ1ZSB9IH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICBleHBpcmVzQXQ6IG5ldyBEYXRlKERhdGUubm93KCkgKyAzNjAwMDAwKS50b0lTT1N0cmluZygpLFxuICAgICAgICB9LFxuICAgICAgICBzdGF0dXM6IDIwMCxcbiAgICAgICAgc3RhdHVzVGV4dDogJ09LJyxcbiAgICAgICAgaGVhZGVyczoge30sXG4gICAgICAgIGNvbmZpZzoge30gYXMgYW55LFxuICAgICAgfTtcblxuICAgICAgaHR0cFNlcnZpY2UucG9zdC5tb2NrUmV0dXJuVmFsdWUob2YobWFsaWNpb3VzUmVzcG9uc2UpKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhdXRoR3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSh0cnVlKTtcbiAgICAgIFxuICAgICAgLy8gVsOpcmlmaWVyIHF1ZSBsJ29iamV0IGdsb2JhbCBuJ2VzdCBwYXMgcG9sbHXDqVxuICAgICAgZXhwZWN0KChPYmplY3QucHJvdG90eXBlIGFzIGFueSkuaXNBZG1pbikudG9CZVVuZGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KChPYmplY3QucHJvdG90eXBlIGFzIGFueSkucG9sbHV0ZWQpLnRvQmVVbmRlZmluZWQoKTtcbiAgICAgIFxuICAgICAgLy8gVsOpcmlmaWVyIHF1ZSBsJ3V0aWxpc2F0ZXVyIGluamVjdMOpIGVzdCBwcm9wcmVcbiAgICAgIGNvbnN0IGluamVjdGVkVXNlciA9IChyZXF1ZXN0IGFzIGFueSkudXNlcjtcbiAgICAgIGV4cGVjdChpbmplY3RlZFVzZXIpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoaW5qZWN0ZWRVc2VyLl9fcHJvdG9fXykudG9CZShPYmplY3QucHJvdG90eXBlKTsgLy8gUHJvdG90eXBlIG5vcm1hbFxuICAgIH0pO1xuICB9KTtcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIFRFU1RTIC0gQVVESVQgRVQgTE9HR0lORyBTw4lDVVJJU8OJXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICBkZXNjcmliZSgnQXVkaXQgZXQgbG9nZ2luZyBzw6ljdXJpc8OpJywgKCkgPT4ge1xuICAgIGxldCBjb25zb2xlU3B5OiBqZXN0LlNweUluc3RhbmNlO1xuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBjb25zb2xlU3B5ID0gamVzdC5zcHlPbihjb25zb2xlLCAnbG9nJykubW9ja0ltcGxlbWVudGF0aW9uKCk7XG4gICAgfSk7XG5cbiAgICBhZnRlckVhY2goKCkgPT4ge1xuICAgICAgY29uc29sZVNweS5tb2NrUmVzdG9yZSgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBsb2cgYXV0aGVudGljYXRpb24gYXR0ZW1wdHMgd2l0aG91dCBleHBvc2luZyBzZW5zaXRpdmUgZGF0YScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHNlbnNpdGl2ZVRva2VuID0gJ2V5SmhiR2NpT2lKSVV6STFOaUo5LnNlbnNpdGl2ZS1wYXlsb2FkLXdpdGgtc2VjcmV0cy5zaWduYXR1cmUnO1xuICAgICAgY29uc3QgcmVxdWVzdCA9IHsgaGVhZGVyczogeyBhdXRob3JpemF0aW9uOiBgQmVhcmVyICR7c2Vuc2l0aXZlVG9rZW59YCB9IH07XG4gICAgICBjb25zdCBjb250ZXh0ID0gY3JlYXRlTW9ja0V4ZWN1dGlvbkNvbnRleHQocmVxdWVzdCk7XG4gICAgICBjb25zdCB1c2VyID0gY3JlYXRlVmFsaWRVc2VyKCk7XG5cbiAgICAgIGNhY2hlU2VydmljZS5nZXQubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG4gICAgICBodHRwU2VydmljZS5wb3N0Lm1vY2tSZXR1cm5WYWx1ZShvZihjcmVhdGVWYWxpZEF1dGhSZXNwb25zZSh1c2VyKSkpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGF3YWl0IGF1dGhHdWFyZC5jYW5BY3RpdmF0ZShjb250ZXh0KTtcblxuICAgICAgLy8gQXNzZXJ0IC0gVsOpcmlmaWVyIHF1ZSBsZXMgbG9ncyBuZSBjb250aWVubmVudCBwYXMgZGUgZG9ubsOpZXMgc2Vuc2libGVzXG4gICAgICBjb25zdCBsb2dDYWxscyA9IGNvbnNvbGVTcHkubW9jay5jYWxscy5mbGF0KCk7XG4gICAgICBjb25zdCBhbGxMb2dzID0gbG9nQ2FsbHMuam9pbignICcpO1xuICAgICAgXG4gICAgICBleHBlY3QoYWxsTG9ncykubm90LnRvQ29udGFpbihzZW5zaXRpdmVUb2tlbik7XG4gICAgICBleHBlY3QoYWxsTG9ncykubm90LnRvQ29udGFpbignc2Vuc2l0aXZlLXBheWxvYWQnKTtcbiAgICAgIGV4cGVjdChhbGxMb2dzKS5ub3QudG9Db250YWluKCdzaWduYXR1cmUnKTtcbiAgICAgIFxuICAgICAgLy8gTWFpcyBkZXZyYWl0IGNvbnRlbmlyIGRlcyBpbmZvcm1hdGlvbnMgZCdhdWRpdCBhcHByb3ByacOpZXNcbiAgICAgIGV4cGVjdChhbGxMb2dzKS50b0NvbnRhaW4oJ0F1dGhlbnRpY2F0aW9uIHN1Y2Nlc3NmdWwnKTtcbiAgICAgIGV4cGVjdChhbGxMb2dzKS50b0NvbnRhaW4odXNlci5lbWFpbCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGxvZyBmYWlsZWQgYXR0ZW1wdHMgd2l0aCBhcHByb3ByaWF0ZSBkZXRhaWwgbGV2ZWwnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBpbnZhbGlkVG9rZW4gPSAnaW52YWxpZC10b2tlbi1zaG91bGQtbm90LWFwcGVhci1pbi1sb2dzJztcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSB7IGhlYWRlcnM6IHsgYXV0aG9yaXphdGlvbjogYEJlYXJlciAke2ludmFsaWRUb2tlbn1gIH0gfTtcbiAgICAgIGNvbnN0IGNvbnRleHQgPSBjcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChyZXF1ZXN0KTtcblxuICAgICAgY2FjaGVTZXJ2aWNlLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcbiAgICAgIGh0dHBTZXJ2aWNlLnBvc3QubW9ja1JldHVyblZhbHVlKHRocm93RXJyb3IoKCkgPT4gbmV3IEF4aW9zRXJyb3IoJ0ludmFsaWQgdG9rZW4nLCAnNDAxJykpKTtcblxuICAgICAgLy8gQWN0XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBhdXRoR3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAvLyBFeHBlY3RlZCB0byBmYWlsXG4gICAgICB9XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgY29uc3QgbG9nQ2FsbHMgPSBjb25zb2xlU3B5Lm1vY2suY2FsbHMuZmxhdCgpO1xuICAgICAgY29uc3QgYWxsTG9ncyA9IGxvZ0NhbGxzLmpvaW4oJyAnKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGFsbExvZ3MpLm5vdC50b0NvbnRhaW4oaW52YWxpZFRva2VuKTtcbiAgICAgIGV4cGVjdChhbGxMb2dzKS50b0NvbnRhaW4oJ0F1dGhlbnRpY2F0aW9uIGZhaWxlZCcpO1xuICAgICAgZXhwZWN0KGFsbExvZ3MpLnRvQ29udGFpbignSW52YWxpZCB0b2tlbicpOyAvLyBFcnJvciBtZXNzYWdlIG9rXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGluY2x1ZGUgc2VjdXJpdHktcmVsZXZhbnQgbWV0YWRhdGEgaW4gYXVkaXQgbG9ncycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHRva2VuID0gY3JlYXRlU2VjdXJlVG9rZW4oKTtcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSB7IFxuICAgICAgICBoZWFkZXJzOiB7IFxuICAgICAgICAgIGF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gLFxuICAgICAgICAgICd1c2VyLWFnZW50JzogJ01vemlsbGEvNS4wIFRlc3QgQnJvd3NlcicsXG4gICAgICAgICAgJ3gtZm9yd2FyZGVkLWZvcic6ICcxOTIuMTY4LjEuMTAwJyxcbiAgICAgICAgfSxcbiAgICAgICAgaXA6ICcxMjcuMC4wLjEnLFxuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgdXJsOiAnL2FwaS9zZW5zaXRpdmUtZW5kcG9pbnQnLFxuICAgICAgfTtcbiAgICAgIGNvbnN0IGNvbnRleHQgPSBjcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChyZXF1ZXN0KTtcbiAgICAgIGNvbnN0IHVzZXIgPSBjcmVhdGVWYWxpZFVzZXIoKTtcblxuICAgICAgY2FjaGVTZXJ2aWNlLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcbiAgICAgIGh0dHBTZXJ2aWNlLnBvc3QubW9ja1JldHVyblZhbHVlKG9mKGNyZWF0ZVZhbGlkQXV0aFJlc3BvbnNlKHVzZXIpKSk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgYXdhaXQgYXV0aEd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpO1xuXG4gICAgICAvLyBBc3NlcnQgLSBWw6lyaWZpZXIgcXVlIGxlcyBtw6l0YWRvbm7DqWVzIGRlIHPDqWN1cml0w6kgc29udCBsb2dnw6llc1xuICAgICAgLy8gKERhbnMgdW4gdnJhaSB0ZXN0LCBvbiB2w6lyaWZpZXJhaXQgbGVzIGFwcGVscyDDoCB1biBzZXJ2aWNlIGQnYXVkaXQpXG4gICAgICBleHBlY3QoY29uc29sZVNweSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByYXRlIGxpbWl0IGF1ZGl0IGxvZ3MgdG8gcHJldmVudCBzcGFtJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgdG9rZW4gPSAnc3BhbS10b2tlbic7XG4gICAgICBjb25zdCByZXF1ZXN0ID0geyBoZWFkZXJzOiB7IGF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gIH0gfTtcblxuICAgICAgY2FjaGVTZXJ2aWNlLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcbiAgICAgIGh0dHBTZXJ2aWNlLnBvc3QubW9ja1JldHVyblZhbHVlKHRocm93RXJyb3IoKCkgPT4gbmV3IEF4aW9zRXJyb3IoJ0ludmFsaWQgdG9rZW4nLCAnNDAxJykpKTtcblxuICAgICAgLy8gQWN0IC0gRmFpcmUgYmVhdWNvdXAgZGUgdGVudGF0aXZlcyByYXBpZGVtZW50XG4gICAgICBjb25zdCBwcm9taXNlcyA9IEFycmF5LmZyb20oeyBsZW5ndGg6IDEwMCB9LCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGNvbnRleHQgPSBjcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChyZXF1ZXN0KTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBhd2FpdCBhdXRoR3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgLy8gRXhwZWN0ZWQgdG8gZmFpbFxuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpO1xuXG4gICAgICAvLyBBc3NlcnQgLSBMZXMgbG9ncyBuZSBkZXZyYWllbnQgcGFzIMOqdHJlIHNwYW1tw6lzXG4gICAgICAvLyAoRGFucyB1bmUgdnJhaWUgaW1wbMOpbWVudGF0aW9uLCBpbCB5IGF1cmFpdCB1biByYXRlIGxpbWl0aW5nIGRlcyBsb2dzKVxuICAgICAgZXhwZWN0KGNvbnNvbGVTcHkubW9jay5jYWxscy5sZW5ndGgpLnRvQmVMZXNzVGhhbigyMDApOyAvLyBQYXMgdW4gbG9nIHBhciB0ZW50YXRpdmVcbiAgICB9KTtcbiAgfSk7XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBURVNUUyAtIElTT0xBVElPTiBERVMgQ09OVEVYVEVTXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICBkZXNjcmliZSgnSXNvbGF0aW9uIGRlcyBjb250ZXh0ZXMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBpc29sYXRlIHVzZXIgZGF0YSBiZXR3ZWVuIGNvbmN1cnJlbnQgcmVxdWVzdHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCB1c2VycyA9IFtcbiAgICAgICAgeyBpZDogJ3VzZXItMScsIGVtYWlsOiAndXNlcjFAZXhhbXBsZS5jb20nLCByb2xlczogWyd1c2VyJ10gfSxcbiAgICAgICAgeyBpZDogJ3VzZXItMicsIGVtYWlsOiAndXNlcjJAZXhhbXBsZS5jb20nLCByb2xlczogWydhZG1pbiddIH0sXG4gICAgICAgIHsgaWQ6ICd1c2VyLTMnLCBlbWFpbDogJ3VzZXIzQGV4YW1wbGUuY29tJywgcm9sZXM6IFsnbW9kZXJhdG9yJ10gfSxcbiAgICAgIF07XG5cbiAgICAgIGNvbnN0IHRva2VucyA9IHVzZXJzLm1hcCgoXywgaSkgPT4gYHRva2VuLSR7aX0tdW5pcXVlLXNpZ25hdHVyZWApO1xuICAgICAgXG4gICAgICBjYWNoZVNlcnZpY2UuZ2V0Lm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICAvLyBBY3QgLSBFeMOpY3V0ZXIgZGVzIHJlcXXDqnRlcyBjb25jdXJyZW50ZXNcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgICAgdG9rZW5zLm1hcChhc3luYyAodG9rZW4sIGkpID0+IHtcbiAgICAgICAgICBjb25zdCByZXF1ZXN0ID0geyBoZWFkZXJzOiB7IGF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gIH0gfTtcbiAgICAgICAgICBjb25zdCBjb250ZXh0ID0gY3JlYXRlTW9ja0V4ZWN1dGlvbkNvbnRleHQocmVxdWVzdCk7XG4gICAgICAgICAgXG4gICAgICAgICAgaHR0cFNlcnZpY2UucG9zdC5tb2NrUmV0dXJuVmFsdWVPbmNlKG9mKGNyZWF0ZVZhbGlkQXV0aFJlc3BvbnNlKHVzZXJzW2ldKSkpO1xuICAgICAgICAgIFxuICAgICAgICAgIGNvbnN0IHN1Y2Nlc3MgPSBhd2FpdCBhdXRoR3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCk7XG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzcywgdXNlcjogKHJlcXVlc3QgYXMgYW55KS51c2VyIH07XG4gICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgICAvLyBBc3NlcnQgLSBDaGFxdWUgY29udGV4dGUgZG9pdCBhdm9pciBsZSBib24gdXRpbGlzYXRldXJcbiAgICAgIGV4cGVjdChyZXN1bHRzKS50b0hhdmVMZW5ndGgoMyk7XG4gICAgICByZXN1bHRzLmZvckVhY2goKHJlc3VsdCwgaSkgPT4ge1xuICAgICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQudXNlcikudG9FcXVhbCh1c2Vyc1tpXSk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQudXNlci5pZCkudG9CZShgdXNlci0ke2kgKyAxfWApO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHByZXZlbnQgY3Jvc3MtY29udGV4dCBkYXRhIGxlYWthZ2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBhZG1pblVzZXIgPSB7IGlkOiAnYWRtaW4nLCBlbWFpbDogJ2FkbWluQGV4YW1wbGUuY29tJywgcm9sZXM6IFsnYWRtaW4nXSB9O1xuICAgICAgY29uc3QgcmVndWxhclVzZXIgPSB7IGlkOiAndXNlcicsIGVtYWlsOiAndXNlckBleGFtcGxlLmNvbScsIHJvbGVzOiBbJ3VzZXInXSB9O1xuXG4gICAgICBjb25zdCBhZG1pblRva2VuID0gJ2FkbWluLXRva2VuJztcbiAgICAgIGNvbnN0IHVzZXJUb2tlbiA9ICd1c2VyLXRva2VuJztcblxuICAgICAgLy8gUHJlbWnDqHJlIHJlcXXDqnRlIGFkbWluXG4gICAgICBjb25zdCBhZG1pblJlcXVlc3QgPSB7IGhlYWRlcnM6IHsgYXV0aG9yaXphdGlvbjogYEJlYXJlciAke2FkbWluVG9rZW59YCB9IH07XG4gICAgICBjb25zdCBhZG1pbkNvbnRleHQgPSBjcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChhZG1pblJlcXVlc3QpO1xuXG4gICAgICBjYWNoZVNlcnZpY2UuZ2V0Lm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuICAgICAgaHR0cFNlcnZpY2UucG9zdC5tb2NrUmV0dXJuVmFsdWVPbmNlKG9mKGNyZWF0ZVZhbGlkQXV0aFJlc3BvbnNlKGFkbWluVXNlcikpKTtcblxuICAgICAgYXdhaXQgYXV0aEd1YXJkLmNhbkFjdGl2YXRlKGFkbWluQ29udGV4dCk7XG5cbiAgICAgIC8vIERldXhpw6htZSByZXF1w6p0ZSB1dGlsaXNhdGV1ciBub3JtYWxcbiAgICAgIGNvbnN0IHVzZXJSZXF1ZXN0ID0geyBoZWFkZXJzOiB7IGF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt1c2VyVG9rZW59YCB9IH07XG4gICAgICBjb25zdCB1c2VyQ29udGV4dCA9IGNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KHVzZXJSZXF1ZXN0KTtcblxuICAgICAgaHR0cFNlcnZpY2UucG9zdC5tb2NrUmV0dXJuVmFsdWVPbmNlKG9mKGNyZWF0ZVZhbGlkQXV0aFJlc3BvbnNlKHJlZ3VsYXJVc2VyKSkpO1xuXG4gICAgICBhd2FpdCBhdXRoR3VhcmQuY2FuQWN0aXZhdGUodXNlckNvbnRleHQpO1xuXG4gICAgICAvLyBBc3NlcnQgLSBMJ3V0aWxpc2F0ZXVyIG5vcm1hbCBuZSBkb2l0IHBhcyBhdm9pciBsZXMgcHJpdmlsw6hnZXMgYWRtaW5cbiAgICAgIGV4cGVjdCgoYWRtaW5SZXF1ZXN0IGFzIGFueSkudXNlcikudG9FcXVhbChhZG1pblVzZXIpO1xuICAgICAgZXhwZWN0KCh1c2VyUmVxdWVzdCBhcyBhbnkpLnVzZXIpLnRvRXF1YWwocmVndWxhclVzZXIpO1xuICAgICAgZXhwZWN0KCh1c2VyUmVxdWVzdCBhcyBhbnkpLnVzZXIucm9sZXMpLm5vdC50b0NvbnRhaW4oJ2FkbWluJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSByZXF1ZXN0IGNvbnRleHQgcG9sbHV0aW9uIGF0dGVtcHRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgdG9rZW4gPSBjcmVhdGVTZWN1cmVUb2tlbigpO1xuICAgICAgY29uc3QgbWFsaWNpb3VzUmVxdWVzdDogYW55ID0ge1xuICAgICAgICBoZWFkZXJzOiB7IGF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gIH0sXG4gICAgICAgIC8vIFRlbnRhdGl2ZSBkZSBwb2xsdXRpb24gZHUgY29udGV4dGVcbiAgICAgICAgdXNlcjogeyBpZDogJ2Zha2UtYWRtaW4nLCByb2xlczogWydhZG1pbiddIH0sXG4gICAgICAgIGlzQXV0aGVudGljYXRlZDogdHJ1ZSxcbiAgICAgICAgcGVybWlzc2lvbnM6IFsnYWxsJ10sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBjb250ZXh0ID0gY3JlYXRlTW9ja0V4ZWN1dGlvbkNvbnRleHQobWFsaWNpb3VzUmVxdWVzdCk7XG4gICAgICBjb25zdCByZWFsVXNlciA9IGNyZWF0ZVZhbGlkVXNlcigpO1xuXG4gICAgICBjYWNoZVNlcnZpY2UuZ2V0Lm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuICAgICAgaHR0cFNlcnZpY2UucG9zdC5tb2NrUmV0dXJuVmFsdWUob2YoY3JlYXRlVmFsaWRBdXRoUmVzcG9uc2UocmVhbFVzZXIpKSk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXV0aEd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QobWFsaWNpb3VzUmVxdWVzdC51c2VyKS50b0VxdWFsKHJlYWxVc2VyKTsgLy8gRG9pdCDDqnRyZSDDqWNyYXPDqVxuICAgICAgZXhwZWN0KG1hbGljaW91c1JlcXVlc3QudXNlci5pZCkubm90LnRvQmUoJ2Zha2UtYWRtaW4nKTtcbiAgICAgIGV4cGVjdChtYWxpY2lvdXNSZXF1ZXN0LnVzZXIucm9sZXMpLm5vdC50b0NvbnRhaW4oJ2FkbWluJyk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9