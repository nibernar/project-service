02f1886786e71ddf3cbf3375fff48a09
"use strict";
// test/setup/auth-guard-test-setup.ts
Object.defineProperty(exports, "__esModule", { value: true });
require("reflect-metadata");
// ============================================================================
// CONFIGURATION GLOBALE DES TESTS AUTHGUARD
// ============================================================================
// Configuration des timeouts pour les tests longs
jest.setTimeout(30000);
// Configuration des variables d'environnement pour les tests
process.env.NODE_ENV = 'test';
process.env.AUTH_SERVICE_URL = 'http://localhost:3001';
process.env.AUTH_SERVICE_TIMEOUT = '5000';
process.env.AUTH_CACHE_TTL = '300';
process.env.REDIS_HOST = 'localhost';
process.env.REDIS_PORT = '6379';
// ============================================================================
// MOCKS GLOBAUX
// ============================================================================
// Mock global pour les m√©triques de performance
global.recordPerformanceMetric = jest.fn((name, value, metadata) => {
    // Stocker les m√©triques pour analyse
    if (!global.performanceMetrics) {
        global.performanceMetrics = [];
    }
    global.performanceMetrics.push({
        name,
        value,
        metadata,
        timestamp: Date.now(),
    });
});
// Mock global pour le garbage collector (si disponible)
if (typeof global.gc === 'undefined') {
    global.gc = jest.fn();
}
// ============================================================================
// HELPERS GLOBAUX POUR LES TESTS
// ============================================================================
// Helper pour cr√©er des tokens de test valides
global.createTestToken = (payload = {}) => {
    const header = { alg: 'HS256', typ: 'JWT' };
    const defaultPayload = {
        sub: 'test-user-123',
        email: 'test@example.com',
        roles: ['user'],
        iat: Math.floor(Date.now() / 1000),
        exp: Math.floor(Date.now() / 1000) + 3600,
        ...payload,
    };
    const headerEncoded = Buffer.from(JSON.stringify(header)).toString('base64url');
    const payloadEncoded = Buffer.from(JSON.stringify(defaultPayload)).toString('base64url');
    const signature = 'test-signature';
    return `${headerEncoded}.${payloadEncoded}.${signature}`;
};
// Helper pour cr√©er des utilisateurs de test
global.createTestUser = (overrides = {}) => ({
    id: 'test-user-123',
    email: 'test@example.com',
    roles: ['user'],
    ...overrides,
});
// Helper pour cr√©er des r√©ponses d'authentification de test
global.createTestAuthResponse = (user = global.createTestUser()) => ({
    data: {
        valid: true,
        user: {
            id: user.id,
            email: user.email,
            roles: user.roles,
        },
        expiresAt: new Date(Date.now() + 3600000).toISOString(),
    },
    status: 200,
    statusText: 'OK',
    headers: {},
    config: {},
});
// Helper pour mesurer les performances
global.measurePerformance = async (fn) => {
    const startTime = process.hrtime.bigint();
    const startMemory = process.memoryUsage();
    const result = await fn();
    const endTime = process.hrtime.bigint();
    const endMemory = process.memoryUsage();
    const duration = Number(endTime - startTime) / 1000000; // Convert to milliseconds
    const memory = {
        heapUsed: endMemory.heapUsed - startMemory.heapUsed,
        heapTotal: endMemory.heapTotal - startMemory.heapTotal,
        external: endMemory.external - startMemory.external,
    };
    return { result, duration, memory };
};
// Helper pour attendre de mani√®re asynchrone
global.waitFor = (ms) => {
    return new Promise(resolve => setTimeout(resolve, ms));
};
// Helper pour cr√©er des mocks de ExecutionContext
global.createMockExecutionContext = (request) => ({
    switchToHttp: () => ({
        getRequest: () => request,
        getResponse: jest.fn(),
        getNext: jest.fn(),
    }),
    switchToRpc: jest.fn(),
    switchToWs: jest.fn(),
    getType: () => 'http',
    getClass: jest.fn(),
    getHandler: jest.fn(),
    getArgs: jest.fn(),
    getArgByIndex: jest.fn(),
});
// ============================================================================
// CONFIGURATION DES ERREURS NON CAPTUR√âES
// ============================================================================
// Gestionnaire pour les rejections non g√©r√©es
const unhandledRejections = new Set();
process.on('unhandledRejection', (reason, promise) => {
    unhandledRejections.add(promise);
    console.error('Unhandled Rejection at:', promise, 'reason:', reason);
});
process.on('rejectionHandled', (promise) => {
    unhandledRejections.delete(promise);
});
// V√©rifier qu'il n'y a pas de rejections non g√©r√©es apr√®s chaque test
afterEach(() => {
    if (unhandledRejections.size > 0) {
        console.warn(`Warning: ${unhandledRejections.size} unhandled promise rejections detected`);
        unhandledRejections.clear();
    }
});
// ============================================================================
// CONFIGURATION DES MOCKS AXIOS
// ============================================================================
// Mock global pour les erreurs Axios communes
global.createAxiosError = (message, code, status) => {
    const error = new Error(message);
    error.isAxiosError = true;
    error.code = code;
    error.response = status ? {
        status,
        statusText: message,
        data: { error: message },
        headers: {},
        config: {},
    } : undefined;
    return error;
};
// ============================================================================
// CONFIGURATION DU NETTOYAGE
// ============================================================================
// Nettoyage apr√®s chaque test
afterEach(async () => {
    // Nettoyer les m√©triques de performance
    if (global.performanceMetrics) {
        global.performanceMetrics = [];
    }
    // Forcer le garbage collection si disponible
    if (global.gc && typeof global.gc === 'function') {
        global.gc();
    }
    // Nettoyer les variables d'environnement modifi√©es
    process.env.NODE_ENV = 'test';
    // Attendre un peu pour permettre aux op√©rations asynchrones de se terminer
    await new Promise(resolve => setImmediate(resolve));
});
// Nettoyage apr√®s tous les tests
afterAll(async () => {
    // Nettoyer les listeners d'√©v√©nements
    process.removeAllListeners('unhandledRejection');
    process.removeAllListeners('rejectionHandled');
    // Attendre que toutes les promesses en attente se terminent
    await new Promise(resolve => setTimeout(resolve, 100));
});
// ============================================================================
// CONFIGURATION DES MATCHERS JEST PERSONNALIS√âS
// ============================================================================
// Matcher personnalis√© pour v√©rifier les tokens JWT
expect.extend({
    toBeValidJWTFormat(received) {
        const jwtRegex = /^[A-Za-z0-9_-]+\.[A-Za-z0-9_-]+\.[A-Za-z0-9_-]+$/;
        const pass = typeof received === 'string' && jwtRegex.test(received);
        if (pass) {
            return {
                message: () => `expected ${received} not to be a valid JWT format`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `expected ${received} to be a valid JWT format`,
                pass: false,
            };
        }
    },
});
// Matcher personnalis√© pour v√©rifier les cl√©s de cache
expect.extend({
    toBeValidCacheKey(received) {
        const cacheKeyRegex = /^auth:token:[a-f0-9]{64}$/;
        const pass = typeof received === 'string' && cacheKeyRegex.test(received);
        if (pass) {
            return {
                message: () => `expected ${received} not to be a valid cache key format`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `expected ${received} to be a valid cache key format (auth:token:[64-char-hex])`,
                pass: false,
            };
        }
    },
});
// Matcher personnalis√© pour v√©rifier les performances
expect.extend({
    toBeWithinPerformanceThreshold(received, threshold) {
        const pass = received <= threshold;
        if (pass) {
            return {
                message: () => `expected ${received}ms to exceed performance threshold of ${threshold}ms`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `expected ${received}ms to be within performance threshold of ${threshold}ms`,
                pass: false,
            };
        }
    },
});
// Matcher personnalis√© pour v√©rifier les objets User
expect.extend({
    toBeValidUser(received) {
        const isValid = received &&
            typeof received.id === 'string' &&
            typeof received.email === 'string' &&
            Array.isArray(received.roles) &&
            received.id.length > 0 &&
            received.email.includes('@') &&
            received.roles.every((role) => typeof role === 'string');
        if (isValid) {
            return {
                message: () => `expected ${JSON.stringify(received)} not to be a valid user object`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `expected ${JSON.stringify(received)} to be a valid user object with id, email, and roles`,
                pass: false,
            };
        }
    },
});
// ============================================================================
// CONFIGURATION DES LOGS DE TEST
// ============================================================================
// Configuration du niveau de log pour les tests
const originalConsoleLog = console.log;
const originalConsoleError = console.error;
const originalConsoleWarn = console.warn;
// Filtrer les logs pendant les tests sauf si explicitement activ√©s
if (!process.env.JEST_VERBOSE_LOGS) {
    console.log = (...args) => {
        if (args[0]?.includes && (args[0].includes('TEST_LOG') || args[0].includes('üìä'))) {
            originalConsoleLog(...args);
        }
    };
    console.error = (...args) => {
        if (args[0]?.includes && args[0].includes('TEST_ERROR')) {
            originalConsoleError(...args);
        }
    };
    console.warn = (...args) => {
        if (args[0]?.includes && args[0].includes('TEST_WARN')) {
            originalConsoleWarn(...args);
        }
    };
}
// Restaurer les logs apr√®s les tests
afterAll(() => {
    console.log = originalConsoleLog;
    console.error = originalConsoleError;
    console.warn = originalConsoleWarn;
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL25pY29sYXNiZXJuYXJkL0Rlc2t0b3AvcHJvamVjdC1zZXJ2aWNlL3Rlc3Qvc2V0dXAvYXV0aC1ndWFyZC10ZXN0LXNldHVwLnRzIiwibWFwcGluZ3MiOiI7QUFBQSxzQ0FBc0M7O0FBRXRDLDRCQUEwQjtBQUUxQiwrRUFBK0U7QUFDL0UsNENBQTRDO0FBQzVDLCtFQUErRTtBQUUvRSxrREFBa0Q7QUFDbEQsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUV2Qiw2REFBNkQ7QUFDN0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEdBQUcsTUFBTSxDQUFDO0FBQzlCLE9BQU8sQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEdBQUcsdUJBQXVCLENBQUM7QUFDdkQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsR0FBRyxNQUFNLENBQUM7QUFDMUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFjLEdBQUcsS0FBSyxDQUFDO0FBQ25DLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxHQUFHLFdBQVcsQ0FBQztBQUNyQyxPQUFPLENBQUMsR0FBRyxDQUFDLFVBQVUsR0FBRyxNQUFNLENBQUM7QUFFaEMsK0VBQStFO0FBQy9FLGdCQUFnQjtBQUNoQiwrRUFBK0U7QUFFL0UsZ0RBQWdEO0FBQ2hELE1BQU0sQ0FBQyx1QkFBdUIsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBWSxFQUFFLEtBQVUsRUFBRSxRQUFjLEVBQUUsRUFBRTtJQUNwRixxQ0FBcUM7SUFDckMsSUFBSSxDQUFFLE1BQWMsQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO1FBQ3ZDLE1BQWMsQ0FBQyxrQkFBa0IsR0FBRyxFQUFFLENBQUM7SUFDMUMsQ0FBQztJQUNBLE1BQWMsQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUM7UUFDdEMsSUFBSTtRQUNKLEtBQUs7UUFDTCxRQUFRO1FBQ1IsU0FBUyxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUU7S0FDdEIsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENB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LENBQUMsQ0FBQyxDQUFDLEVBQUUsUUFBUSxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQztZQUN4RCxvQkFBb0IsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDO1FBQ2hDLENBQUM7SUFDSCxDQUFDLENBQUM7SUFFRixPQUFPLENBQUMsSUFBSSxHQUFHLENBQUMsR0FBRyxJQUFJLEVBQUUsRUFBRTtRQUN6QixJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxRQUFRLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDO1lBQ3ZELG1CQUFtQixDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7UUFDL0IsQ0FBQztJQUNILENBQUMsQ0FBQztBQUNKLENBQUM7QUFFRCxxQ0FBcUM7QUFDckMsUUFBUSxDQUFDLEdBQUcsRUFBRTtJQUNaLE9BQU8sQ0FBQyxHQUFHLEdBQUcsa0JBQWtCLENBQUM7SUFDakMsT0FBTyxDQUFDLEtBQUssR0FBRyxvQkFBb0IsQ0FBQztJQUNyQyxPQUFPLENBQUMsSUFBSSxHQUFHLG1CQUFtQixDQUFDO0FBQ3JDLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaWNvbGFzYmVybmFyZC9EZXNrdG9wL3Byb2plY3Qtc2VydmljZS90ZXN0L3NldHVwL2F1dGgtZ3VhcmQtdGVzdC1zZXR1cC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyB0ZXN0L3NldHVwL2F1dGgtZ3VhcmQtdGVzdC1zZXR1cC50c1xuXG5pbXBvcnQgJ3JlZmxlY3QtbWV0YWRhdGEnO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBDT05GSUdVUkFUSU9OIEdMT0JBTEUgREVTIFRFU1RTIEFVVEhHVUFSRFxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vLyBDb25maWd1cmF0aW9uIGRlcyB0aW1lb3V0cyBwb3VyIGxlcyB0ZXN0cyBsb25nc1xuamVzdC5zZXRUaW1lb3V0KDMwMDAwKTtcblxuLy8gQ29uZmlndXJhdGlvbiBkZXMgdmFyaWFibGVzIGQnZW52aXJvbm5lbWVudCBwb3VyIGxlcyB0ZXN0c1xucHJvY2Vzcy5lbnYuTk9ERV9FTlYgPSAndGVzdCc7XG5wcm9jZXNzLmVudi5BVVRIX1NFUlZJQ0VfVVJMID0gJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMSc7XG5wcm9jZXNzLmVudi5BVVRIX1NFUlZJQ0VfVElNRU9VVCA9ICc1MDAwJztcbnByb2Nlc3MuZW52LkFVVEhfQ0FDSEVfVFRMID0gJzMwMCc7XG5wcm9jZXNzLmVudi5SRURJU19IT1NUID0gJ2xvY2FsaG9zdCc7XG5wcm9jZXNzLmVudi5SRURJU19QT1JUID0gJzYzNzknO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLUyBHTE9CQVVYXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8vIE1vY2sgZ2xvYmFsIHBvdXIgbGVzIG3DqXRyaXF1ZXMgZGUgcGVyZm9ybWFuY2Vcbmdsb2JhbC5yZWNvcmRQZXJmb3JtYW5jZU1ldHJpYyA9IGplc3QuZm4oKG5hbWU6IHN0cmluZywgdmFsdWU6IGFueSwgbWV0YWRhdGE/OiBhbnkpID0+IHtcbiAgLy8gU3RvY2tlciBsZXMgbcOpdHJpcXVlcyBwb3VyIGFuYWx5c2VcbiAgaWYgKCEoZ2xvYmFsIGFzIGFueSkucGVyZm9ybWFuY2VNZXRyaWNzKSB7XG4gICAgKGdsb2JhbCBhcyBhbnkpLnBlcmZvcm1hbmNlTWV0cmljcyA9IFtdO1xuICB9XG4gIChnbG9iYWwgYXMgYW55KS5wZXJmb3JtYW5jZU1ldHJpY3MucHVzaCh7XG4gICAgbmFtZSxcbiAgICB2YWx1ZSxcbiAgICBtZXRhZGF0YSxcbiAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gIH0pO1xufSk7XG5cbi8vIE1vY2sgZ2xvYmFsIHBvdXIgbGUgZ2FyYmFnZSBjb2xsZWN0b3IgKHNpIGRpc3BvbmlibGUpXG5pZiAodHlwZW9mIGdsb2JhbC5nYyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgZ2xvYmFsLmdjID0gamVzdC5mbigpO1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTIEdMT0JBVVggUE9VUiBMRVMgVEVTVFNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLy8gSGVscGVyIHBvdXIgY3LDqWVyIGRlcyB0b2tlbnMgZGUgdGVzdCB2YWxpZGVzXG5nbG9iYWwuY3JlYXRlVGVzdFRva2VuID0gKHBheWxvYWQ6IGFueSA9IHt9KSA9PiB7XG4gIGNvbnN0IGhlYWRlciA9IHsgYWxnOiAnSFMyNTYnLCB0eXA6ICdKV1QnIH07XG4gIGNvbnN0IGRlZmF1bHRQYXlsb2FkID0ge1xuICAgIHN1YjogJ3Rlc3QtdXNlci0xMjMnLFxuICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXG4gICAgcm9sZXM6IFsndXNlciddLFxuICAgIGlhdDogTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCksXG4gICAgZXhwOiBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxMDAwKSArIDM2MDAsXG4gICAgLi4ucGF5bG9hZCxcbiAgfTtcblxuICBjb25zdCBoZWFkZXJFbmNvZGVkID0gQnVmZmVyLmZyb20oSlNPTi5zdHJpbmdpZnkoaGVhZGVyKSkudG9TdHJpbmcoJ2Jhc2U2NHVybCcpO1xuICBjb25zdCBwYXlsb2FkRW5jb2RlZCA9IEJ1ZmZlci5mcm9tKEpTT04uc3RyaW5naWZ5KGRlZmF1bHRQYXlsb2FkKSkudG9TdHJpbmcoJ2Jhc2U2NHVybCcpO1xuICBjb25zdCBzaWduYXR1cmUgPSAndGVzdC1zaWduYXR1cmUnO1xuXG4gIHJldHVybiBgJHtoZWFkZXJFbmNvZGVkfS4ke3BheWxvYWRFbmNvZGVkfS4ke3NpZ25hdHVyZX1gO1xufTtcblxuLy8gSGVscGVyIHBvdXIgY3LDqWVyIGRlcyB1dGlsaXNhdGV1cnMgZGUgdGVzdFxuZ2xvYmFsLmNyZWF0ZVRlc3RVc2VyID0gKG92ZXJyaWRlczogYW55ID0ge30pID0+ICh7XG4gIGlkOiAndGVzdC11c2VyLTEyMycsXG4gIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXG4gIHJvbGVzOiBbJ3VzZXInXSxcbiAgLi4ub3ZlcnJpZGVzLFxufSk7XG5cbi8vIEhlbHBlciBwb3VyIGNyw6llciBkZXMgcsOpcG9uc2VzIGQnYXV0aGVudGlmaWNhdGlvbiBkZSB0ZXN0XG5nbG9iYWwuY3JlYXRlVGVzdEF1dGhSZXNwb25zZSA9ICh1c2VyOiBhbnkgPSBnbG9iYWwuY3JlYXRlVGVzdFVzZXIoKSkgPT4gKHtcbiAgZGF0YToge1xuICAgIHZhbGlkOiB0cnVlLFxuICAgIHVzZXI6IHtcbiAgICAgIGlkOiB1c2VyLmlkLFxuICAgICAgZW1haWw6IHVzZXIuZW1haWwsXG4gICAgICByb2xlczogdXNlci5yb2xlcyxcbiAgICB9LFxuICAgIGV4cGlyZXNBdDogbmV3IERhdGUoRGF0ZS5ub3coKSArIDM2MDAwMDApLnRvSVNPU3RyaW5nKCksXG4gIH0sXG4gIHN0YXR1czogMjAwLFxuICBzdGF0dXNUZXh0OiAnT0snLFxuICBoZWFkZXJzOiB7fSxcbiAgY29uZmlnOiB7fSBhcyBhbnksXG59KTtcblxuLy8gSGVscGVyIHBvdXIgbWVzdXJlciBsZXMgcGVyZm9ybWFuY2VzXG5nbG9iYWwubWVhc3VyZVBlcmZvcm1hbmNlID0gYXN5bmMgKGZuOiAoKSA9PiBQcm9taXNlPGFueT4pOiBQcm9taXNlPHsgcmVzdWx0OiBhbnk7IGR1cmF0aW9uOiBudW1iZXI7IG1lbW9yeTogYW55IH0+ID0+IHtcbiAgY29uc3Qgc3RhcnRUaW1lID0gcHJvY2Vzcy5ocnRpbWUuYmlnaW50KCk7XG4gIGNvbnN0IHN0YXJ0TWVtb3J5ID0gcHJvY2Vzcy5tZW1vcnlVc2FnZSgpO1xuICBcbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZm4oKTtcbiAgXG4gIGNvbnN0IGVuZFRpbWUgPSBwcm9jZXNzLmhydGltZS5iaWdpbnQoKTtcbiAgY29uc3QgZW5kTWVtb3J5ID0gcHJvY2Vzcy5tZW1vcnlVc2FnZSgpO1xuICBcbiAgY29uc3QgZHVyYXRpb24gPSBOdW1iZXIoZW5kVGltZSAtIHN0YXJ0VGltZSkgLyAxMDAwMDAwOyAvLyBDb252ZXJ0IHRvIG1pbGxpc2Vjb25kc1xuICBjb25zdCBtZW1vcnkgPSB7XG4gICAgaGVhcFVzZWQ6IGVuZE1lbW9yeS5oZWFwVXNlZCAtIHN0YXJ0TWVtb3J5LmhlYXBVc2VkLFxuICAgIGhlYXBUb3RhbDogZW5kTWVtb3J5LmhlYXBUb3RhbCAtIHN0YXJ0TWVtb3J5LmhlYXBUb3RhbCxcbiAgICBleHRlcm5hbDogZW5kTWVtb3J5LmV4dGVybmFsIC0gc3RhcnRNZW1vcnkuZXh0ZXJuYWwsXG4gIH07XG5cbiAgcmV0dXJuIHsgcmVzdWx0LCBkdXJhdGlvbiwgbWVtb3J5IH07XG59O1xuXG4vLyBIZWxwZXIgcG91ciBhdHRlbmRyZSBkZSBtYW5pw6hyZSBhc3luY2hyb25lXG5nbG9iYWwud2FpdEZvciA9IChtczogbnVtYmVyKTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKTtcbn07XG5cbi8vIEhlbHBlciBwb3VyIGNyw6llciBkZXMgbW9ja3MgZGUgRXhlY3V0aW9uQ29udGV4dFxuZ2xvYmFsLmNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0ID0gKHJlcXVlc3Q6IGFueSkgPT4gKHtcbiAgc3dpdGNoVG9IdHRwOiAoKSA9PiAoe1xuICAgIGdldFJlcXVlc3Q6ICgpID0+IHJlcXVlc3QsXG4gICAgZ2V0UmVzcG9uc2U6IGplc3QuZm4oKSxcbiAgICBnZXROZXh0OiBqZXN0LmZuKCksXG4gIH0pLFxuICBzd2l0Y2hUb1JwYzogamVzdC5mbigpLFxuICBzd2l0Y2hUb1dzOiBqZXN0LmZuKCksXG4gIGdldFR5cGU6ICgpID0+ICdodHRwJyBhcyBjb25zdCxcbiAgZ2V0Q2xhc3M6IGplc3QuZm4oKSxcbiAgZ2V0SGFuZGxlcjogamVzdC5mbigpLFxuICBnZXRBcmdzOiBqZXN0LmZuKCksXG4gIGdldEFyZ0J5SW5kZXg6IGplc3QuZm4oKSxcbn0pO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBDT05GSUdVUkFUSU9OIERFUyBFUlJFVVJTIE5PTiBDQVBUVVLDiUVTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8vIEdlc3Rpb25uYWlyZSBwb3VyIGxlcyByZWplY3Rpb25zIG5vbiBnw6lyw6llc1xuY29uc3QgdW5oYW5kbGVkUmVqZWN0aW9ucyA9IG5ldyBTZXQoKTtcbnByb2Nlc3Mub24oJ3VuaGFuZGxlZFJlamVjdGlvbicsIChyZWFzb24sIHByb21pc2UpID0+IHtcbiAgdW5oYW5kbGVkUmVqZWN0aW9ucy5hZGQocHJvbWlzZSk7XG4gIGNvbnNvbGUuZXJyb3IoJ1VuaGFuZGxlZCBSZWplY3Rpb24gYXQ6JywgcHJvbWlzZSwgJ3JlYXNvbjonLCByZWFzb24pO1xufSk7XG5cbnByb2Nlc3Mub24oJ3JlamVjdGlvbkhhbmRsZWQnLCAocHJvbWlzZSkgPT4ge1xuICB1bmhhbmRsZWRSZWplY3Rpb25zLmRlbGV0ZShwcm9taXNlKTtcbn0pO1xuXG4vLyBWw6lyaWZpZXIgcXUnaWwgbid5IGEgcGFzIGRlIHJlamVjdGlvbnMgbm9uIGfDqXLDqWVzIGFwcsOocyBjaGFxdWUgdGVzdFxuYWZ0ZXJFYWNoKCgpID0+IHtcbiAgaWYgKHVuaGFuZGxlZFJlamVjdGlvbnMuc2l6ZSA+IDApIHtcbiAgICBjb25zb2xlLndhcm4oYFdhcm5pbmc6ICR7dW5oYW5kbGVkUmVqZWN0aW9ucy5zaXplfSB1bmhhbmRsZWQgcHJvbWlzZSByZWplY3Rpb25zIGRldGVjdGVkYCk7XG4gICAgdW5oYW5kbGVkUmVqZWN0aW9ucy5jbGVhcigpO1xuICB9XG59KTtcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQ09ORklHVVJBVElPTiBERVMgTU9DS1MgQVhJT1Ncbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLy8gTW9jayBnbG9iYWwgcG91ciBsZXMgZXJyZXVycyBBeGlvcyBjb21tdW5lc1xuZ2xvYmFsLmNyZWF0ZUF4aW9zRXJyb3IgPSAobWVzc2FnZTogc3RyaW5nLCBjb2RlOiBzdHJpbmcsIHN0YXR1cz86IG51bWJlcikgPT4ge1xuICBjb25zdCBlcnJvcjogYW55ID0gbmV3IEVycm9yKG1lc3NhZ2UpO1xuICBlcnJvci5pc0F4aW9zRXJyb3IgPSB0cnVlO1xuICBlcnJvci5jb2RlID0gY29kZTtcbiAgZXJyb3IucmVzcG9uc2UgPSBzdGF0dXMgPyB7XG4gICAgc3RhdHVzLFxuICAgIHN0YXR1c1RleHQ6IG1lc3NhZ2UsXG4gICAgZGF0YTogeyBlcnJvcjogbWVzc2FnZSB9LFxuICAgIGhlYWRlcnM6IHt9LFxuICAgIGNvbmZpZzoge30sXG4gIH0gOiB1bmRlZmluZWQ7XG4gIHJldHVybiBlcnJvcjtcbn07XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIENPTkZJR1VSQVRJT04gRFUgTkVUVE9ZQUdFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8vIE5ldHRveWFnZSBhcHLDqHMgY2hhcXVlIHRlc3RcbmFmdGVyRWFjaChhc3luYyAoKSA9PiB7XG4gIC8vIE5ldHRveWVyIGxlcyBtw6l0cmlxdWVzIGRlIHBlcmZvcm1hbmNlXG4gIGlmICgoZ2xvYmFsIGFzIGFueSkucGVyZm9ybWFuY2VNZXRyaWNzKSB7XG4gICAgKGdsb2JhbCBhcyBhbnkpLnBlcmZvcm1hbmNlTWV0cmljcyA9IFtdO1xuICB9XG4gIFxuICAvLyBGb3JjZXIgbGUgZ2FyYmFnZSBjb2xsZWN0aW9uIHNpIGRpc3BvbmlibGVcbiAgaWYgKGdsb2JhbC5nYyAmJiB0eXBlb2YgZ2xvYmFsLmdjID09PSAnZnVuY3Rpb24nKSB7XG4gICAgZ2xvYmFsLmdjKCk7XG4gIH1cbiAgXG4gIC8vIE5ldHRveWVyIGxlcyB2YXJpYWJsZXMgZCdlbnZpcm9ubmVtZW50IG1vZGlmacOpZXNcbiAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPSAndGVzdCc7XG4gIFxuICAvLyBBdHRlbmRyZSB1biBwZXUgcG91ciBwZXJtZXR0cmUgYXV4IG9ww6lyYXRpb25zIGFzeW5jaHJvbmVzIGRlIHNlIHRlcm1pbmVyXG4gIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0SW1tZWRpYXRlKHJlc29sdmUpKTtcbn0pO1xuXG4vLyBOZXR0b3lhZ2UgYXByw6hzIHRvdXMgbGVzIHRlc3RzXG5hZnRlckFsbChhc3luYyAoKSA9PiB7XG4gIC8vIE5ldHRveWVyIGxlcyBsaXN0ZW5lcnMgZCfDqXbDqW5lbWVudHNcbiAgcHJvY2Vzcy5yZW1vdmVBbGxMaXN0ZW5lcnMoJ3VuaGFuZGxlZFJlamVjdGlvbicpO1xuICBwcm9jZXNzLnJlbW92ZUFsbExpc3RlbmVycygncmVqZWN0aW9uSGFuZGxlZCcpO1xuICBcbiAgLy8gQXR0ZW5kcmUgcXVlIHRvdXRlcyBsZXMgcHJvbWVzc2VzIGVuIGF0dGVudGUgc2UgdGVybWluZW50XG4gIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDApKTtcbn0pO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBDT05GSUdVUkFUSU9OIERFUyBNQVRDSEVSUyBKRVNUIFBFUlNPTk5BTElTw4lTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8vIE1hdGNoZXIgcGVyc29ubmFsaXPDqSBwb3VyIHbDqXJpZmllciBsZXMgdG9rZW5zIEpXVFxuZXhwZWN0LmV4dGVuZCh7XG4gIHRvQmVWYWxpZEpXVEZvcm1hdChyZWNlaXZlZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgand0UmVnZXggPSAvXltBLVphLXowLTlfLV0rXFwuW0EtWmEtejAtOV8tXStcXC5bQS1aYS16MC05Xy1dKyQvO1xuICAgIGNvbnN0IHBhc3MgPSB0eXBlb2YgcmVjZWl2ZWQgPT09ICdzdHJpbmcnICYmIGp3dFJlZ2V4LnRlc3QocmVjZWl2ZWQpO1xuICAgIFxuICAgIGlmIChwYXNzKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtZXNzYWdlOiAoKSA9PiBgZXhwZWN0ZWQgJHtyZWNlaXZlZH0gbm90IHRvIGJlIGEgdmFsaWQgSldUIGZvcm1hdGAsXG4gICAgICAgIHBhc3M6IHRydWUsXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtZXNzYWdlOiAoKSA9PiBgZXhwZWN0ZWQgJHtyZWNlaXZlZH0gdG8gYmUgYSB2YWxpZCBKV1QgZm9ybWF0YCxcbiAgICAgICAgcGFzczogZmFsc2UsXG4gICAgICB9O1xuICAgIH1cbiAgfSxcbn0pO1xuXG4vLyBNYXRjaGVyIHBlcnNvbm5hbGlzw6kgcG91ciB2w6lyaWZpZXIgbGVzIGNsw6lzIGRlIGNhY2hlXG5leHBlY3QuZXh0ZW5kKHtcbiAgdG9CZVZhbGlkQ2FjaGVLZXkocmVjZWl2ZWQ6IHN0cmluZykge1xuICAgIGNvbnN0IGNhY2hlS2V5UmVnZXggPSAvXmF1dGg6dG9rZW46W2EtZjAtOV17NjR9JC87XG4gICAgY29uc3QgcGFzcyA9IHR5cGVvZiByZWNlaXZlZCA9PT0gJ3N0cmluZycgJiYgY2FjaGVLZXlSZWdleC50ZXN0KHJlY2VpdmVkKTtcbiAgICBcbiAgICBpZiAocGFzcykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWVzc2FnZTogKCkgPT4gYGV4cGVjdGVkICR7cmVjZWl2ZWR9IG5vdCB0byBiZSBhIHZhbGlkIGNhY2hlIGtleSBmb3JtYXRgLFxuICAgICAgICBwYXNzOiB0cnVlLFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWVzc2FnZTogKCkgPT4gYGV4cGVjdGVkICR7cmVjZWl2ZWR9IHRvIGJlIGEgdmFsaWQgY2FjaGUga2V5IGZvcm1hdCAoYXV0aDp0b2tlbjpbNjQtY2hhci1oZXhdKWAsXG4gICAgICAgIHBhc3M6IGZhbHNlLFxuICAgICAgfTtcbiAgICB9XG4gIH0sXG59KTtcblxuLy8gTWF0Y2hlciBwZXJzb25uYWxpc8OpIHBvdXIgdsOpcmlmaWVyIGxlcyBwZXJmb3JtYW5jZXNcbmV4cGVjdC5leHRlbmQoe1xuICB0b0JlV2l0aGluUGVyZm9ybWFuY2VUaHJlc2hvbGQocmVjZWl2ZWQ6IG51bWJlciwgdGhyZXNob2xkOiBudW1iZXIpIHtcbiAgICBjb25zdCBwYXNzID0gcmVjZWl2ZWQgPD0gdGhyZXNob2xkO1xuICAgIFxuICAgIGlmIChwYXNzKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtZXNzYWdlOiAoKSA9PiBgZXhwZWN0ZWQgJHtyZWNlaXZlZH1tcyB0byBleGNlZWQgcGVyZm9ybWFuY2UgdGhyZXNob2xkIG9mICR7dGhyZXNob2xkfW1zYCxcbiAgICAgICAgcGFzczogdHJ1ZSxcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1lc3NhZ2U6ICgpID0+IGBleHBlY3RlZCAke3JlY2VpdmVkfW1zIHRvIGJlIHdpdGhpbiBwZXJmb3JtYW5jZSB0aHJlc2hvbGQgb2YgJHt0aHJlc2hvbGR9bXNgLFxuICAgICAgICBwYXNzOiBmYWxzZSxcbiAgICAgIH07XG4gICAgfVxuICB9LFxufSk7XG5cbi8vIE1hdGNoZXIgcGVyc29ubmFsaXPDqSBwb3VyIHbDqXJpZmllciBsZXMgb2JqZXRzIFVzZXJcbmV4cGVjdC5leHRlbmQoe1xuICB0b0JlVmFsaWRVc2VyKHJlY2VpdmVkOiBhbnkpIHtcbiAgICBjb25zdCBpc1ZhbGlkID0gcmVjZWl2ZWQgJiYgXG4gICAgICAgICAgICAgICAgICAgdHlwZW9mIHJlY2VpdmVkLmlkID09PSAnc3RyaW5nJyAmJiBcbiAgICAgICAgICAgICAgICAgICB0eXBlb2YgcmVjZWl2ZWQuZW1haWwgPT09ICdzdHJpbmcnICYmIFxuICAgICAgICAgICAgICAgICAgIEFycmF5LmlzQXJyYXkocmVjZWl2ZWQucm9sZXMpICYmXG4gICAgICAgICAgICAgICAgICAgcmVjZWl2ZWQuaWQubGVuZ3RoID4gMCAmJlxuICAgICAgICAgICAgICAgICAgIHJlY2VpdmVkLmVtYWlsLmluY2x1ZGVzKCdAJykgJiZcbiAgICAgICAgICAgICAgICAgICByZWNlaXZlZC5yb2xlcy5ldmVyeSgocm9sZTogYW55KSA9PiB0eXBlb2Ygcm9sZSA9PT0gJ3N0cmluZycpO1xuICAgIFxuICAgIGlmIChpc1ZhbGlkKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtZXNzYWdlOiAoKSA9PiBgZXhwZWN0ZWQgJHtKU09OLnN0cmluZ2lmeShyZWNlaXZlZCl9IG5vdCB0byBiZSBhIHZhbGlkIHVzZXIgb2JqZWN0YCxcbiAgICAgICAgcGFzczogdHJ1ZSxcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1lc3NhZ2U6ICgpID0+IGBleHBlY3RlZCAke0pTT04uc3RyaW5naWZ5KHJlY2VpdmVkKX0gdG8gYmUgYSB2YWxpZCB1c2VyIG9iamVjdCB3aXRoIGlkLCBlbWFpbCwgYW5kIHJvbGVzYCxcbiAgICAgICAgcGFzczogZmFsc2UsXG4gICAgICB9O1xuICAgIH1cbiAgfSxcbn0pO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBDT05GSUdVUkFUSU9OIERFUyBMT0dTIERFIFRFU1Rcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLy8gQ29uZmlndXJhdGlvbiBkdSBuaXZlYXUgZGUgbG9nIHBvdXIgbGVzIHRlc3RzXG5jb25zdCBvcmlnaW5hbENvbnNvbGVMb2cgPSBjb25zb2xlLmxvZztcbmNvbnN0IG9yaWdpbmFsQ29uc29sZUVycm9yID0gY29uc29sZS5lcnJvcjtcbmNvbnN0IG9yaWdpbmFsQ29uc29sZVdhcm4gPSBjb25zb2xlLndhcm47XG5cbi8vIEZpbHRyZXIgbGVzIGxvZ3MgcGVuZGFudCBsZXMgdGVzdHMgc2F1ZiBzaSBleHBsaWNpdGVtZW50IGFjdGl2w6lzXG5pZiAoIXByb2Nlc3MuZW52LkpFU1RfVkVSQk9TRV9MT0dTKSB7XG4gIGNvbnNvbGUubG9nID0gKC4uLmFyZ3MpID0+IHtcbiAgICBpZiAoYXJnc1swXT8uaW5jbHVkZXMgJiYgKGFyZ3NbMF0uaW5jbHVkZXMoJ1RFU1RfTE9HJykgfHwgYXJnc1swXS5pbmNsdWRlcygn8J+TiicpKSkge1xuICAgICAgb3JpZ2luYWxDb25zb2xlTG9nKC4uLmFyZ3MpO1xuICAgIH1cbiAgfTtcbiAgXG4gIGNvbnNvbGUuZXJyb3IgPSAoLi4uYXJncykgPT4ge1xuICAgIGlmIChhcmdzWzBdPy5pbmNsdWRlcyAmJiBhcmdzWzBdLmluY2x1ZGVzKCdURVNUX0VSUk9SJykpIHtcbiAgICAgIG9yaWdpbmFsQ29uc29sZUVycm9yKC4uLmFyZ3MpO1xuICAgIH1cbiAgfTtcbiAgXG4gIGNvbnNvbGUud2FybiA9ICguLi5hcmdzKSA9PiB7XG4gICAgaWYgKGFyZ3NbMF0/LmluY2x1ZGVzICYmIGFyZ3NbMF0uaW5jbHVkZXMoJ1RFU1RfV0FSTicpKSB7XG4gICAgICBvcmlnaW5hbENvbnNvbGVXYXJuKC4uLmFyZ3MpO1xuICAgIH1cbiAgfTtcbn1cblxuLy8gUmVzdGF1cmVyIGxlcyBsb2dzIGFwcsOocyBsZXMgdGVzdHNcbmFmdGVyQWxsKCgpID0+IHtcbiAgY29uc29sZS5sb2cgPSBvcmlnaW5hbENvbnNvbGVMb2c7XG4gIGNvbnNvbGUuZXJyb3IgPSBvcmlnaW5hbENvbnNvbGVFcnJvcjtcbiAgY29uc29sZS53YXJuID0gb3JpZ2luYWxDb25zb2xlV2Fybjtcbn0pO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBDT05GSUdVUkFUSU9OIERFUyBUWVBFUyBUWVBFU0NSSVBUIFBPVVIgTEVTIEhFTFBFUlMgR0xPQkFVWFxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5kZWNsYXJlIGdsb2JhbCB7XG4gIGZ1bmN0aW9uIHJlY29yZFBlcmZvcm1hbmNlTWV0cmljKG5hbWU6IHN0cmluZywgdmFsdWU6IGFueSwgbWV0YWRhdGE/OiBhbnkpOiB2b2lkO1xuICBmdW5jdGlvbiBjcmVhdGVUZXN0VG9rZW4ocGF5bG9hZD86IGFueSk6IHN0cmluZztcbiAgZnVuY3Rpb24gY3JlYXRlVGVzdFVzZXIob3ZlcnJpZGVzPzogYW55KTogYW55O1xuICBmdW5jdGlvbiBjcmVhdGVUZXN0QXV0aFJlc3BvbnNlKHVzZXI/OiBhbnkpOiBhbnk7XG4gIGZ1bmN0aW9uIG1lYXN1cmVQZXJmb3JtYW5jZShmbjogKCkgPT4gUHJvbWlzZTxhbnk+KTogUHJvbWlzZTx7IHJlc3VsdDogYW55OyBkdXJhdGlvbjogbnVtYmVyOyBtZW1vcnk6IGFueSB9PjtcbiAgZnVuY3Rpb24gd2FpdEZvcihtczogbnVtYmVyKTogUHJvbWlzZTx2b2lkPjtcbiAgZnVuY3Rpb24gY3JlYXRlTW9ja0V4ZWN1dGlvbkNvbnRleHQocmVxdWVzdDogYW55KTogYW55O1xuICBmdW5jdGlvbiBjcmVhdGVBeGlvc0Vycm9yKG1lc3NhZ2U6IHN0cmluZywgY29kZTogc3RyaW5nLCBzdGF0dXM/OiBudW1iZXIpOiBhbnk7XG4gIFxuICBuYW1lc3BhY2UgamVzdCB7XG4gICAgaW50ZXJmYWNlIE1hdGNoZXJzPFI+IHtcbiAgICAgIHRvQmVWYWxpZEpXVEZvcm1hdCgpOiBSO1xuICAgICAgdG9CZVZhbGlkQ2FjaGVLZXkoKTogUjtcbiAgICAgIHRvQmVXaXRoaW5QZXJmb3JtYW5jZVRocmVzaG9sZCh0aHJlc2hvbGQ6IG51bWJlcik6IFI7XG4gICAgICB0b0JlVmFsaWRVc2VyKCk6IFI7XG4gICAgfVxuICB9XG4gIFxuICB2YXIgcGVyZm9ybWFuY2VNZXRyaWNzOiBBcnJheTx7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIHZhbHVlOiBhbnk7XG4gICAgbWV0YWRhdGE/OiBhbnk7XG4gICAgdGltZXN0YW1wOiBudW1iZXI7XG4gIH0+O1xufVxuXG5leHBvcnQge307Il0sInZlcnNpb24iOjN9