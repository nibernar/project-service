336888a669e8963e230eb7766b023483
"use strict";
// test/unit/common/guards/auth.guard.performance.spec.ts
Object.defineProperty(exports, "__esModule", { value: true });
const common_1 = require("@nestjs/common");
const rxjs_1 = require("rxjs");
const axios_1 = require("axios");
const auth_guard_1 = require("../../../../src/common/guards/auth.guard");
describe('AuthGuard - Performance Tests', () => {
    let authGuard;
    let configService;
    let cacheService;
    let httpService;
    // ============================================================================
    // CONSTANTES DE PERFORMANCE
    // ============================================================================
    const PERFORMANCE_THRESHOLDS = {
        CACHE_HIT_MAX_TIME: 2, // ms - Cache hit doit √™tre tr√®s rapide
        AUTH_SERVICE_CALL_MAX_TIME: 100, // ms - Appel service auth acceptable
        CONCURRENT_REQUESTS_MAX_TIME: 300, // ms - 100 requ√™tes concurrentes (augment√©)
        MEMORY_LEAK_THRESHOLD: 50 * 1024 * 1024, // 50MB - Seuil fuite m√©moire (Jest leak aware)
        CACHE_EFFICIENCY_MIN: 0.75, // 75% - Efficacit√© minimale du cache (plus r√©aliste)
        ERROR_HANDLING_MAX_TIME: 50, // ms - Gestion d'erreur rapide
    };
    // ============================================================================
    // HELPERS DE PERFORMANCE
    // ============================================================================
    const createMockExecutionContext = (request) => {
        return {
            switchToHttp: () => ({
                getRequest: () => request,
                getResponse: jest.fn(),
                getNext: jest.fn(),
            }),
            switchToRpc: jest.fn(),
            switchToWs: jest.fn(),
            getType: () => 'http',
            getClass: jest.fn(),
            getHandler: jest.fn(),
            getArgs: jest.fn(),
            getArgByIndex: jest.fn(),
        };
    };
    const createValidUser = () => ({
        id: 'perf-user-123',
        email: 'performance@example.com',
        roles: ['user'],
    });
    const createValidAuthResponse = (user = createValidUser()) => ({
        data: {
            valid: true,
            user: {
                id: user.id,
                email: user.email,
                roles: user.roles,
            },
            expiresAt: new Date(Date.now() + 3600000).toISOString(),
        },
        status: 200,
        statusText: 'OK',
        headers: {},
        config: {},
    });
    const createPerformanceToken = (suffix = '') => {
        return `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.performance-payload-${suffix}.signature-${suffix}`;
    };
    const measureExecutionTime = async (fn) => {
        const start = process.hrtime.bigint();
        await fn();
        const end = process.hrtime.bigint();
        return Number(end - start) / 1000000; // Convert to milliseconds
    };
    const measureMemoryUsage = (fn) => {
        if (global.gc)
            global.gc(); // Force garbage collection
        const before = process.memoryUsage();
        fn();
        if (global.gc)
            global.gc();
        const after = process.memoryUsage();
        return {
            before,
            after,
            diff: after.heapUsed - before.heapUsed,
        };
    };
    const createLargeUser = (size) => {
        const baseSizes = {
            small: 10,
            medium: 100,
            large: 1000,
            huge: 10000,
        };
        const roleCount = baseSizes[size];
        return {
            id: `${size}-user-with-${roleCount}-roles`,
            email: `${size}.user@performance-test.com`,
            roles: Array.from({ length: roleCount }, (_, i) => `role-${size}-${i}`),
        };
    };
    // ============================================================================
    // SETUP ET TEARDOWN
    // ============================================================================
    beforeEach(() => {
        configService = {
            get: jest.fn(),
        };
        cacheService = {
            get: jest.fn(),
            set: jest.fn(),
            del: jest.fn(),
        };
        httpService = {
            post: jest.fn(),
        };
        configService.get.mockImplementation((key) => {
            switch (key) {
                case 'AUTH_SERVICE_URL':
                    return 'http://localhost:3001';
                case 'AUTH_SERVICE_TIMEOUT':
                    return '5000';
                default:
                    return undefined;
            }
        });
        process.env.AUTH_SERVICE_URL = 'http://localhost:3001';
        process.env.AUTH_SERVICE_TIMEOUT = '5000';
        authGuard = new auth_guard_1.AuthGuard(configService, cacheService, httpService);
    });
    afterEach(() => {
        jest.clearAllMocks();
        jest.restoreAllMocks();
        // Force garbage collection si disponible (aide avec les fuites Jest)
        if (global.gc) {
            global.gc();
        }
    });
    // Cleanup global apr√®s tous les tests de performance
    afterAll(() => {
        // Force garbage collection finale
        if (global.gc) {
            global.gc();
        }
    });
    // ============================================================================
    // TESTS DE PERFORMANCE - CACHE HITS
    // ============================================================================
    describe('Performance des cache hits', () => {
        it('should process cache hits in under 2ms', async () => {
            // Arrange
            const token = createPerformanceToken('cache-hit');
            const user = createValidUser();
            const request = { headers: { authorization: `Bearer ${token}` } };
            const context = createMockExecutionContext(request);
            cacheService.get.mockResolvedValue(user); // Cache hit
            // Act & Measure
            const executionTime = await measureExecutionTime(async () => {
                const result = await authGuard.canActivate(context);
                expect(result).toBe(true);
            });
            // Assert
            expect(executionTime).toBeLessThan(PERFORMANCE_THRESHOLDS.CACHE_HIT_MAX_TIME);
            expect(httpService.post).not.toHaveBeenCalled(); // Pas d'appel au service
            // Enregistrement m√©trique pour monitoring
            if (global.recordPerformanceMetric) {
                global.recordPerformanceMetric('auth-guard-cache-hit', executionTime, {
                    threshold: PERFORMANCE_THRESHOLDS.CACHE_HIT_MAX_TIME,
                    cacheHit: true,
                });
            }
        });
        it('should maintain cache hit performance with large user objects', async () => {
            // Arrange
            const token = createPerformanceToken('large-cache');
            const largeUser = createLargeUser('large');
            const request = { headers: { authorization: `Bearer ${token}` } };
            const context = createMockExecutionContext(request);
            cacheService.get.mockResolvedValue(largeUser);
            // Act & Measure
            const executionTime = await measureExecutionTime(async () => {
                const result = await authGuard.canActivate(context);
                expect(result).toBe(true);
            });
            // Assert
            expect(executionTime).toBeLessThan(PERFORMANCE_THRESHOLDS.CACHE_HIT_MAX_TIME * 2); // 2x allowance pour gros objets
            expect(request.user).toEqual(largeUser);
        });
        it('should handle burst cache hits efficiently', async () => {
            // Arrange
            const token = createPerformanceToken('burst');
            const user = createValidUser();
            cacheService.get.mockResolvedValue(user);
            // Act - 1000 cache hits rapidement
            const startTime = process.hrtime.bigint();
            const promises = Array.from({ length: 1000 }, async () => {
                const request = { headers: { authorization: `Bearer ${token}` } };
                const context = createMockExecutionContext(request);
                return authGuard.canActivate(context);
            });
            const results = await Promise.all(promises);
            const endTime = process.hrtime.bigint();
            const totalTime = Number(endTime - startTime) / 1000000; // ms
            // Assert
            expect(results.every(result => result === true)).toBe(true);
            expect(totalTime).toBeLessThan(1000); // 1000 hits en moins de 1 seconde
            expect(totalTime / 1000).toBeLessThan(1); // < 1ms par hit en moyenne
        });
        it('should scale cache performance linearly', async () => {
            // Arrange
            const token = createPerformanceToken('scale');
            const user = createValidUser();
            cacheService.get.mockResolvedValue(user);
            const testSizes = [10, 50, 100, 500];
            const timings = [];
            // Act - Tester diff√©rentes tailles de burst
            for (const size of testSizes) {
                const startTime = process.hrtime.bigint();
                const promises = Array.from({ length: size }, async () => {
                    const request = { headers: { authorization: `Bearer ${token}` } };
                    const context = createMockExecutionContext(request);
                    return authGuard.canActivate(context);
                });
                await Promise.all(promises);
                const endTime = process.hrtime.bigint();
                const totalTime = Number(endTime - startTime) / 1000000;
                timings.push({
                    size,
                    time: totalTime,
                    avgTime: totalTime / size,
                });
            }
            // Assert - Performance doit rester lin√©aire
            const avgTimes = timings.map(t => t.avgTime);
            const minAvgTime = Math.min(...avgTimes);
            const maxAvgTime = Math.max(...avgTimes);
            const scalingFactor = maxAvgTime / minAvgTime;
            expect(scalingFactor).toBeLessThan(3); // Max 3x d√©gradation
            console.log('üìä Cache scaling performance:', timings);
        });
    });
    // ============================================================================
    // TESTS DE PERFORMANCE - APPELS SERVICE AUTH
    // ============================================================================
    describe('Performance des appels service auth', () => {
        it('should complete auth service calls within acceptable time', async () => {
            // Arrange
            const token = createPerformanceToken('auth-service');
            const user = createValidUser();
            const request = { headers: { authorization: `Bearer ${token}` } };
            const context = createMockExecutionContext(request);
            cacheService.get.mockResolvedValue(null); // Cache miss
            httpService.post.mockReturnValue((0, rxjs_1.of)(createValidAuthResponse(user)));
            // Act & Measure
            const executionTime = await measureExecutionTime(async () => {
                const result = await authGuard.canActivate(context);
                expect(result).toBe(true);
            });
            // Assert
            expect(executionTime).toBeLessThan(PERFORMANCE_THRESHOLDS.AUTH_SERVICE_CALL_MAX_TIME);
            expect(httpService.post).toHaveBeenCalledTimes(1);
            expect(cacheService.set).toHaveBeenCalledTimes(1); // Mise en cache
        });
        it('should handle auth service latency gracefully', async () => {
            // Arrange
            const token = createPerformanceToken('latency');
            const user = createValidUser();
            const request = { headers: { authorization: `Bearer ${token}` } };
            const context = createMockExecutionContext(request);
            cacheService.get.mockResolvedValue(null);
            // Simuler latence r√©seau (50ms) avec Observable correct
            httpService.post.mockReturnValue((0, rxjs_1.of)(createValidAuthResponse(user)).pipe((0, rxjs_1.delay)(50)));
            // Act & Measure
            const executionTime = await measureExecutionTime(async () => {
                const result = await authGuard.canActivate(context);
                expect(result).toBe(true);
            });
            // Assert
            expect(executionTime).toBeGreaterThan(45); // Au moins la latence simul√©e
            expect(executionTime).toBeLessThan(PERFORMANCE_THRESHOLDS.AUTH_SERVICE_CALL_MAX_TIME);
        });
        it('should batch concurrent requests to same token efficiently', async () => {
            // Arrange
            const token = createPerformanceToken('concurrent');
            const user = createValidUser();
            cacheService.get.mockResolvedValue(null);
            httpService.post.mockReturnValue((0, rxjs_1.of)(createValidAuthResponse(user)));
            // Act - 100 requ√™tes concurrentes avec le m√™me token
            const startTime = process.hrtime.bigint();
            const promises = Array.from({ length: 100 }, async () => {
                const request = { headers: { authorization: `Bearer ${token}` } };
                const context = createMockExecutionContext(request);
                return authGuard.canActivate(context);
            });
            const results = await Promise.all(promises);
            const endTime = process.hrtime.bigint();
            const totalTime = Number(endTime - startTime) / 1000000;
            // Assert
            expect(results.every(result => result === true)).toBe(true);
            expect(totalTime).toBeLessThan(PERFORMANCE_THRESHOLDS.CONCURRENT_REQUESTS_MAX_TIME);
            // Note: Sans d√©duplication, chaque requ√™te fait un appel au service
            // Dans une vraie impl√©mentation, on pourrait optimiser cela
            expect(httpService.post).toHaveBeenCalledTimes(100);
        });
        it('should handle mixed cache hits and misses efficiently', async () => {
            // Arrange
            const cachedUser = createValidUser();
            const newUser = { ...createValidUser(), id: 'new-user-456' };
            const cachedToken = createPerformanceToken('cached');
            const newToken = createPerformanceToken('new');
            // Setup cache behavior - correction simple
            let cacheCallCount = 0;
            cacheService.get.mockImplementation(() => {
                cacheCallCount++;
                // Simuler 50% de cache hits
                if (cacheCallCount % 2 === 1) {
                    return Promise.resolve(cachedUser); // Cache hit pour les appels impairs
                }
                return Promise.resolve(null); // Cache miss pour les appels pairs
            });
            httpService.post.mockReturnValue((0, rxjs_1.of)(createValidAuthResponse(newUser)));
            // Act - M√©lange de 100 requ√™tes
            const startTime = process.hrtime.bigint();
            const promises = Array.from({ length: 100 }, async (_, i) => {
                const token = i % 2 === 0 ? cachedToken : newToken;
                const request = { headers: { authorization: `Bearer ${token}` } };
                const context = createMockExecutionContext(request);
                return authGuard.canActivate(context);
            });
            const results = await Promise.all(promises);
            const endTime = process.hrtime.bigint();
            const totalTime = Number(endTime - startTime) / 1000000;
            // Assert
            expect(results.every(result => result === true)).toBe(true);
            expect(totalTime).toBeLessThan(PERFORMANCE_THRESHOLDS.CONCURRENT_REQUESTS_MAX_TIME);
            // V√©rification du nombre d'appels au service (environ 50 cache misses)
            const callCount = httpService.post.mock.calls.length;
            expect(callCount).toBeGreaterThanOrEqual(45);
            expect(callCount).toBeLessThanOrEqual(55);
        });
    });
    // ============================================================================
    // TESTS DE PERFORMANCE - GESTION DES ERREURS
    // ============================================================================
    describe('Performance de la gestion d\'erreurs', () => {
        it('should handle authentication failures quickly', async () => {
            // Arrange
            const invalidToken = 'invalid.token.signature';
            const request = { headers: { authorization: `Bearer ${invalidToken}` } };
            const context = createMockExecutionContext(request);
            cacheService.get.mockResolvedValue(null);
            httpService.post.mockReturnValue((0, rxjs_1.throwError)(() => new axios_1.AxiosError('Invalid token', '401')));
            // Act & Measure
            const executionTime = await measureExecutionTime(async () => {
                try {
                    await authGuard.canActivate(context);
                    fail('Should have thrown');
                }
                catch (error) {
                    // L'AuthGuard peut lancer diff√©rents types d'exceptions selon le type d'erreur
                    expect(error).toBeInstanceOf(Error);
                }
            });
            // Assert
            expect(executionTime).toBeLessThan(PERFORMANCE_THRESHOLDS.ERROR_HANDLING_MAX_TIME);
        });
        it('should handle missing tokens quickly', async () => {
            // Arrange
            const request = { headers: {} }; // No authorization header
            const context = createMockExecutionContext(request);
            // Act & Measure
            const executionTime = await measureExecutionTime(async () => {
                try {
                    await authGuard.canActivate(context);
                    fail('Should have thrown');
                }
                catch (error) {
                    expect(error).toBeInstanceOf(common_1.UnauthorizedException);
                }
            });
            // Assert
            expect(executionTime).toBeLessThan(5); // Tr√®s rapide pour les erreurs de validation
        });
        it('should handle cache errors without significant performance impact', async () => {
            // Arrange
            const token = createPerformanceToken('cache-error');
            const user = createValidUser();
            const request = { headers: { authorization: `Bearer ${token}` } };
            const context = createMockExecutionContext(request);
            cacheService.get.mockRejectedValue(new Error('Redis down'));
            httpService.post.mockReturnValue((0, rxjs_1.of)(createValidAuthResponse(user)));
            // Act & Measure
            const executionTime = await measureExecutionTime(async () => {
                const result = await authGuard.canActivate(context);
                expect(result).toBe(true);
            });
            // Assert
            expect(executionTime).toBeLessThan(PERFORMANCE_THRESHOLDS.AUTH_SERVICE_CALL_MAX_TIME + 10); // +10ms tol√©rance
            expect(httpService.post).toHaveBeenCalled(); // Fallback au service
        });
        it('should handle network timeouts efficiently', async () => {
            // Arrange
            const token = createPerformanceToken('timeout');
            const request = { headers: { authorization: `Bearer ${token}` } };
            const context = createMockExecutionContext(request);
            cacheService.get.mockResolvedValue(null);
            httpService.post.mockReturnValue((0, rxjs_1.throwError)(() => new Error('timeout of 5000ms exceeded')));
            // Act & Measure
            const executionTime = await measureExecutionTime(async () => {
                try {
                    await authGuard.canActivate(context);
                    fail('Should have thrown');
                }
                catch (error) {
                    expect(error.message).toMatch(/Authentication (failed|service unavailable|service error)/);
                }
            });
            // Assert
            expect(executionTime).toBeLessThan(PERFORMANCE_THRESHOLDS.ERROR_HANDLING_MAX_TIME);
        });
    });
    // ============================================================================
    // TESTS DE PERFORMANCE - M√âMOIRE
    // ============================================================================
    describe('Performance m√©moire', () => {
        it('should not leak memory during normal operations', async () => {
            // Arrange
            const user = createValidUser();
            cacheService.get.mockResolvedValue(null);
            httpService.post.mockReturnValue((0, rxjs_1.of)(createValidAuthResponse(user)));
            // Act - Beaucoup d'op√©rations pour d√©tecter les fuites
            const memoryUsage = measureMemoryUsage(() => {
                const promises = Array.from({ length: 1000 }, async (_, i) => {
                    const token = createPerformanceToken(`memory-${i}`);
                    const request = { headers: { authorization: `Bearer ${token}` } };
                    const context = createMockExecutionContext(request);
                    return authGuard.canActivate(context);
                });
                // Attendre que toutes les promesses se r√©solvent
                return Promise.all(promises);
            });
            // Assert
            expect(Math.abs(memoryUsage.diff)).toBeLessThan(PERFORMANCE_THRESHOLDS.MEMORY_LEAK_THRESHOLD);
            console.log(`üìä Memory usage: ${(memoryUsage.diff / 1024 / 1024).toFixed(2)}MB`);
        });
        it('should handle large user objects without excessive memory allocation', async () => {
            // Arrange
            const largeUser = createLargeUser('huge'); // 10k roles
            const token = createPerformanceToken('huge-user');
            const request = { headers: { authorization: `Bearer ${token}` } };
            const context = createMockExecutionContext(request);
            cacheService.get.mockResolvedValue(null);
            httpService.post.mockReturnValue((0, rxjs_1.of)(createValidAuthResponse(largeUser)));
            // Act & Measure
            const memoryBefore = process.memoryUsage().heapUsed;
            const executionTime = await measureExecutionTime(async () => {
                const result = await authGuard.canActivate(context);
                expect(result).toBe(true);
            });
            const memoryAfter = process.memoryUsage().heapUsed;
            const memoryDiff = memoryAfter - memoryBefore;
            // Assert
            expect(executionTime).toBeLessThan(PERFORMANCE_THRESHOLDS.AUTH_SERVICE_CALL_MAX_TIME * 2);
            expect(memoryDiff).toBeLessThan(5 * 1024 * 1024); // Max 5MB pour un gros objet
            expect(request.user).toEqual(largeUser);
        });
        it('should efficiently garbage collect temporary objects', async () => {
            // Arrange
            const user = createValidUser();
            cacheService.get.mockResolvedValue(null);
            httpService.post.mockReturnValue((0, rxjs_1.of)(createValidAuthResponse(user)));
            // Act - Cr√©er beaucoup d'objets temporaires
            const initialMemory = process.memoryUsage().heapUsed;
            for (let i = 0; i < 100; i++) {
                const token = createPerformanceToken(`gc-${i}`);
                const request = { headers: { authorization: `Bearer ${token}` } };
                const context = createMockExecutionContext(request);
                await authGuard.canActivate(context);
                // Nettoyer la r√©f√©rence utilisateur pour permettre GC
                delete request.user;
            }
            // Force garbage collection si disponible
            if (global.gc) {
                global.gc();
            }
            const finalMemory = process.memoryUsage().heapUsed;
            const memoryGrowth = finalMemory - initialMemory;
            // Assert
            expect(memoryGrowth).toBeLessThan(8 * 1024 * 1024); // Max 8MB de croissance (plus tol√©rant)
        });
        it('should handle memory pressure gracefully', async () => {
            // Arrange
            const token = createPerformanceToken('memory-pressure');
            const user = createValidUser();
            const request = { headers: { authorization: `Bearer ${token}` } };
            const context = createMockExecutionContext(request);
            // Cr√©er de la pression m√©moire
            const memoryHogs = [];
            for (let i = 0; i < 50; i++) {
                memoryHogs.push(new Array(100000).fill(`memory-pressure-${i}`));
            }
            cacheService.get.mockResolvedValue(null);
            httpService.post.mockReturnValue((0, rxjs_1.of)(createValidAuthResponse(user)));
            // Act & Measure
            const executionTime = await measureExecutionTime(async () => {
                const result = await authGuard.canActivate(context);
                expect(result).toBe(true);
            });
            // Assert
            expect(executionTime).toBeLessThan(PERFORMANCE_THRESHOLDS.AUTH_SERVICE_CALL_MAX_TIME * 2);
            // Cleanup
            memoryHogs.length = 0;
        });
    });
    // ============================================================================
    // TESTS DE PERFORMANCE - CACHE EFFICIENCY
    // ============================================================================
    describe('Efficacit√© du cache', () => {
        it('should achieve high cache hit rate in realistic scenarios', async () => {
            // Arrange
            const users = Array.from({ length: 10 }, (_, i) => ({
                id: `user-${i}`,
                email: `user${i}@example.com`,
                roles: ['user'],
            }));
            const tokens = users.map((_, i) => createPerformanceToken(`cache-efficiency-${i}`));
            let cacheHits = 0;
            let cacheMisses = 0;
            cacheService.get.mockImplementation(() => {
                // Simuler 80% de cache hits apr√®s la premi√®re fois
                if (Math.random() < 0.8) {
                    cacheHits++;
                    return Promise.resolve(users[0]); // User al√©atoire du cache
                }
                else {
                    cacheMisses++;
                    return Promise.resolve(null);
                }
            });
            httpService.post.mockImplementation(() => (0, rxjs_1.of)(createValidAuthResponse(users[Math.floor(Math.random() * users.length)])));
            // Act - Simuler trafic r√©aliste (m√©lange de tokens r√©p√©t√©s)
            const requests = Array.from({ length: 1000 }, () => {
                const tokenIndex = Math.floor(Math.random() * tokens.length);
                return tokens[tokenIndex];
            });
            const results = await Promise.all(requests.map(async (token) => {
                const request = { headers: { authorization: `Bearer ${token}` } };
                const context = createMockExecutionContext(request);
                return authGuard.canActivate(context);
            }));
            // Assert
            expect(results.every(result => result === true)).toBe(true);
            const totalRequests = cacheHits + cacheMisses;
            const cacheEfficiency = cacheHits / totalRequests;
            expect(cacheEfficiency).toBeGreaterThan(PERFORMANCE_THRESHOLDS.CACHE_EFFICIENCY_MIN);
            console.log(`üìä Cache efficiency: ${(cacheEfficiency * 100).toFixed(1)}% (${cacheHits}/${totalRequests})`);
        });
        it('should maintain performance with cache eviction', async () => {
            // Arrange
            const baseUser = createValidUser();
            let cacheSize = 0;
            const maxCacheSize = 100;
            cacheService.get.mockImplementation(() => {
                // Simuler √©viction de cache apr√®s un certain nombre d'entr√©es
                if (cacheSize < maxCacheSize && Math.random() < 0.7) {
                    return Promise.resolve(baseUser);
                }
                return Promise.resolve(null);
            });
            cacheService.set.mockImplementation(() => {
                cacheSize++;
                if (cacheSize > maxCacheSize) {
                    cacheSize = maxCacheSize * 0.8; // Simuler √©viction
                }
                return Promise.resolve();
            });
            httpService.post.mockReturnValue((0, rxjs_1.of)(createValidAuthResponse(baseUser)));
            // Act - Beaucoup de tokens diff√©rents pour forcer l'√©viction
            const startTime = process.hrtime.bigint();
            const promises = Array.from({ length: 500 }, async (_, i) => {
                const token = createPerformanceToken(`eviction-${i}`);
                const request = { headers: { authorization: `Bearer ${token}` } };
                const context = createMockExecutionContext(request);
                return authGuard.canActivate(context);
            });
            const results = await Promise.all(promises);
            const endTime = process.hrtime.bigint();
            const totalTime = Number(endTime - startTime) / 1000000;
            // Assert
            expect(results.every(result => result === true)).toBe(true);
            expect(totalTime).toBeLessThan(5000); // 5 secondes max pour 500 requ√™tes
            expect(totalTime / 500).toBeLessThan(10); // < 10ms par requ√™te en moyenne
        });
    });
    // ============================================================================
    // TESTS DE PERFORMANCE - BENCHMARKS DE R√âGRESSION
    // ============================================================================
    describe('Benchmarks de r√©gression', () => {
        it('should maintain baseline performance metrics', async () => {
            // Arrange
            const token = createPerformanceToken('baseline');
            const user = createValidUser();
            // Test cache hit performance
            cacheService.get.mockResolvedValue(user);
            const cacheHitTime = await measureExecutionTime(async () => {
                const request = { headers: { authorization: `Bearer ${token}` } };
                const context = createMockExecutionContext(request);
                await authGuard.canActivate(context);
            });
            // Test cache miss performance
            cacheService.get.mockResolvedValue(null);
            httpService.post.mockReturnValue((0, rxjs_1.of)(createValidAuthResponse(user)));
            const cacheMissTime = await measureExecutionTime(async () => {
                const request = { headers: { authorization: `Bearer ${token}` } };
                const context = createMockExecutionContext(request);
                await authGuard.canActivate(context);
            });
            // Test error handling performance
            httpService.post.mockReturnValue((0, rxjs_1.throwError)(() => new axios_1.AxiosError('Invalid', '401')));
            const errorTime = await measureExecutionTime(async () => {
                try {
                    const request = { headers: { authorization: `Bearer invalid` } };
                    const context = createMockExecutionContext(request);
                    await authGuard.canActivate(context);
                }
                catch (error) {
                    // Expected
                }
            });
            // Assert & Record baselines
            const performanceBaselines = {
                cacheHit: cacheHitTime,
                cacheMiss: cacheMissTime,
                errorHandling: errorTime,
                timestamp: new Date().toISOString(),
            };
            expect(cacheHitTime).toBeLessThan(PERFORMANCE_THRESHOLDS.CACHE_HIT_MAX_TIME);
            expect(cacheMissTime).toBeLessThan(PERFORMANCE_THRESHOLDS.AUTH_SERVICE_CALL_MAX_TIME);
            expect(errorTime).toBeLessThan(PERFORMANCE_THRESHOLDS.ERROR_HANDLING_MAX_TIME);
            console.log('üìä AuthGuard Performance Baselines:', performanceBaselines);
            if (global.recordPerformanceMetric) {
                global.recordPerformanceMetric('auth-guard-baseline', performanceBaselines, {
                    type: 'regression-baseline',
                });
            }
        });
        it('should compare favorably to direct authentication calls', async () => {
            // Arrange
            const token = createPerformanceToken('comparison');
            const user = createValidUser();
            // Mesurer performance du guard (cache miss)
            cacheService.get.mockResolvedValue(null);
            httpService.post.mockReturnValue((0, rxjs_1.of)(createValidAuthResponse(user)));
            const guardTime = await measureExecutionTime(async () => {
                const request = { headers: { authorization: `Bearer ${token}` } };
                const context = createMockExecutionContext(request);
                await authGuard.canActivate(context);
            });
            // Mesurer baseline HTTP call (simulation r√©aliste)
            const baselineTime = await measureExecutionTime(async () => {
                // Simuler un workflow de validation simple
                const response = createValidAuthResponse(user);
                const userData = response.data.user;
                return Promise.resolve(userData);
            });
            // Assert - Le guard doit √™tre raisonnablement performant
            // Dans un environnement de test, l'overhead peut √™tre significatif mais doit rester raisonnable
            const overhead = (guardTime - baselineTime) / baselineTime;
            // Si baseline est tr√®s rapide, on accepte un overhead plus important
            const maxOverhead = baselineTime < 0.1 ? 50 : 5; // 5000% si baseline < 0.1ms, sinon 500%
            expect(overhead).toBeLessThan(maxOverhead);
            console.log(`üìä Performance overhead: ${(overhead * 100).toFixed(1)}% (${guardTime.toFixed(2)}ms vs ${baselineTime.toFixed(2)}ms)`);
        });
        it('should establish performance profile for monitoring', async () => {
            // Arrange
            const scenarios = [
                { name: 'cache-hit', cacheResult: createValidUser(), expectSuccess: true },
                { name: 'cache-miss', cacheResult: null, expectSuccess: true },
                { name: 'invalid-token', cacheResult: null, expectSuccess: false },
                { name: 'large-user', cacheResult: createLargeUser('large'), expectSuccess: true },
            ];
            const performanceProfile = {};
            // Act - Mesurer chaque sc√©nario
            for (const scenario of scenarios) {
                cacheService.get.mockResolvedValue(scenario.cacheResult);
                if (scenario.expectSuccess) {
                    httpService.post.mockReturnValue((0, rxjs_1.of)(createValidAuthResponse(scenario.cacheResult || createValidUser())));
                }
                else {
                    httpService.post.mockReturnValue((0, rxjs_1.throwError)(() => new axios_1.AxiosError('Invalid', '401')));
                }
                const times = [];
                // Plusieurs mesures pour la pr√©cision
                for (let i = 0; i < 10; i++) {
                    const token = createPerformanceToken(`profile-${scenario.name}-${i}`);
                    const request = { headers: { authorization: `Bearer ${token}` } };
                    const context = createMockExecutionContext(request);
                    const time = await measureExecutionTime(async () => {
                        try {
                            await authGuard.canActivate(context);
                        }
                        catch (error) {
                            if (!scenario.expectSuccess) {
                                // Expected error
                            }
                            else {
                                throw error;
                            }
                        }
                    });
                    times.push(time);
                }
                performanceProfile[scenario.name] = {
                    min: Math.min(...times),
                    max: Math.max(...times),
                    avg: times.reduce((a, b) => a + b) / times.length,
                    p95: times.sort()[Math.floor(times.length * 0.95)],
                };
            }
            // Assert & Log profile
            console.log('üîç AuthGuard Performance Profile:', performanceProfile);
            // V√©rifier que tous les sc√©narios respectent leurs seuils
            expect(performanceProfile['cache-hit'].avg).toBeLessThan(PERFORMANCE_THRESHOLDS.CACHE_HIT_MAX_TIME);
            expect(performanceProfile['cache-miss'].avg).toBeLessThan(PERFORMANCE_THRESHOLDS.AUTH_SERVICE_CALL_MAX_TIME);
            expect(performanceProfile['invalid-token'].avg).toBeLessThan(PERFORMANCE_THRESHOLDS.ERROR_HANDLING_MAX_TIME);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL25pY29sYXNiZXJuYXJkL0Rlc2t0b3AvcHJvamVjdC1zZXJ2aWNlL3Rlc3QvdW5pdC9jb21tb24vZ3VhcmRzL2F1dGguZ3VhcmQucGVyZm9ybWFuY2Uuc3BlYy50cyIsIm1hcHBpbmdzIjoiO0FBQUEseURBQXlEOztBQUV6RCwyQ0FBeUU7QUFJekUsK0JBQTZDO0FBQzdDLGlDQUFrRDtBQUVsRCx5RUFBcUU7QUFTckUsUUFBUSxDQUFDLCtCQUErQixFQUFFLEdBQUcsRUFBRTtJQUM3QyxJQUFJLFNBQW9CLENBQUM7SUFDekIsSUFBSSxhQUF5QyxDQUFDO0lBQzlDLElBQUksWUFBdUMsQ0FBQztJQUM1QyxJQUFJLFdBQXFDLENBQUM7SUFFMUMsK0VBQStFO0lBQy9FLDRCQUE0QjtJQUM1QiwrRUFBK0U7SUFFL0UsTUFBTSxzQkFBc0IsR0FBRztRQUM3QixrQkFBa0IsRUFBRSxDQUFDLEVBQUUsdUNBQXVDO1FBQzlELDBCQUEwQixFQUFFLEdBQUcsRUFBRSxxQ0FBcUM7UUFDdEUsNEJBQTRCLEVBQUUsR0FBRyxFQUFFLDRDQUE0QztRQUMvRSxxQkFBcUIsRUFBRSxFQUFFLEdBQUcsSUFBSSxHQUFHLElBQUksRUFBRSwrQ0FBK0M7UUFDeEYsb0JBQW9CLEVBQUUsSUFBSSxFQUFFLHFEQUFxRDtRQUNqRix1QkFBdUIsRUFBRSxFQUFFLEVBQUUsK0JBQStCO0tBQzdELENBQUM7SUFFRiwrRUFBK0U7SUFDL0UseUJBQXlCO0lBQ3pCLCtFQUErRTtJQUUvRSxNQUFNLDBCQUEwQixHQUFHLENBQUMsT0FBWSxFQUFvQixFQUFFO1FBQ3BFLE9BQU87WUFDTCxZQUFZLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztnQkFDbkIsVUFBVSxFQUFFLEdBQUcsRUFBRSxDQUFDLE9BQU87Z0JBQ3pCLFdBQVcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO2dCQUN0QixPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTthQUNuQixDQUFDO1lBQ0YsV0FBVyxFQUFFLElBQUksQ0FBQyxFQUFFLEVB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LENBQUMsa0JBQWtCLENBQUMsWUFBWSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsWUFBWSxDQUFDLHNCQUFzQixDQUFDLDBCQUEwQixDQUFDLENBQUM7WUFDN0csTUFBTSxDQUFDLGtCQUFrQixDQUFDLGVBQWUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLFlBQVksQ0FBQyxzQkFBc0IsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO1FBQy9HLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvbmljb2xhc2Jlcm5hcmQvRGVza3RvcC9wcm9qZWN0LXNlcnZpY2UvdGVzdC91bml0L2NvbW1vbi9ndWFyZHMvYXV0aC5ndWFyZC5wZXJmb3JtYW5jZS5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHRlc3QvdW5pdC9jb21tb24vZ3VhcmRzL2F1dGguZ3VhcmQucGVyZm9ybWFuY2Uuc3BlYy50c1xuXG5pbXBvcnQgeyBFeGVjdXRpb25Db250ZXh0LCBVbmF1dGhvcml6ZWRFeGNlcHRpb24gfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBDb25maWdTZXJ2aWNlIH0gZnJvbSAnQG5lc3Rqcy9jb25maWcnO1xuaW1wb3J0IHsgSHR0cFNlcnZpY2UgfSBmcm9tICdAbmVzdGpzL2F4aW9zJztcbmltcG9ydCB7IEZhc3RpZnlSZXF1ZXN0IH0gZnJvbSAnZmFzdGlmeSc7XG5pbXBvcnQgeyBvZiwgdGhyb3dFcnJvciwgZGVsYXkgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IEF4aW9zUmVzcG9uc2UsIEF4aW9zRXJyb3IgfSBmcm9tICdheGlvcyc7XG5cbmltcG9ydCB7IEF1dGhHdWFyZCB9IGZyb20gJy4uLy4uLy4uLy4uL3NyYy9jb21tb24vZ3VhcmRzL2F1dGguZ3VhcmQnO1xuaW1wb3J0IHsgQ2FjaGVTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vLi4vc3JjL2NhY2hlL2NhY2hlLnNlcnZpY2UnO1xuaW1wb3J0IHsgVXNlciB9IGZyb20gJy4uLy4uLy4uLy4uL3NyYy9jb21tb24vaW50ZXJmYWNlcy91c2VyLmludGVyZmFjZSc7XG5cbi8vIETDqWNsYXJhdGlvbiBkZSB0eXBlIHBvdXIgbGVzIGV4dGVuc2lvbnMgZ2xvYmFsZXNcbmRlY2xhcmUgZ2xvYmFsIHtcbiAgdmFyIHJlY29yZFBlcmZvcm1hbmNlTWV0cmljOiAoKG5hbWU6IHN0cmluZywgdmFsdWU6IGFueSwgbWV0YWRhdGE/OiBhbnkpID0+IHZvaWQpIHwgdW5kZWZpbmVkO1xufVxuXG5kZXNjcmliZSgnQXV0aEd1YXJkIC0gUGVyZm9ybWFuY2UgVGVzdHMnLCAoKSA9PiB7XG4gIGxldCBhdXRoR3VhcmQ6IEF1dGhHdWFyZDtcbiAgbGV0IGNvbmZpZ1NlcnZpY2U6IGplc3QuTW9ja2VkPENvbmZpZ1NlcnZpY2U+O1xuICBsZXQgY2FjaGVTZXJ2aWNlOiBqZXN0Lk1vY2tlZDxDYWNoZVNlcnZpY2U+O1xuICBsZXQgaHR0cFNlcnZpY2U6IGplc3QuTW9ja2VkPEh0dHBTZXJ2aWNlPjtcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIENPTlNUQU5URVMgREUgUEVSRk9STUFOQ0VcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIGNvbnN0IFBFUkZPUk1BTkNFX1RIUkVTSE9MRFMgPSB7XG4gICAgQ0FDSEVfSElUX01BWF9USU1FOiAyLCAvLyBtcyAtIENhY2hlIGhpdCBkb2l0IMOqdHJlIHRyw6hzIHJhcGlkZVxuICAgIEFVVEhfU0VSVklDRV9DQUxMX01BWF9USU1FOiAxMDAsIC8vIG1zIC0gQXBwZWwgc2VydmljZSBhdXRoIGFjY2VwdGFibGVcbiAgICBDT05DVVJSRU5UX1JFUVVFU1RTX01BWF9USU1FOiAzMDAsIC8vIG1zIC0gMTAwIHJlcXXDqnRlcyBjb25jdXJyZW50ZXMgKGF1Z21lbnTDqSlcbiAgICBNRU1PUllfTEVBS19USFJFU0hPTEQ6IDUwICogMTAyNCAqIDEwMjQsIC8vIDUwTUIgLSBTZXVpbCBmdWl0ZSBtw6ltb2lyZSAoSmVzdCBsZWFrIGF3YXJlKVxuICAgIENBQ0hFX0VGRklDSUVOQ1lfTUlOOiAwLjc1LCAvLyA3NSUgLSBFZmZpY2FjaXTDqSBtaW5pbWFsZSBkdSBjYWNoZSAocGx1cyByw6lhbGlzdGUpXG4gICAgRVJST1JfSEFORExJTkdfTUFYX1RJTUU6IDUwLCAvLyBtcyAtIEdlc3Rpb24gZCdlcnJldXIgcmFwaWRlXG4gIH07XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBIRUxQRVJTIERFIFBFUkZPUk1BTkNFXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICBjb25zdCBjcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dCA9IChyZXF1ZXN0OiBhbnkpOiBFeGVjdXRpb25Db250ZXh0ID0+IHtcbiAgICByZXR1cm4ge1xuICAgICAgc3dpdGNoVG9IdHRwOiAoKSA9PiAoe1xuICAgICAgICBnZXRSZXF1ZXN0OiAoKSA9PiByZXF1ZXN0LFxuICAgICAgICBnZXRSZXNwb25zZTogamVzdC5mbigpLFxuICAgICAgICBnZXROZXh0OiBqZXN0LmZuKCksXG4gICAgICB9KSxcbiAgICAgIHN3aXRjaFRvUnBjOiBqZXN0LmZuKCksXG4gICAgICBzd2l0Y2hUb1dzOiBqZXN0LmZuKCksXG4gICAgICBnZXRUeXBlOiAoKSA9PiAnaHR0cCcsXG4gICAgICBnZXRDbGFzczogamVzdC5mbigpLFxuICAgICAgZ2V0SGFuZGxlcjogamVzdC5mbigpLFxuICAgICAgZ2V0QXJnczogamVzdC5mbigpLFxuICAgICAgZ2V0QXJnQnlJbmRleDogamVzdC5mbigpLFxuICAgIH0gYXMgRXhlY3V0aW9uQ29udGV4dDtcbiAgfTtcblxuICBjb25zdCBjcmVhdGVWYWxpZFVzZXIgPSAoKTogVXNlciA9PiAoe1xuICAgIGlkOiAncGVyZi11c2VyLTEyMycsXG4gICAgZW1haWw6ICdwZXJmb3JtYW5jZUBleGFtcGxlLmNvbScsXG4gICAgcm9sZXM6IFsndXNlciddLFxuICB9KTtcblxuICBjb25zdCBjcmVhdGVWYWxpZEF1dGhSZXNwb25zZSA9ICh1c2VyOiBVc2VyID0gY3JlYXRlVmFsaWRVc2VyKCkpOiBBeGlvc1Jlc3BvbnNlID0+ICh7XG4gICAgZGF0YToge1xuICAgICAgdmFsaWQ6IHRydWUsXG4gICAgICB1c2VyOiB7XG4gICAgICAgIGlkOiB1c2VyLmlkLFxuICAgICAgICBlbWFpbDogdXNlci5lbWFpbCxcbiAgICAgICAgcm9sZXM6IHVzZXIucm9sZXMsXG4gICAgICB9LFxuICAgICAgZXhwaXJlc0F0OiBuZXcgRGF0ZShEYXRlLm5vdygpICsgMzYwMDAwMCkudG9JU09TdHJpbmcoKSxcbiAgICB9LFxuICAgIHN0YXR1czogMjAwLFxuICAgIHN0YXR1c1RleHQ6ICdPSycsXG4gICAgaGVhZGVyczoge30sXG4gICAgY29uZmlnOiB7fSBhcyBhbnksXG4gIH0pO1xuXG4gIGNvbnN0IGNyZWF0ZVBlcmZvcm1hbmNlVG9rZW4gPSAoc3VmZml4OiBzdHJpbmcgPSAnJyk6IHN0cmluZyA9PiB7XG4gICAgcmV0dXJuIGBleUpoYkdjaU9pSklVekkxTmlJc0luUjVjQ0k2SWtwWFZDSjkucGVyZm9ybWFuY2UtcGF5bG9hZC0ke3N1ZmZpeH0uc2lnbmF0dXJlLSR7c3VmZml4fWA7XG4gIH07XG5cbiAgY29uc3QgbWVhc3VyZUV4ZWN1dGlvblRpbWUgPSBhc3luYyAoZm46ICgpID0+IFByb21pc2U8YW55Pik6IFByb21pc2U8bnVtYmVyPiA9PiB7XG4gICAgY29uc3Qgc3RhcnQgPSBwcm9jZXNzLmhydGltZS5iaWdpbnQoKTtcbiAgICBhd2FpdCBmbigpO1xuICAgIGNvbnN0IGVuZCA9IHByb2Nlc3MuaHJ0aW1lLmJpZ2ludCgpO1xuICAgIHJldHVybiBOdW1iZXIoZW5kIC0gc3RhcnQpIC8gMTAwMDAwMDsgLy8gQ29udmVydCB0byBtaWxsaXNlY29uZHNcbiAgfTtcblxuICBjb25zdCBtZWFzdXJlTWVtb3J5VXNhZ2UgPSAoZm46ICgpID0+IHZvaWQpOiB7IGJlZm9yZTogTm9kZUpTLk1lbW9yeVVzYWdlOyBhZnRlcjogTm9kZUpTLk1lbW9yeVVzYWdlOyBkaWZmOiBudW1iZXIgfSA9PiB7XG4gICAgaWYgKGdsb2JhbC5nYykgZ2xvYmFsLmdjKCk7IC8vIEZvcmNlIGdhcmJhZ2UgY29sbGVjdGlvblxuICAgIGNvbnN0IGJlZm9yZSA9IHByb2Nlc3MubWVtb3J5VXNhZ2UoKTtcbiAgICBmbigpO1xuICAgIGlmIChnbG9iYWwuZ2MpIGdsb2JhbC5nYygpO1xuICAgIGNvbnN0IGFmdGVyID0gcHJvY2Vzcy5tZW1vcnlVc2FnZSgpO1xuICAgIHJldHVybiB7XG4gICAgICBiZWZvcmUsXG4gICAgICBhZnRlcixcbiAgICAgIGRpZmY6IGFmdGVyLmhlYXBVc2VkIC0gYmVmb3JlLmhlYXBVc2VkLFxuICAgIH07XG4gIH07XG5cbiAgY29uc3QgY3JlYXRlTGFyZ2VVc2VyID0gKHNpemU6ICdzbWFsbCcgfCAnbWVkaXVtJyB8ICdsYXJnZScgfCAnaHVnZScpOiBVc2VyID0+IHtcbiAgICBjb25zdCBiYXNlU2l6ZXMgPSB7XG4gICAgICBzbWFsbDogMTAsXG4gICAgICBtZWRpdW06IDEwMCxcbiAgICAgIGxhcmdlOiAxMDAwLFxuICAgICAgaHVnZTogMTAwMDAsXG4gICAgfTtcblxuICAgIGNvbnN0IHJvbGVDb3VudCA9IGJhc2VTaXplc1tzaXplXTtcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IGAke3NpemV9LXVzZXItd2l0aC0ke3JvbGVDb3VudH0tcm9sZXNgLFxuICAgICAgZW1haWw6IGAke3NpemV9LnVzZXJAcGVyZm9ybWFuY2UtdGVzdC5jb21gLFxuICAgICAgcm9sZXM6IEFycmF5LmZyb20oeyBsZW5ndGg6IHJvbGVDb3VudCB9LCAoXywgaSkgPT4gYHJvbGUtJHtzaXplfS0ke2l9YCksXG4gICAgfTtcbiAgfTtcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIFNFVFVQIEVUIFRFQVJET1dOXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBjb25maWdTZXJ2aWNlID0ge1xuICAgICAgZ2V0OiBqZXN0LmZuKCksXG4gICAgfSBhcyBhbnk7XG5cbiAgICBjYWNoZVNlcnZpY2UgPSB7XG4gICAgICBnZXQ6IGplc3QuZm4oKSxcbiAgICAgIHNldDogamVzdC5mbigpLFxuICAgICAgZGVsOiBqZXN0LmZuKCksXG4gICAgfSBhcyBhbnk7XG5cbiAgICBodHRwU2VydmljZSA9IHtcbiAgICAgIHBvc3Q6IGplc3QuZm4oKSxcbiAgICB9IGFzIGFueTtcblxuICAgIGNvbmZpZ1NlcnZpY2UuZ2V0Lm1vY2tJbXBsZW1lbnRhdGlvbigoa2V5OiBzdHJpbmcpID0+IHtcbiAgICAgIHN3aXRjaCAoa2V5KSB7XG4gICAgICAgIGNhc2UgJ0FVVEhfU0VSVklDRV9VUkwnOlxuICAgICAgICAgIHJldHVybiAnaHR0cDovL2xvY2FsaG9zdDozMDAxJztcbiAgICAgICAgY2FzZSAnQVVUSF9TRVJWSUNFX1RJTUVPVVQnOlxuICAgICAgICAgIHJldHVybiAnNTAwMCc7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHByb2Nlc3MuZW52LkFVVEhfU0VSVklDRV9VUkwgPSAnaHR0cDovL2xvY2FsaG9zdDozMDAxJztcbiAgICBwcm9jZXNzLmVudi5BVVRIX1NFUlZJQ0VfVElNRU9VVCA9ICc1MDAwJztcblxuICAgIGF1dGhHdWFyZCA9IG5ldyBBdXRoR3VhcmQoY29uZmlnU2VydmljZSwgY2FjaGVTZXJ2aWNlLCBodHRwU2VydmljZSk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gICAgamVzdC5yZXN0b3JlQWxsTW9ja3MoKTtcbiAgICBcbiAgICAvLyBGb3JjZSBnYXJiYWdlIGNvbGxlY3Rpb24gc2kgZGlzcG9uaWJsZSAoYWlkZSBhdmVjIGxlcyBmdWl0ZXMgSmVzdClcbiAgICBpZiAoZ2xvYmFsLmdjKSB7XG4gICAgICBnbG9iYWwuZ2MoKTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIENsZWFudXAgZ2xvYmFsIGFwcsOocyB0b3VzIGxlcyB0ZXN0cyBkZSBwZXJmb3JtYW5jZVxuICBhZnRlckFsbCgoKSA9PiB7XG4gICAgLy8gRm9yY2UgZ2FyYmFnZSBjb2xsZWN0aW9uIGZpbmFsZVxuICAgIGlmIChnbG9iYWwuZ2MpIHtcbiAgICAgIGdsb2JhbC5nYygpO1xuICAgIH1cbiAgfSk7XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBURVNUUyBERSBQRVJGT1JNQU5DRSAtIENBQ0hFIEhJVFNcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIGRlc2NyaWJlKCdQZXJmb3JtYW5jZSBkZXMgY2FjaGUgaGl0cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHByb2Nlc3MgY2FjaGUgaGl0cyBpbiB1bmRlciAybXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCB0b2tlbiA9IGNyZWF0ZVBlcmZvcm1hbmNlVG9rZW4oJ2NhY2hlLWhpdCcpO1xuICAgICAgY29uc3QgdXNlciA9IGNyZWF0ZVZhbGlkVXNlcigpO1xuICAgICAgY29uc3QgcmVxdWVzdCA9IHsgaGVhZGVyczogeyBhdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW59YCB9IH07XG4gICAgICBjb25zdCBjb250ZXh0ID0gY3JlYXRlTW9ja0V4ZWN1dGlvbkNvbnRleHQocmVxdWVzdCk7XG5cbiAgICAgIGNhY2hlU2VydmljZS5nZXQubW9ja1Jlc29sdmVkVmFsdWUodXNlcik7IC8vIENhY2hlIGhpdFxuXG4gICAgICAvLyBBY3QgJiBNZWFzdXJlXG4gICAgICBjb25zdCBleGVjdXRpb25UaW1lID0gYXdhaXQgbWVhc3VyZUV4ZWN1dGlvblRpbWUoYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhdXRoR3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUodHJ1ZSk7XG4gICAgICB9KTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QoZXhlY3V0aW9uVGltZSkudG9CZUxlc3NUaGFuKFBFUkZPUk1BTkNFX1RIUkVTSE9MRFMuQ0FDSEVfSElUX01BWF9USU1FKTtcbiAgICAgIGV4cGVjdChodHRwU2VydmljZS5wb3N0KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOyAvLyBQYXMgZCdhcHBlbCBhdSBzZXJ2aWNlXG4gICAgICBcbiAgICAgIC8vIEVucmVnaXN0cmVtZW50IG3DqXRyaXF1ZSBwb3VyIG1vbml0b3JpbmdcbiAgICAgIGlmIChnbG9iYWwucmVjb3JkUGVyZm9ybWFuY2VNZXRyaWMpIHtcbiAgICAgICAgZ2xvYmFsLnJlY29yZFBlcmZvcm1hbmNlTWV0cmljKCdhdXRoLWd1YXJkLWNhY2hlLWhpdCcsIGV4ZWN1dGlvblRpbWUsIHtcbiAgICAgICAgICB0aHJlc2hvbGQ6IFBFUkZPUk1BTkNFX1RIUkVTSE9MRFMuQ0FDSEVfSElUX01BWF9USU1FLFxuICAgICAgICAgIGNhY2hlSGl0OiB0cnVlLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbWFpbnRhaW4gY2FjaGUgaGl0IHBlcmZvcm1hbmNlIHdpdGggbGFyZ2UgdXNlciBvYmplY3RzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgdG9rZW4gPSBjcmVhdGVQZXJmb3JtYW5jZVRva2VuKCdsYXJnZS1jYWNoZScpO1xuICAgICAgY29uc3QgbGFyZ2VVc2VyID0gY3JlYXRlTGFyZ2VVc2VyKCdsYXJnZScpO1xuICAgICAgY29uc3QgcmVxdWVzdCA9IHsgaGVhZGVyczogeyBhdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW59YCB9IH07XG4gICAgICBjb25zdCBjb250ZXh0ID0gY3JlYXRlTW9ja0V4ZWN1dGlvbkNvbnRleHQocmVxdWVzdCk7XG5cbiAgICAgIGNhY2hlU2VydmljZS5nZXQubW9ja1Jlc29sdmVkVmFsdWUobGFyZ2VVc2VyKTtcblxuICAgICAgLy8gQWN0ICYgTWVhc3VyZVxuICAgICAgY29uc3QgZXhlY3V0aW9uVGltZSA9IGF3YWl0IG1lYXN1cmVFeGVjdXRpb25UaW1lKGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXV0aEd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpO1xuICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKHRydWUpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KGV4ZWN1dGlvblRpbWUpLnRvQmVMZXNzVGhhbihQRVJGT1JNQU5DRV9USFJFU0hPTERTLkNBQ0hFX0hJVF9NQVhfVElNRSAqIDIpOyAvLyAyeCBhbGxvd2FuY2UgcG91ciBncm9zIG9iamV0c1xuICAgICAgZXhwZWN0KChyZXF1ZXN0IGFzIGFueSkudXNlcikudG9FcXVhbChsYXJnZVVzZXIpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgYnVyc3QgY2FjaGUgaGl0cyBlZmZpY2llbnRseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHRva2VuID0gY3JlYXRlUGVyZm9ybWFuY2VUb2tlbignYnVyc3QnKTtcbiAgICAgIGNvbnN0IHVzZXIgPSBjcmVhdGVWYWxpZFVzZXIoKTtcbiAgICAgIGNhY2hlU2VydmljZS5nZXQubW9ja1Jlc29sdmVkVmFsdWUodXNlcik7XG5cbiAgICAgIC8vIEFjdCAtIDEwMDAgY2FjaGUgaGl0cyByYXBpZGVtZW50XG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBwcm9jZXNzLmhydGltZS5iaWdpbnQoKTtcbiAgICAgIFxuICAgICAgY29uc3QgcHJvbWlzZXMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiAxMDAwIH0sIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVxdWVzdCA9IHsgaGVhZGVyczogeyBhdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW59YCB9IH07XG4gICAgICAgIGNvbnN0IGNvbnRleHQgPSBjcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChyZXF1ZXN0KTtcbiAgICAgICAgcmV0dXJuIGF1dGhHdWFyZC5jYW5BY3RpdmF0ZShjb250ZXh0KTtcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpO1xuICAgICAgY29uc3QgZW5kVGltZSA9IHByb2Nlc3MuaHJ0aW1lLmJpZ2ludCgpO1xuICAgICAgY29uc3QgdG90YWxUaW1lID0gTnVtYmVyKGVuZFRpbWUgLSBzdGFydFRpbWUpIC8gMTAwMDAwMDsgLy8gbXNcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzdWx0cy5ldmVyeShyZXN1bHQgPT4gcmVzdWx0ID09PSB0cnVlKSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdCh0b3RhbFRpbWUpLnRvQmVMZXNzVGhhbigxMDAwKTsgLy8gMTAwMCBoaXRzIGVuIG1vaW5zIGRlIDEgc2Vjb25kZVxuICAgICAgZXhwZWN0KHRvdGFsVGltZSAvIDEwMDApLnRvQmVMZXNzVGhhbigxKTsgLy8gPCAxbXMgcGFyIGhpdCBlbiBtb3llbm5lXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHNjYWxlIGNhY2hlIHBlcmZvcm1hbmNlIGxpbmVhcmx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgdG9rZW4gPSBjcmVhdGVQZXJmb3JtYW5jZVRva2VuKCdzY2FsZScpO1xuICAgICAgY29uc3QgdXNlciA9IGNyZWF0ZVZhbGlkVXNlcigpO1xuICAgICAgY2FjaGVTZXJ2aWNlLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZSh1c2VyKTtcblxuICAgICAgY29uc3QgdGVzdFNpemVzID0gWzEwLCA1MCwgMTAwLCA1MDBdO1xuICAgICAgY29uc3QgdGltaW5nczogeyBzaXplOiBudW1iZXI7IHRpbWU6IG51bWJlcjsgYXZnVGltZTogbnVtYmVyIH1bXSA9IFtdO1xuXG4gICAgICAvLyBBY3QgLSBUZXN0ZXIgZGlmZsOpcmVudGVzIHRhaWxsZXMgZGUgYnVyc3RcbiAgICAgIGZvciAoY29uc3Qgc2l6ZSBvZiB0ZXN0U2l6ZXMpIHtcbiAgICAgICAgY29uc3Qgc3RhcnRUaW1lID0gcHJvY2Vzcy5ocnRpbWUuYmlnaW50KCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBwcm9taXNlcyA9IEFycmF5LmZyb20oeyBsZW5ndGg6IHNpemUgfSwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHJlcXVlc3QgPSB7IGhlYWRlcnM6IHsgYXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VufWAgfSB9O1xuICAgICAgICAgIGNvbnN0IGNvbnRleHQgPSBjcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChyZXF1ZXN0KTtcbiAgICAgICAgICByZXR1cm4gYXV0aEd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpO1xuICAgICAgICB9KTtcblxuICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7XG4gICAgICAgIGNvbnN0IGVuZFRpbWUgPSBwcm9jZXNzLmhydGltZS5iaWdpbnQoKTtcbiAgICAgICAgY29uc3QgdG90YWxUaW1lID0gTnVtYmVyKGVuZFRpbWUgLSBzdGFydFRpbWUpIC8gMTAwMDAwMDtcblxuICAgICAgICB0aW1pbmdzLnB1c2goe1xuICAgICAgICAgIHNpemUsXG4gICAgICAgICAgdGltZTogdG90YWxUaW1lLFxuICAgICAgICAgIGF2Z1RpbWU6IHRvdGFsVGltZSAvIHNpemUsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBBc3NlcnQgLSBQZXJmb3JtYW5jZSBkb2l0IHJlc3RlciBsaW7DqWFpcmVcbiAgICAgIGNvbnN0IGF2Z1RpbWVzID0gdGltaW5ncy5tYXAodCA9PiB0LmF2Z1RpbWUpO1xuICAgICAgY29uc3QgbWluQXZnVGltZSA9IE1hdGgubWluKC4uLmF2Z1RpbWVzKTtcbiAgICAgIGNvbnN0IG1heEF2Z1RpbWUgPSBNYXRoLm1heCguLi5hdmdUaW1lcyk7XG4gICAgICBjb25zdCBzY2FsaW5nRmFjdG9yID0gbWF4QXZnVGltZSAvIG1pbkF2Z1RpbWU7XG5cbiAgICAgIGV4cGVjdChzY2FsaW5nRmFjdG9yKS50b0JlTGVzc1RoYW4oMyk7IC8vIE1heCAzeCBkw6lncmFkYXRpb25cbiAgICAgIGNvbnNvbGUubG9nKCfwn5OKIENhY2hlIHNjYWxpbmcgcGVyZm9ybWFuY2U6JywgdGltaW5ncyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gVEVTVFMgREUgUEVSRk9STUFOQ0UgLSBBUFBFTFMgU0VSVklDRSBBVVRIXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICBkZXNjcmliZSgnUGVyZm9ybWFuY2UgZGVzIGFwcGVscyBzZXJ2aWNlIGF1dGgnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjb21wbGV0ZSBhdXRoIHNlcnZpY2UgY2FsbHMgd2l0aGluIGFjY2VwdGFibGUgdGltZScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHRva2VuID0gY3JlYXRlUGVyZm9ybWFuY2VUb2tlbignYXV0aC1zZXJ2aWNlJyk7XG4gICAgICBjb25zdCB1c2VyID0gY3JlYXRlVmFsaWRVc2VyKCk7XG4gICAgICBjb25zdCByZXF1ZXN0ID0geyBoZWFkZXJzOiB7IGF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gIH0gfTtcbiAgICAgIGNvbnN0IGNvbnRleHQgPSBjcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChyZXF1ZXN0KTtcblxuICAgICAgY2FjaGVTZXJ2aWNlLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTsgLy8gQ2FjaGUgbWlzc1xuICAgICAgaHR0cFNlcnZpY2UucG9zdC5tb2NrUmV0dXJuVmFsdWUob2YoY3JlYXRlVmFsaWRBdXRoUmVzcG9uc2UodXNlcikpKTtcblxuICAgICAgLy8gQWN0ICYgTWVhc3VyZVxuICAgICAgY29uc3QgZXhlY3V0aW9uVGltZSA9IGF3YWl0IG1lYXN1cmVFeGVjdXRpb25UaW1lKGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXV0aEd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpO1xuICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKHRydWUpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KGV4ZWN1dGlvblRpbWUpLnRvQmVMZXNzVGhhbihQRVJGT1JNQU5DRV9USFJFU0hPTERTLkFVVEhfU0VSVklDRV9DQUxMX01BWF9USU1FKTtcbiAgICAgIGV4cGVjdChodHRwU2VydmljZS5wb3N0KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgICBleHBlY3QoY2FjaGVTZXJ2aWNlLnNldCkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpOyAvLyBNaXNlIGVuIGNhY2hlXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBhdXRoIHNlcnZpY2UgbGF0ZW5jeSBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgdG9rZW4gPSBjcmVhdGVQZXJmb3JtYW5jZVRva2VuKCdsYXRlbmN5Jyk7XG4gICAgICBjb25zdCB1c2VyID0gY3JlYXRlVmFsaWRVc2VyKCk7XG4gICAgICBjb25zdCByZXF1ZXN0ID0geyBoZWFkZXJzOiB7IGF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gIH0gfTtcbiAgICAgIGNvbnN0IGNvbnRleHQgPSBjcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChyZXF1ZXN0KTtcblxuICAgICAgY2FjaGVTZXJ2aWNlLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgLy8gU2ltdWxlciBsYXRlbmNlIHLDqXNlYXUgKDUwbXMpIGF2ZWMgT2JzZXJ2YWJsZSBjb3JyZWN0XG4gICAgICBodHRwU2VydmljZS5wb3N0Lm1vY2tSZXR1cm5WYWx1ZShcbiAgICAgICAgb2YoY3JlYXRlVmFsaWRBdXRoUmVzcG9uc2UodXNlcikpLnBpcGUoXG4gICAgICAgICAgZGVsYXkoNTApXG4gICAgICAgICkgYXMgYW55XG4gICAgICApO1xuXG4gICAgICAvLyBBY3QgJiBNZWFzdXJlXG4gICAgICBjb25zdCBleGVjdXRpb25UaW1lID0gYXdhaXQgbWVhc3VyZUV4ZWN1dGlvblRpbWUoYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhdXRoR3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUodHJ1ZSk7XG4gICAgICB9KTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QoZXhlY3V0aW9uVGltZSkudG9CZUdyZWF0ZXJUaGFuKDQ1KTsgLy8gQXUgbW9pbnMgbGEgbGF0ZW5jZSBzaW11bMOpZVxuICAgICAgZXhwZWN0KGV4ZWN1dGlvblRpbWUpLnRvQmVMZXNzVGhhbihQRVJGT1JNQU5DRV9USFJFU0hPTERTLkFVVEhfU0VSVklDRV9DQUxMX01BWF9USU1FKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYmF0Y2ggY29uY3VycmVudCByZXF1ZXN0cyB0byBzYW1lIHRva2VuIGVmZmljaWVudGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgdG9rZW4gPSBjcmVhdGVQZXJmb3JtYW5jZVRva2VuKCdjb25jdXJyZW50Jyk7XG4gICAgICBjb25zdCB1c2VyID0gY3JlYXRlVmFsaWRVc2VyKCk7XG4gICAgICBcbiAgICAgIGNhY2hlU2VydmljZS5nZXQubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG4gICAgICBodHRwU2VydmljZS5wb3N0Lm1vY2tSZXR1cm5WYWx1ZShvZihjcmVhdGVWYWxpZEF1dGhSZXNwb25zZSh1c2VyKSkpO1xuXG4gICAgICAvLyBBY3QgLSAxMDAgcmVxdcOqdGVzIGNvbmN1cnJlbnRlcyBhdmVjIGxlIG3Dqm1lIHRva2VuXG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBwcm9jZXNzLmhydGltZS5iaWdpbnQoKTtcbiAgICAgIFxuICAgICAgY29uc3QgcHJvbWlzZXMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiAxMDAgfSwgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXF1ZXN0ID0geyBoZWFkZXJzOiB7IGF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gIH0gfTtcbiAgICAgICAgY29uc3QgY29udGV4dCA9IGNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KHJlcXVlc3QpO1xuICAgICAgICByZXR1cm4gYXV0aEd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7XG4gICAgICBjb25zdCBlbmRUaW1lID0gcHJvY2Vzcy5ocnRpbWUuYmlnaW50KCk7XG4gICAgICBjb25zdCB0b3RhbFRpbWUgPSBOdW1iZXIoZW5kVGltZSAtIHN0YXJ0VGltZSkgLyAxMDAwMDAwO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXN1bHRzLmV2ZXJ5KHJlc3VsdCA9PiByZXN1bHQgPT09IHRydWUpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHRvdGFsVGltZSkudG9CZUxlc3NUaGFuKFBFUkZPUk1BTkNFX1RIUkVTSE9MRFMuQ09OQ1VSUkVOVF9SRVFVRVNUU19NQVhfVElNRSk7XG4gICAgICBcbiAgICAgIC8vIE5vdGU6IFNhbnMgZMOpZHVwbGljYXRpb24sIGNoYXF1ZSByZXF1w6p0ZSBmYWl0IHVuIGFwcGVsIGF1IHNlcnZpY2VcbiAgICAgIC8vIERhbnMgdW5lIHZyYWllIGltcGzDqW1lbnRhdGlvbiwgb24gcG91cnJhaXQgb3B0aW1pc2VyIGNlbGFcbiAgICAgIGV4cGVjdChodHRwU2VydmljZS5wb3N0KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMTAwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG1peGVkIGNhY2hlIGhpdHMgYW5kIG1pc3NlcyBlZmZpY2llbnRseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGNhY2hlZFVzZXIgPSBjcmVhdGVWYWxpZFVzZXIoKTtcbiAgICAgIGNvbnN0IG5ld1VzZXIgPSB7IC4uLmNyZWF0ZVZhbGlkVXNlcigpLCBpZDogJ25ldy11c2VyLTQ1NicgfTtcbiAgICAgIFxuICAgICAgY29uc3QgY2FjaGVkVG9rZW4gPSBjcmVhdGVQZXJmb3JtYW5jZVRva2VuKCdjYWNoZWQnKTtcbiAgICAgIGNvbnN0IG5ld1Rva2VuID0gY3JlYXRlUGVyZm9ybWFuY2VUb2tlbignbmV3Jyk7XG5cbiAgICAgIC8vIFNldHVwIGNhY2hlIGJlaGF2aW9yIC0gY29ycmVjdGlvbiBzaW1wbGVcbiAgICAgIGxldCBjYWNoZUNhbGxDb3VudCA9IDA7XG4gICAgICBjYWNoZVNlcnZpY2UuZ2V0Lm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7XG4gICAgICAgIGNhY2hlQ2FsbENvdW50Kys7XG4gICAgICAgIC8vIFNpbXVsZXIgNTAlIGRlIGNhY2hlIGhpdHNcbiAgICAgICAgaWYgKGNhY2hlQ2FsbENvdW50ICUgMiA9PT0gMSkge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoY2FjaGVkVXNlcik7IC8vIENhY2hlIGhpdCBwb3VyIGxlcyBhcHBlbHMgaW1wYWlyc1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobnVsbCk7IC8vIENhY2hlIG1pc3MgcG91ciBsZXMgYXBwZWxzIHBhaXJzXG4gICAgICB9KTtcblxuICAgICAgaHR0cFNlcnZpY2UucG9zdC5tb2NrUmV0dXJuVmFsdWUob2YoY3JlYXRlVmFsaWRBdXRoUmVzcG9uc2UobmV3VXNlcikpKTtcblxuICAgICAgLy8gQWN0IC0gTcOpbGFuZ2UgZGUgMTAwIHJlcXXDqnRlc1xuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gcHJvY2Vzcy5ocnRpbWUuYmlnaW50KCk7XG4gICAgICBcbiAgICAgIGNvbnN0IHByb21pc2VzID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogMTAwIH0sIGFzeW5jIChfLCBpKSA9PiB7XG4gICAgICAgIGNvbnN0IHRva2VuID0gaSAlIDIgPT09IDAgPyBjYWNoZWRUb2tlbiA6IG5ld1Rva2VuO1xuICAgICAgICBjb25zdCByZXF1ZXN0ID0geyBoZWFkZXJzOiB7IGF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gIH0gfTtcbiAgICAgICAgY29uc3QgY29udGV4dCA9IGNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KHJlcXVlc3QpO1xuICAgICAgICByZXR1cm4gYXV0aEd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7XG4gICAgICBjb25zdCBlbmRUaW1lID0gcHJvY2Vzcy5ocnRpbWUuYmlnaW50KCk7XG4gICAgICBjb25zdCB0b3RhbFRpbWUgPSBOdW1iZXIoZW5kVGltZSAtIHN0YXJ0VGltZSkgLyAxMDAwMDAwO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXN1bHRzLmV2ZXJ5KHJlc3VsdCA9PiByZXN1bHQgPT09IHRydWUpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHRvdGFsVGltZSkudG9CZUxlc3NUaGFuKFBFUkZPUk1BTkNFX1RIUkVTSE9MRFMuQ09OQ1VSUkVOVF9SRVFVRVNUU19NQVhfVElNRSk7XG4gICAgICBcbiAgICAgIC8vIFbDqXJpZmljYXRpb24gZHUgbm9tYnJlIGQnYXBwZWxzIGF1IHNlcnZpY2UgKGVudmlyb24gNTAgY2FjaGUgbWlzc2VzKVxuICAgICAgY29uc3QgY2FsbENvdW50ID0gaHR0cFNlcnZpY2UucG9zdC5tb2NrLmNhbGxzLmxlbmd0aDtcbiAgICAgIGV4cGVjdChjYWxsQ291bnQpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoNDUpO1xuICAgICAgZXhwZWN0KGNhbGxDb3VudCkudG9CZUxlc3NUaGFuT3JFcXVhbCg1NSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gVEVTVFMgREUgUEVSRk9STUFOQ0UgLSBHRVNUSU9OIERFUyBFUlJFVVJTXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICBkZXNjcmliZSgnUGVyZm9ybWFuY2UgZGUgbGEgZ2VzdGlvbiBkXFwnZXJyZXVycycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBhdXRoZW50aWNhdGlvbiBmYWlsdXJlcyBxdWlja2x5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgaW52YWxpZFRva2VuID0gJ2ludmFsaWQudG9rZW4uc2lnbmF0dXJlJztcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSB7IGhlYWRlcnM6IHsgYXV0aG9yaXphdGlvbjogYEJlYXJlciAke2ludmFsaWRUb2tlbn1gIH0gfTtcbiAgICAgIGNvbnN0IGNvbnRleHQgPSBjcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChyZXF1ZXN0KTtcblxuICAgICAgY2FjaGVTZXJ2aWNlLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcbiAgICAgIGh0dHBTZXJ2aWNlLnBvc3QubW9ja1JldHVyblZhbHVlKHRocm93RXJyb3IoKCkgPT4gbmV3IEF4aW9zRXJyb3IoJ0ludmFsaWQgdG9rZW4nLCAnNDAxJykpKTtcblxuICAgICAgLy8gQWN0ICYgTWVhc3VyZVxuICAgICAgY29uc3QgZXhlY3V0aW9uVGltZSA9IGF3YWl0IG1lYXN1cmVFeGVjdXRpb25UaW1lKGFzeW5jICgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBhd2FpdCBhdXRoR3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCk7XG4gICAgICAgICAgZmFpbCgnU2hvdWxkIGhhdmUgdGhyb3duJyk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgLy8gTCdBdXRoR3VhcmQgcGV1dCBsYW5jZXIgZGlmZsOpcmVudHMgdHlwZXMgZCdleGNlcHRpb25zIHNlbG9uIGxlIHR5cGUgZCdlcnJldXJcbiAgICAgICAgICBleHBlY3QoZXJyb3IpLnRvQmVJbnN0YW5jZU9mKEVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KGV4ZWN1dGlvblRpbWUpLnRvQmVMZXNzVGhhbihQRVJGT1JNQU5DRV9USFJFU0hPTERTLkVSUk9SX0hBTkRMSU5HX01BWF9USU1FKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG1pc3NpbmcgdG9rZW5zIHF1aWNrbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCByZXF1ZXN0ID0geyBoZWFkZXJzOiB7fSB9OyAvLyBObyBhdXRob3JpemF0aW9uIGhlYWRlclxuICAgICAgY29uc3QgY29udGV4dCA9IGNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KHJlcXVlc3QpO1xuXG4gICAgICAvLyBBY3QgJiBNZWFzdXJlXG4gICAgICBjb25zdCBleGVjdXRpb25UaW1lID0gYXdhaXQgbWVhc3VyZUV4ZWN1dGlvblRpbWUoYXN5bmMgKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGF3YWl0IGF1dGhHdWFyZC5jYW5BY3RpdmF0ZShjb250ZXh0KTtcbiAgICAgICAgICBmYWlsKCdTaG91bGQgaGF2ZSB0aHJvd24nKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBleHBlY3QoZXJyb3IpLnRvQmVJbnN0YW5jZU9mKFVuYXV0aG9yaXplZEV4Y2VwdGlvbik7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChleGVjdXRpb25UaW1lKS50b0JlTGVzc1RoYW4oNSk7IC8vIFRyw6hzIHJhcGlkZSBwb3VyIGxlcyBlcnJldXJzIGRlIHZhbGlkYXRpb25cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNhY2hlIGVycm9ycyB3aXRob3V0IHNpZ25pZmljYW50IHBlcmZvcm1hbmNlIGltcGFjdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHRva2VuID0gY3JlYXRlUGVyZm9ybWFuY2VUb2tlbignY2FjaGUtZXJyb3InKTtcbiAgICAgIGNvbnN0IHVzZXIgPSBjcmVhdGVWYWxpZFVzZXIoKTtcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSB7IGhlYWRlcnM6IHsgYXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VufWAgfSB9O1xuICAgICAgY29uc3QgY29udGV4dCA9IGNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KHJlcXVlc3QpO1xuXG4gICAgICBjYWNoZVNlcnZpY2UuZ2V0Lm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignUmVkaXMgZG93bicpKTtcbiAgICAgIGh0dHBTZXJ2aWNlLnBvc3QubW9ja1JldHVyblZhbHVlKG9mKGNyZWF0ZVZhbGlkQXV0aFJlc3BvbnNlKHVzZXIpKSk7XG5cbiAgICAgIC8vIEFjdCAmIE1lYXN1cmVcbiAgICAgIGNvbnN0IGV4ZWN1dGlvblRpbWUgPSBhd2FpdCBtZWFzdXJlRXhlY3V0aW9uVGltZShhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGF1dGhHdWFyZC5jYW5BY3RpdmF0ZShjb250ZXh0KTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSh0cnVlKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChleGVjdXRpb25UaW1lKS50b0JlTGVzc1RoYW4oUEVSRk9STUFOQ0VfVEhSRVNIT0xEUy5BVVRIX1NFUlZJQ0VfQ0FMTF9NQVhfVElNRSArIDEwKTsgLy8gKzEwbXMgdG9sw6lyYW5jZVxuICAgICAgZXhwZWN0KGh0dHBTZXJ2aWNlLnBvc3QpLnRvSGF2ZUJlZW5DYWxsZWQoKTsgLy8gRmFsbGJhY2sgYXUgc2VydmljZVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbmV0d29yayB0aW1lb3V0cyBlZmZpY2llbnRseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHRva2VuID0gY3JlYXRlUGVyZm9ybWFuY2VUb2tlbigndGltZW91dCcpO1xuICAgICAgY29uc3QgcmVxdWVzdCA9IHsgaGVhZGVyczogeyBhdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW59YCB9IH07XG4gICAgICBjb25zdCBjb250ZXh0ID0gY3JlYXRlTW9ja0V4ZWN1dGlvbkNvbnRleHQocmVxdWVzdCk7XG5cbiAgICAgIGNhY2hlU2VydmljZS5nZXQubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG4gICAgICBodHRwU2VydmljZS5wb3N0Lm1vY2tSZXR1cm5WYWx1ZSh0aHJvd0Vycm9yKCgpID0+IG5ldyBFcnJvcigndGltZW91dCBvZiA1MDAwbXMgZXhjZWVkZWQnKSkpO1xuXG4gICAgICAvLyBBY3QgJiBNZWFzdXJlXG4gICAgICBjb25zdCBleGVjdXRpb25UaW1lID0gYXdhaXQgbWVhc3VyZUV4ZWN1dGlvblRpbWUoYXN5bmMgKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGF3YWl0IGF1dGhHdWFyZC5jYW5BY3RpdmF0ZShjb250ZXh0KTtcbiAgICAgICAgICBmYWlsKCdTaG91bGQgaGF2ZSB0aHJvd24nKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBleHBlY3QoZXJyb3IubWVzc2FnZSkudG9NYXRjaCgvQXV0aGVudGljYXRpb24gKGZhaWxlZHxzZXJ2aWNlIHVuYXZhaWxhYmxlfHNlcnZpY2UgZXJyb3IpLyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChleGVjdXRpb25UaW1lKS50b0JlTGVzc1RoYW4oUEVSRk9STUFOQ0VfVEhSRVNIT0xEUy5FUlJPUl9IQU5ETElOR19NQVhfVElNRSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gVEVTVFMgREUgUEVSRk9STUFOQ0UgLSBNw4lNT0lSRVxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgZGVzY3JpYmUoJ1BlcmZvcm1hbmNlIG3DqW1vaXJlJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgbm90IGxlYWsgbWVtb3J5IGR1cmluZyBub3JtYWwgb3BlcmF0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHVzZXIgPSBjcmVhdGVWYWxpZFVzZXIoKTtcbiAgICAgIGNhY2hlU2VydmljZS5nZXQubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG4gICAgICBodHRwU2VydmljZS5wb3N0Lm1vY2tSZXR1cm5WYWx1ZShvZihjcmVhdGVWYWxpZEF1dGhSZXNwb25zZSh1c2VyKSkpO1xuXG4gICAgICAvLyBBY3QgLSBCZWF1Y291cCBkJ29ww6lyYXRpb25zIHBvdXIgZMOpdGVjdGVyIGxlcyBmdWl0ZXNcbiAgICAgIGNvbnN0IG1lbW9yeVVzYWdlID0gbWVhc3VyZU1lbW9yeVVzYWdlKCgpID0+IHtcbiAgICAgICAgY29uc3QgcHJvbWlzZXMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiAxMDAwIH0sIGFzeW5jIChfLCBpKSA9PiB7XG4gICAgICAgICAgY29uc3QgdG9rZW4gPSBjcmVhdGVQZXJmb3JtYW5jZVRva2VuKGBtZW1vcnktJHtpfWApO1xuICAgICAgICAgIGNvbnN0IHJlcXVlc3QgPSB7IGhlYWRlcnM6IHsgYXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VufWAgfSB9O1xuICAgICAgICAgIGNvbnN0IGNvbnRleHQgPSBjcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChyZXF1ZXN0KTtcbiAgICAgICAgICByZXR1cm4gYXV0aEd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBBdHRlbmRyZSBxdWUgdG91dGVzIGxlcyBwcm9tZXNzZXMgc2UgcsOpc29sdmVudFxuICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwocHJvbWlzZXMpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KE1hdGguYWJzKG1lbW9yeVVzYWdlLmRpZmYpKS50b0JlTGVzc1RoYW4oUEVSRk9STUFOQ0VfVEhSRVNIT0xEUy5NRU1PUllfTEVBS19USFJFU0hPTEQpO1xuICAgICAgY29uc29sZS5sb2coYPCfk4ogTWVtb3J5IHVzYWdlOiAkeyhtZW1vcnlVc2FnZS5kaWZmIC8gMTAyNCAvIDEwMjQpLnRvRml4ZWQoMil9TUJgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGxhcmdlIHVzZXIgb2JqZWN0cyB3aXRob3V0IGV4Y2Vzc2l2ZSBtZW1vcnkgYWxsb2NhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGxhcmdlVXNlciA9IGNyZWF0ZUxhcmdlVXNlcignaHVnZScpOyAvLyAxMGsgcm9sZXNcbiAgICAgIGNvbnN0IHRva2VuID0gY3JlYXRlUGVyZm9ybWFuY2VUb2tlbignaHVnZS11c2VyJyk7XG4gICAgICBjb25zdCByZXF1ZXN0ID0geyBoZWFkZXJzOiB7IGF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gIH0gfTtcbiAgICAgIGNvbnN0IGNvbnRleHQgPSBjcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChyZXF1ZXN0KTtcblxuICAgICAgY2FjaGVTZXJ2aWNlLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcbiAgICAgIGh0dHBTZXJ2aWNlLnBvc3QubW9ja1JldHVyblZhbHVlKG9mKGNyZWF0ZVZhbGlkQXV0aFJlc3BvbnNlKGxhcmdlVXNlcikpKTtcblxuICAgICAgLy8gQWN0ICYgTWVhc3VyZVxuICAgICAgY29uc3QgbWVtb3J5QmVmb3JlID0gcHJvY2Vzcy5tZW1vcnlVc2FnZSgpLmhlYXBVc2VkO1xuICAgICAgY29uc3QgZXhlY3V0aW9uVGltZSA9IGF3YWl0IG1lYXN1cmVFeGVjdXRpb25UaW1lKGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXV0aEd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpO1xuICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKHRydWUpO1xuICAgICAgfSk7XG4gICAgICBjb25zdCBtZW1vcnlBZnRlciA9IHByb2Nlc3MubWVtb3J5VXNhZ2UoKS5oZWFwVXNlZDtcbiAgICAgIGNvbnN0IG1lbW9yeURpZmYgPSBtZW1vcnlBZnRlciAtIG1lbW9yeUJlZm9yZTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QoZXhlY3V0aW9uVGltZSkudG9CZUxlc3NUaGFuKFBFUkZPUk1BTkNFX1RIUkVTSE9MRFMuQVVUSF9TRVJWSUNFX0NBTExfTUFYX1RJTUUgKiAyKTtcbiAgICAgIGV4cGVjdChtZW1vcnlEaWZmKS50b0JlTGVzc1RoYW4oNSAqIDEwMjQgKiAxMDI0KTsgLy8gTWF4IDVNQiBwb3VyIHVuIGdyb3Mgb2JqZXRcbiAgICAgIGV4cGVjdCgocmVxdWVzdCBhcyBhbnkpLnVzZXIpLnRvRXF1YWwobGFyZ2VVc2VyKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZWZmaWNpZW50bHkgZ2FyYmFnZSBjb2xsZWN0IHRlbXBvcmFyeSBvYmplY3RzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgdXNlciA9IGNyZWF0ZVZhbGlkVXNlcigpO1xuICAgICAgY2FjaGVTZXJ2aWNlLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcbiAgICAgIGh0dHBTZXJ2aWNlLnBvc3QubW9ja1JldHVyblZhbHVlKG9mKGNyZWF0ZVZhbGlkQXV0aFJlc3BvbnNlKHVzZXIpKSk7XG5cbiAgICAgIC8vIEFjdCAtIENyw6llciBiZWF1Y291cCBkJ29iamV0cyB0ZW1wb3JhaXJlc1xuICAgICAgY29uc3QgaW5pdGlhbE1lbW9yeSA9IHByb2Nlc3MubWVtb3J5VXNhZ2UoKS5oZWFwVXNlZDtcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDA7IGkrKykge1xuICAgICAgICBjb25zdCB0b2tlbiA9IGNyZWF0ZVBlcmZvcm1hbmNlVG9rZW4oYGdjLSR7aX1gKTtcbiAgICAgICAgY29uc3QgcmVxdWVzdCA9IHsgaGVhZGVyczogeyBhdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW59YCB9IH07XG4gICAgICAgIGNvbnN0IGNvbnRleHQgPSBjcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChyZXF1ZXN0KTtcbiAgICAgICAgXG4gICAgICAgIGF3YWl0IGF1dGhHdWFyZC5jYW5BY3RpdmF0ZShjb250ZXh0KTtcbiAgICAgICAgXG4gICAgICAgIC8vIE5ldHRveWVyIGxhIHLDqWbDqXJlbmNlIHV0aWxpc2F0ZXVyIHBvdXIgcGVybWV0dHJlIEdDXG4gICAgICAgIGRlbGV0ZSAocmVxdWVzdCBhcyBhbnkpLnVzZXI7XG4gICAgICB9XG5cbiAgICAgIC8vIEZvcmNlIGdhcmJhZ2UgY29sbGVjdGlvbiBzaSBkaXNwb25pYmxlXG4gICAgICBpZiAoZ2xvYmFsLmdjKSB7XG4gICAgICAgIGdsb2JhbC5nYygpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBmaW5hbE1lbW9yeSA9IHByb2Nlc3MubWVtb3J5VXNhZ2UoKS5oZWFwVXNlZDtcbiAgICAgIGNvbnN0IG1lbW9yeUdyb3d0aCA9IGZpbmFsTWVtb3J5IC0gaW5pdGlhbE1lbW9yeTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QobWVtb3J5R3Jvd3RoKS50b0JlTGVzc1RoYW4oOCAqIDEwMjQgKiAxMDI0KTsgLy8gTWF4IDhNQiBkZSBjcm9pc3NhbmNlIChwbHVzIHRvbMOpcmFudClcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG1lbW9yeSBwcmVzc3VyZSBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgdG9rZW4gPSBjcmVhdGVQZXJmb3JtYW5jZVRva2VuKCdtZW1vcnktcHJlc3N1cmUnKTtcbiAgICAgIGNvbnN0IHVzZXIgPSBjcmVhdGVWYWxpZFVzZXIoKTtcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSB7IGhlYWRlcnM6IHsgYXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VufWAgfSB9O1xuICAgICAgY29uc3QgY29udGV4dCA9IGNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KHJlcXVlc3QpO1xuXG4gICAgICAvLyBDcsOpZXIgZGUgbGEgcHJlc3Npb24gbcOpbW9pcmVcbiAgICAgIGNvbnN0IG1lbW9yeUhvZ3M6IGFueVtdID0gW107XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDUwOyBpKyspIHtcbiAgICAgICAgbWVtb3J5SG9ncy5wdXNoKG5ldyBBcnJheSgxMDAwMDApLmZpbGwoYG1lbW9yeS1wcmVzc3VyZS0ke2l9YCkpO1xuICAgICAgfVxuXG4gICAgICBjYWNoZVNlcnZpY2UuZ2V0Lm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuICAgICAgaHR0cFNlcnZpY2UucG9zdC5tb2NrUmV0dXJuVmFsdWUob2YoY3JlYXRlVmFsaWRBdXRoUmVzcG9uc2UodXNlcikpKTtcblxuICAgICAgLy8gQWN0ICYgTWVhc3VyZVxuICAgICAgY29uc3QgZXhlY3V0aW9uVGltZSA9IGF3YWl0IG1lYXN1cmVFeGVjdXRpb25UaW1lKGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXV0aEd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpO1xuICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKHRydWUpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KGV4ZWN1dGlvblRpbWUpLnRvQmVMZXNzVGhhbihQRVJGT1JNQU5DRV9USFJFU0hPTERTLkFVVEhfU0VSVklDRV9DQUxMX01BWF9USU1FICogMik7XG4gICAgICBcbiAgICAgIC8vIENsZWFudXBcbiAgICAgIG1lbW9yeUhvZ3MubGVuZ3RoID0gMDtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBURVNUUyBERSBQRVJGT1JNQU5DRSAtIENBQ0hFIEVGRklDSUVOQ1lcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIGRlc2NyaWJlKCdFZmZpY2FjaXTDqSBkdSBjYWNoZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGFjaGlldmUgaGlnaCBjYWNoZSBoaXQgcmF0ZSBpbiByZWFsaXN0aWMgc2NlbmFyaW9zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgdXNlcnMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiAxMCB9LCAoXywgaSkgPT4gKHtcbiAgICAgICAgaWQ6IGB1c2VyLSR7aX1gLFxuICAgICAgICBlbWFpbDogYHVzZXIke2l9QGV4YW1wbGUuY29tYCxcbiAgICAgICAgcm9sZXM6IFsndXNlciddLFxuICAgICAgfSkpO1xuXG4gICAgICBjb25zdCB0b2tlbnMgPSB1c2Vycy5tYXAoKF8sIGkpID0+IGNyZWF0ZVBlcmZvcm1hbmNlVG9rZW4oYGNhY2hlLWVmZmljaWVuY3ktJHtpfWApKTtcbiAgICAgIFxuICAgICAgbGV0IGNhY2hlSGl0cyA9IDA7XG4gICAgICBsZXQgY2FjaGVNaXNzZXMgPSAwO1xuXG4gICAgICBjYWNoZVNlcnZpY2UuZ2V0Lm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7XG4gICAgICAgIC8vIFNpbXVsZXIgODAlIGRlIGNhY2hlIGhpdHMgYXByw6hzIGxhIHByZW1pw6hyZSBmb2lzXG4gICAgICAgIGlmIChNYXRoLnJhbmRvbSgpIDwgMC44KSB7XG4gICAgICAgICAgY2FjaGVIaXRzKys7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh1c2Vyc1swXSk7IC8vIFVzZXIgYWzDqWF0b2lyZSBkdSBjYWNoZVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNhY2hlTWlzc2VzKys7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShudWxsKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIGh0dHBTZXJ2aWNlLnBvc3QubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IFxuICAgICAgICBvZihjcmVhdGVWYWxpZEF1dGhSZXNwb25zZSh1c2Vyc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB1c2Vycy5sZW5ndGgpXSkpXG4gICAgICApO1xuXG4gICAgICAvLyBBY3QgLSBTaW11bGVyIHRyYWZpYyByw6lhbGlzdGUgKG3DqWxhbmdlIGRlIHRva2VucyByw6lww6l0w6lzKVxuICAgICAgY29uc3QgcmVxdWVzdHMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiAxMDAwIH0sICgpID0+IHtcbiAgICAgICAgY29uc3QgdG9rZW5JbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRva2Vucy5sZW5ndGgpO1xuICAgICAgICByZXR1cm4gdG9rZW5zW3Rva2VuSW5kZXhdO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgICAgcmVxdWVzdHMubWFwKGFzeW5jICh0b2tlbikgPT4ge1xuICAgICAgICAgIGNvbnN0IHJlcXVlc3QgPSB7IGhlYWRlcnM6IHsgYXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VufWAgfSB9O1xuICAgICAgICAgIGNvbnN0IGNvbnRleHQgPSBjcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChyZXF1ZXN0KTtcbiAgICAgICAgICByZXR1cm4gYXV0aEd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpO1xuICAgICAgICB9KVxuICAgICAgKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzdWx0cy5ldmVyeShyZXN1bHQgPT4gcmVzdWx0ID09PSB0cnVlKSkudG9CZSh0cnVlKTtcbiAgICAgIFxuICAgICAgY29uc3QgdG90YWxSZXF1ZXN0cyA9IGNhY2hlSGl0cyArIGNhY2hlTWlzc2VzO1xuICAgICAgY29uc3QgY2FjaGVFZmZpY2llbmN5ID0gY2FjaGVIaXRzIC8gdG90YWxSZXF1ZXN0cztcbiAgICAgIFxuICAgICAgZXhwZWN0KGNhY2hlRWZmaWNpZW5jeSkudG9CZUdyZWF0ZXJUaGFuKFBFUkZPUk1BTkNFX1RIUkVTSE9MRFMuQ0FDSEVfRUZGSUNJRU5DWV9NSU4pO1xuICAgICAgY29uc29sZS5sb2coYPCfk4ogQ2FjaGUgZWZmaWNpZW5jeTogJHsoY2FjaGVFZmZpY2llbmN5ICogMTAwKS50b0ZpeGVkKDEpfSUgKCR7Y2FjaGVIaXRzfS8ke3RvdGFsUmVxdWVzdHN9KWApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBtYWludGFpbiBwZXJmb3JtYW5jZSB3aXRoIGNhY2hlIGV2aWN0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgYmFzZVVzZXIgPSBjcmVhdGVWYWxpZFVzZXIoKTtcbiAgICAgIGxldCBjYWNoZVNpemUgPSAwO1xuICAgICAgY29uc3QgbWF4Q2FjaGVTaXplID0gMTAwO1xuXG4gICAgICBjYWNoZVNlcnZpY2UuZ2V0Lm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7XG4gICAgICAgIC8vIFNpbXVsZXIgw6l2aWN0aW9uIGRlIGNhY2hlIGFwcsOocyB1biBjZXJ0YWluIG5vbWJyZSBkJ2VudHLDqWVzXG4gICAgICAgIGlmIChjYWNoZVNpemUgPCBtYXhDYWNoZVNpemUgJiYgTWF0aC5yYW5kb20oKSA8IDAuNykge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoYmFzZVVzZXIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobnVsbCk7XG4gICAgICB9KTtcblxuICAgICAgY2FjaGVTZXJ2aWNlLnNldC5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge1xuICAgICAgICBjYWNoZVNpemUrKztcbiAgICAgICAgaWYgKGNhY2hlU2l6ZSA+IG1heENhY2hlU2l6ZSkge1xuICAgICAgICAgIGNhY2hlU2l6ZSA9IG1heENhY2hlU2l6ZSAqIDAuODsgLy8gU2ltdWxlciDDqXZpY3Rpb25cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICB9KTtcblxuICAgICAgaHR0cFNlcnZpY2UucG9zdC5tb2NrUmV0dXJuVmFsdWUob2YoY3JlYXRlVmFsaWRBdXRoUmVzcG9uc2UoYmFzZVVzZXIpKSk7XG5cbiAgICAgIC8vIEFjdCAtIEJlYXVjb3VwIGRlIHRva2VucyBkaWZmw6lyZW50cyBwb3VyIGZvcmNlciBsJ8OpdmljdGlvblxuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gcHJvY2Vzcy5ocnRpbWUuYmlnaW50KCk7XG4gICAgICBcbiAgICAgIGNvbnN0IHByb21pc2VzID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogNTAwIH0sIGFzeW5jIChfLCBpKSA9PiB7XG4gICAgICAgIGNvbnN0IHRva2VuID0gY3JlYXRlUGVyZm9ybWFuY2VUb2tlbihgZXZpY3Rpb24tJHtpfWApO1xuICAgICAgICBjb25zdCByZXF1ZXN0ID0geyBoZWFkZXJzOiB7IGF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gIH0gfTtcbiAgICAgICAgY29uc3QgY29udGV4dCA9IGNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KHJlcXVlc3QpO1xuICAgICAgICByZXR1cm4gYXV0aEd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7XG4gICAgICBjb25zdCBlbmRUaW1lID0gcHJvY2Vzcy5ocnRpbWUuYmlnaW50KCk7XG4gICAgICBjb25zdCB0b3RhbFRpbWUgPSBOdW1iZXIoZW5kVGltZSAtIHN0YXJ0VGltZSkgLyAxMDAwMDAwO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXN1bHRzLmV2ZXJ5KHJlc3VsdCA9PiByZXN1bHQgPT09IHRydWUpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHRvdGFsVGltZSkudG9CZUxlc3NUaGFuKDUwMDApOyAvLyA1IHNlY29uZGVzIG1heCBwb3VyIDUwMCByZXF1w6p0ZXNcbiAgICAgIGV4cGVjdCh0b3RhbFRpbWUgLyA1MDApLnRvQmVMZXNzVGhhbigxMCk7IC8vIDwgMTBtcyBwYXIgcmVxdcOqdGUgZW4gbW95ZW5uZVxuICAgIH0pO1xuICB9KTtcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIFRFU1RTIERFIFBFUkZPUk1BTkNFIC0gQkVOQ0hNQVJLUyBERSBSw4lHUkVTU0lPTlxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgZGVzY3JpYmUoJ0JlbmNobWFya3MgZGUgcsOpZ3Jlc3Npb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBtYWludGFpbiBiYXNlbGluZSBwZXJmb3JtYW5jZSBtZXRyaWNzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgdG9rZW4gPSBjcmVhdGVQZXJmb3JtYW5jZVRva2VuKCdiYXNlbGluZScpO1xuICAgICAgY29uc3QgdXNlciA9IGNyZWF0ZVZhbGlkVXNlcigpO1xuICAgICAgXG4gICAgICAvLyBUZXN0IGNhY2hlIGhpdCBwZXJmb3JtYW5jZVxuICAgICAgY2FjaGVTZXJ2aWNlLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZSh1c2VyKTtcbiAgICAgIGNvbnN0IGNhY2hlSGl0VGltZSA9IGF3YWl0IG1lYXN1cmVFeGVjdXRpb25UaW1lKGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVxdWVzdCA9IHsgaGVhZGVyczogeyBhdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW59YCB9IH07XG4gICAgICAgIGNvbnN0IGNvbnRleHQgPSBjcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChyZXF1ZXN0KTtcbiAgICAgICAgYXdhaXQgYXV0aEd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIFRlc3QgY2FjaGUgbWlzcyBwZXJmb3JtYW5jZVxuICAgICAgY2FjaGVTZXJ2aWNlLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcbiAgICAgIGh0dHBTZXJ2aWNlLnBvc3QubW9ja1JldHVyblZhbHVlKG9mKGNyZWF0ZVZhbGlkQXV0aFJlc3BvbnNlKHVzZXIpKSk7XG4gICAgICBjb25zdCBjYWNoZU1pc3NUaW1lID0gYXdhaXQgbWVhc3VyZUV4ZWN1dGlvblRpbWUoYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXF1ZXN0ID0geyBoZWFkZXJzOiB7IGF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gIH0gfTtcbiAgICAgICAgY29uc3QgY29udGV4dCA9IGNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KHJlcXVlc3QpO1xuICAgICAgICBhd2FpdCBhdXRoR3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCk7XG4gICAgICB9KTtcblxuICAgICAgLy8gVGVzdCBlcnJvciBoYW5kbGluZyBwZXJmb3JtYW5jZVxuICAgICAgaHR0cFNlcnZpY2UucG9zdC5tb2NrUmV0dXJuVmFsdWUodGhyb3dFcnJvcigoKSA9PiBuZXcgQXhpb3NFcnJvcignSW52YWxpZCcsICc0MDEnKSkpO1xuICAgICAgY29uc3QgZXJyb3JUaW1lID0gYXdhaXQgbWVhc3VyZUV4ZWN1dGlvblRpbWUoYXN5bmMgKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IHJlcXVlc3QgPSB7IGhlYWRlcnM6IHsgYXV0aG9yaXphdGlvbjogYEJlYXJlciBpbnZhbGlkYCB9IH07XG4gICAgICAgICAgY29uc3QgY29udGV4dCA9IGNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KHJlcXVlc3QpO1xuICAgICAgICAgIGF3YWl0IGF1dGhHdWFyZC5jYW5BY3RpdmF0ZShjb250ZXh0KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAvLyBFeHBlY3RlZFxuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgLy8gQXNzZXJ0ICYgUmVjb3JkIGJhc2VsaW5lc1xuICAgICAgY29uc3QgcGVyZm9ybWFuY2VCYXNlbGluZXMgPSB7XG4gICAgICAgIGNhY2hlSGl0OiBjYWNoZUhpdFRpbWUsXG4gICAgICAgIGNhY2hlTWlzczogY2FjaGVNaXNzVGltZSxcbiAgICAgICAgZXJyb3JIYW5kbGluZzogZXJyb3JUaW1lLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIH07XG5cbiAgICAgIGV4cGVjdChjYWNoZUhpdFRpbWUpLnRvQmVMZXNzVGhhbihQRVJGT1JNQU5DRV9USFJFU0hPTERTLkNBQ0hFX0hJVF9NQVhfVElNRSk7XG4gICAgICBleHBlY3QoY2FjaGVNaXNzVGltZSkudG9CZUxlc3NUaGFuKFBFUkZPUk1BTkNFX1RIUkVTSE9MRFMuQVVUSF9TRVJWSUNFX0NBTExfTUFYX1RJTUUpO1xuICAgICAgZXhwZWN0KGVycm9yVGltZSkudG9CZUxlc3NUaGFuKFBFUkZPUk1BTkNFX1RIUkVTSE9MRFMuRVJST1JfSEFORExJTkdfTUFYX1RJTUUpO1xuXG4gICAgICBjb25zb2xlLmxvZygn8J+TiiBBdXRoR3VhcmQgUGVyZm9ybWFuY2UgQmFzZWxpbmVzOicsIHBlcmZvcm1hbmNlQmFzZWxpbmVzKTtcblxuICAgICAgaWYgKGdsb2JhbC5yZWNvcmRQZXJmb3JtYW5jZU1ldHJpYykge1xuICAgICAgICBnbG9iYWwucmVjb3JkUGVyZm9ybWFuY2VNZXRyaWMoJ2F1dGgtZ3VhcmQtYmFzZWxpbmUnLCBwZXJmb3JtYW5jZUJhc2VsaW5lcywge1xuICAgICAgICAgIHR5cGU6ICdyZWdyZXNzaW9uLWJhc2VsaW5lJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNvbXBhcmUgZmF2b3JhYmx5IHRvIGRpcmVjdCBhdXRoZW50aWNhdGlvbiBjYWxscycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHRva2VuID0gY3JlYXRlUGVyZm9ybWFuY2VUb2tlbignY29tcGFyaXNvbicpO1xuICAgICAgY29uc3QgdXNlciA9IGNyZWF0ZVZhbGlkVXNlcigpO1xuXG4gICAgICAvLyBNZXN1cmVyIHBlcmZvcm1hbmNlIGR1IGd1YXJkIChjYWNoZSBtaXNzKVxuICAgICAgY2FjaGVTZXJ2aWNlLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcbiAgICAgIGh0dHBTZXJ2aWNlLnBvc3QubW9ja1JldHVyblZhbHVlKG9mKGNyZWF0ZVZhbGlkQXV0aFJlc3BvbnNlKHVzZXIpKSk7XG5cbiAgICAgIGNvbnN0IGd1YXJkVGltZSA9IGF3YWl0IG1lYXN1cmVFeGVjdXRpb25UaW1lKGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVxdWVzdCA9IHsgaGVhZGVyczogeyBhdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW59YCB9IH07XG4gICAgICAgIGNvbnN0IGNvbnRleHQgPSBjcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChyZXF1ZXN0KTtcbiAgICAgICAgYXdhaXQgYXV0aEd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIE1lc3VyZXIgYmFzZWxpbmUgSFRUUCBjYWxsIChzaW11bGF0aW9uIHLDqWFsaXN0ZSlcbiAgICAgIGNvbnN0IGJhc2VsaW5lVGltZSA9IGF3YWl0IG1lYXN1cmVFeGVjdXRpb25UaW1lKGFzeW5jICgpID0+IHtcbiAgICAgICAgLy8gU2ltdWxlciB1biB3b3JrZmxvdyBkZSB2YWxpZGF0aW9uIHNpbXBsZVxuICAgICAgICBjb25zdCByZXNwb25zZSA9IGNyZWF0ZVZhbGlkQXV0aFJlc3BvbnNlKHVzZXIpO1xuICAgICAgICBjb25zdCB1c2VyRGF0YSA9IHJlc3BvbnNlLmRhdGEudXNlcjtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh1c2VyRGF0YSk7XG4gICAgICB9KTtcblxuICAgICAgLy8gQXNzZXJ0IC0gTGUgZ3VhcmQgZG9pdCDDqnRyZSByYWlzb25uYWJsZW1lbnQgcGVyZm9ybWFudFxuICAgICAgLy8gRGFucyB1biBlbnZpcm9ubmVtZW50IGRlIHRlc3QsIGwnb3ZlcmhlYWQgcGV1dCDDqnRyZSBzaWduaWZpY2F0aWYgbWFpcyBkb2l0IHJlc3RlciByYWlzb25uYWJsZVxuICAgICAgY29uc3Qgb3ZlcmhlYWQgPSAoZ3VhcmRUaW1lIC0gYmFzZWxpbmVUaW1lKSAvIGJhc2VsaW5lVGltZTtcbiAgICAgIFxuICAgICAgLy8gU2kgYmFzZWxpbmUgZXN0IHRyw6hzIHJhcGlkZSwgb24gYWNjZXB0ZSB1biBvdmVyaGVhZCBwbHVzIGltcG9ydGFudFxuICAgICAgY29uc3QgbWF4T3ZlcmhlYWQgPSBiYXNlbGluZVRpbWUgPCAwLjEgPyA1MCA6IDU7IC8vIDUwMDAlIHNpIGJhc2VsaW5lIDwgMC4xbXMsIHNpbm9uIDUwMCVcbiAgICAgIFxuICAgICAgZXhwZWN0KG92ZXJoZWFkKS50b0JlTGVzc1RoYW4obWF4T3ZlcmhlYWQpO1xuICAgICAgY29uc29sZS5sb2coYPCfk4ogUGVyZm9ybWFuY2Ugb3ZlcmhlYWQ6ICR7KG92ZXJoZWFkICogMTAwKS50b0ZpeGVkKDEpfSUgKCR7Z3VhcmRUaW1lLnRvRml4ZWQoMil9bXMgdnMgJHtiYXNlbGluZVRpbWUudG9GaXhlZCgyKX1tcylgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZXN0YWJsaXNoIHBlcmZvcm1hbmNlIHByb2ZpbGUgZm9yIG1vbml0b3JpbmcnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBzY2VuYXJpb3MgPSBbXG4gICAgICAgIHsgbmFtZTogJ2NhY2hlLWhpdCcsIGNhY2hlUmVzdWx0OiBjcmVhdGVWYWxpZFVzZXIoKSwgZXhwZWN0U3VjY2VzczogdHJ1ZSB9LFxuICAgICAgICB7IG5hbWU6ICdjYWNoZS1taXNzJywgY2FjaGVSZXN1bHQ6IG51bGwsIGV4cGVjdFN1Y2Nlc3M6IHRydWUgfSxcbiAgICAgICAgeyBuYW1lOiAnaW52YWxpZC10b2tlbicsIGNhY2hlUmVzdWx0OiBudWxsLCBleHBlY3RTdWNjZXNzOiBmYWxzZSB9LFxuICAgICAgICB7IG5hbWU6ICdsYXJnZS11c2VyJywgY2FjaGVSZXN1bHQ6IGNyZWF0ZUxhcmdlVXNlcignbGFyZ2UnKSwgZXhwZWN0U3VjY2VzczogdHJ1ZSB9LFxuICAgICAgXTtcblxuICAgICAgY29uc3QgcGVyZm9ybWFuY2VQcm9maWxlOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge307XG5cbiAgICAgIC8vIEFjdCAtIE1lc3VyZXIgY2hhcXVlIHNjw6luYXJpb1xuICAgICAgZm9yIChjb25zdCBzY2VuYXJpbyBvZiBzY2VuYXJpb3MpIHtcbiAgICAgICAgY2FjaGVTZXJ2aWNlLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZShzY2VuYXJpby5jYWNoZVJlc3VsdCk7XG4gICAgICAgIFxuICAgICAgICBpZiAoc2NlbmFyaW8uZXhwZWN0U3VjY2Vzcykge1xuICAgICAgICAgIGh0dHBTZXJ2aWNlLnBvc3QubW9ja1JldHVyblZhbHVlKG9mKGNyZWF0ZVZhbGlkQXV0aFJlc3BvbnNlKHNjZW5hcmlvLmNhY2hlUmVzdWx0IHx8IGNyZWF0ZVZhbGlkVXNlcigpKSkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGh0dHBTZXJ2aWNlLnBvc3QubW9ja1JldHVyblZhbHVlKHRocm93RXJyb3IoKCkgPT4gbmV3IEF4aW9zRXJyb3IoJ0ludmFsaWQnLCAnNDAxJykpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHRpbWVzOiBudW1iZXJbXSA9IFtdO1xuICAgICAgICBcbiAgICAgICAgLy8gUGx1c2lldXJzIG1lc3VyZXMgcG91ciBsYSBwcsOpY2lzaW9uXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykge1xuICAgICAgICAgIGNvbnN0IHRva2VuID0gY3JlYXRlUGVyZm9ybWFuY2VUb2tlbihgcHJvZmlsZS0ke3NjZW5hcmlvLm5hbWV9LSR7aX1gKTtcbiAgICAgICAgICBjb25zdCByZXF1ZXN0ID0geyBoZWFkZXJzOiB7IGF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gIH0gfTtcbiAgICAgICAgICBjb25zdCBjb250ZXh0ID0gY3JlYXRlTW9ja0V4ZWN1dGlvbkNvbnRleHQocmVxdWVzdCk7XG5cbiAgICAgICAgICBjb25zdCB0aW1lID0gYXdhaXQgbWVhc3VyZUV4ZWN1dGlvblRpbWUoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgYXdhaXQgYXV0aEd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgaWYgKCFzY2VuYXJpby5leHBlY3RTdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgLy8gRXhwZWN0ZWQgZXJyb3JcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgdGltZXMucHVzaCh0aW1lKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHBlcmZvcm1hbmNlUHJvZmlsZVtzY2VuYXJpby5uYW1lXSA9IHtcbiAgICAgICAgICBtaW46IE1hdGgubWluKC4uLnRpbWVzKSxcbiAgICAgICAgICBtYXg6IE1hdGgubWF4KC4uLnRpbWVzKSxcbiAgICAgICAgICBhdmc6IHRpbWVzLnJlZHVjZSgoYSwgYikgPT4gYSArIGIpIC8gdGltZXMubGVuZ3RoLFxuICAgICAgICAgIHA5NTogdGltZXMuc29ydCgpW01hdGguZmxvb3IodGltZXMubGVuZ3RoICogMC45NSldLFxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICAvLyBBc3NlcnQgJiBMb2cgcHJvZmlsZVxuICAgICAgY29uc29sZS5sb2coJ/CflI0gQXV0aEd1YXJkIFBlcmZvcm1hbmNlIFByb2ZpbGU6JywgcGVyZm9ybWFuY2VQcm9maWxlKTtcblxuICAgICAgLy8gVsOpcmlmaWVyIHF1ZSB0b3VzIGxlcyBzY8OpbmFyaW9zIHJlc3BlY3RlbnQgbGV1cnMgc2V1aWxzXG4gICAgICBleHBlY3QocGVyZm9ybWFuY2VQcm9maWxlWydjYWNoZS1oaXQnXS5hdmcpLnRvQmVMZXNzVGhhbihQRVJGT1JNQU5DRV9USFJFU0hPTERTLkNBQ0hFX0hJVF9NQVhfVElNRSk7XG4gICAgICBleHBlY3QocGVyZm9ybWFuY2VQcm9maWxlWydjYWNoZS1taXNzJ10uYXZnKS50b0JlTGVzc1RoYW4oUEVSRk9STUFOQ0VfVEhSRVNIT0xEUy5BVVRIX1NFUlZJQ0VfQ0FMTF9NQVhfVElNRSk7XG4gICAgICBleHBlY3QocGVyZm9ybWFuY2VQcm9maWxlWydpbnZhbGlkLXRva2VuJ10uYXZnKS50b0JlTGVzc1RoYW4oUEVSRk9STUFOQ0VfVEhSRVNIT0xEUy5FUlJPUl9IQU5ETElOR19NQVhfVElNRSk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9